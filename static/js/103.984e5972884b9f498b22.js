webpackJsonp([103],{"0ALT":function(t,a){},DqoF:function(t,a){},PMUS:function(t,a,i){"use strict";var e={props:{mallData:Array},data:function(){return{pickerOptions1:{disabledDate:function(t){return t.getTime()>Date.now()}},weekPickerOpt:{firstDayOfWeek:1},tabItem:[],panelObj:{mallPanel:!1},customTime:[],dayTime:"",mallVal:"",paramId:"",methodList:[{label:"manNum",value:"TAB_INNUM",active:!1},{label:"residenceTime",value:"TAB_RESIDENCE",active:!1},{label:"comprehensive",value:"TAB_AVERAGE",active:!1}]}},created:function(){this.tabItem=[],this.tabItem.push({label:"mall",value:"mall",className:"analysis-item"})},mounted:function(){this.dayTime=dateUnit.dateFormat(new Date,"yyyy-MM-dd"),this.customTime=[this.dayReduce(new Date,7),dateUnit.dateFormat(new Date,"yyyy-MM-dd")]},methods:{i18nFormatter:function(t){var a="asisTab."+t;return this.$t(a)},initAsis:function(t){this.paramId=t,this.mallVal=t,this.tabClickHandle(0);var a={asis_time:this.dayTime,asis_org:this.paramId,asis_tit:this.getItemName(this.mallData,this.mallVal)};this.$emit("initData",a)},tabClickHandle:function(t){if("analysis-item"===this.tabItem[t].className){this.tabItem.forEach(function(t){t.className="analysis-item"}),this.tabItem[t].className="analysis-item tabs-active";for(var a in this.panelObj)this.panelObj[a]=!1;switch(this.asisLevel="",this.tabItem[t].value){case"mall":this.panelObj.mallPanel=!0,this.asisLevel="mall"}}},confirmCondition:function(){var t={asis_time:"",asis_org:"",asis_tit:""};this.mallVal&&(t.asis_time=this.dayTime,t.asis_org=this.mallVal,t.asis_tit=this.getItemName(this.mallData,this.mallVal),this.$emit("reportTime",t))},getItemName:function(t,a){var i="",e=a.toString().split(",")[0];return t.forEach(function(t){t.id==e&&(i=t.name)}),i},resetRefresh:function(){this.tabClickHandle(0),this.mallVal=this.mallData[0].id,this.dayTime=dateUnit.dateFormat(new Date,"yyyy-MM-dd"),this.customTime=[this.dayReduce(new Date,7),dateUnit.dateFormat(new Date,"yyyy-MM-dd")]}}},s={render:function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"analysis-option-wrapper"},[i("div",{staticClass:"analysis-level-wrapper"},[i("div",{staticClass:"analysis-level-left"},[i("i",{staticClass:"el-icon-search"}),t._v(" "),i("span",{staticClass:"analysis-level-text"},[t._v(t._s(t.$t("asisTab.level")))])]),t._v(" "),i("div",{staticClass:"analysis-level-right"},[i("ul",{staticClass:"analysis-type-box"},t._l(t.tabItem,function(a,e){return i("li",{key:a.value,class:a.className,on:{click:function(a){t.tabClickHandle(e)}}},[i("span",{staticClass:"analysis-item-title"},[t._v(t._s(t.i18nFormatter(a.label)))])])}))])]),t._v(" "),i("div",{staticClass:"panels-content"},[i("div",{staticClass:"panels-main-top"},[t.panelObj.mallPanel?i("ul",{staticClass:"condition-box"},[i("li",{staticClass:"condition-item"},[i("span",{staticClass:"condition-item-text"},[t._v(t._s(t.$t("asisTab.mallT")))]),t._v(" "),i("div",{staticClass:"condition-item-option"},[i("el-select",{staticClass:"mall-sel-box",attrs:{filterable:"",placeholder:"请选择广场"},model:{value:t.mallVal,callback:function(a){t.mallVal=a},expression:"mallVal"}},t._l(t.mallData,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1)]),t._v(" "),i("li",{staticClass:"condition-item"},[i("span",{staticClass:"condition-item-text"},[t._v(t._s(t.$t("asisTab.date")))]),t._v(" "),i("div",{staticClass:"condition-item-option analysis-date-condition"},[i("el-date-picker",{staticClass:"date-input analysis-date-input",attrs:{"value-format":"yyyy-MM-dd",align:"right",type:"date",size:"mini",placeholder:t.$t("pholder.date"),"picker-options":t.pickerOptions1},model:{value:t.dayTime,callback:function(a){t.dayTime=a},expression:"dayTime"}})],1)]),t._v(" "),i("li",{staticClass:"condition-item"},[i("el-button",{staticClass:"primary-btn analysis-collapse-btn",attrs:{type:"primary",size:"samll"},on:{click:t.confirmCondition}},[t._v(t._s(t.$t("button.confirm")))]),t._v(" "),i("el-button",{staticClass:"reset-btn analysis-collapse-btn",attrs:{size:"samll"},on:{click:t.resetRefresh}},[t._v(t._s(t.$t("button.reset")))])],1)]):t._e()])])])},staticRenderFns:[]},n=i("VU/8")(e,s,!1,function(t){i("0ALT")},"data-v-10f4521d",null);a.a=n.exports},gUEv:function(t,a,i){"use strict";(function(t){var e=i("mvHQ"),s=i.n(e),n=i("PMUS"),l=i("PAnj"),o=i.n(l);a.a={data:function(){return{moreOptVisible:!1,mallData:[],asisName:"",propParams:{},loading:!0,heatmapInstance:{},heatmapImg:"",sliderVal:null,sliderDisabled:!0,imgList:[],heatInstance:{},heatDataObj:{},sliderMax:300,defaultDevimg:o.a,allMax:[],divList:[],newImgList:[],count:null,valMax:1,valMin:9999,heatDataSource:[],flagArr:[],liWidth:"",sameTimeReq:!1}},components:{"in-heat-option":n.a},watch:{count:function(t){var a=this;t==this.imgList.length&&this.imgList.forEach(function(t,i){a.getTableData(t.id,i)})},imgList:function(t){this.count=t.length}},created:function(){},computed:{},mounted:function(){this.getMallOpt(),this.showCollapse()},methods:{computedW:function(){var t=this.imgList.length;return 1==t?"width: 100%":t>1&&t<5?"width: 48.5%;":"width: 32.5%;"},getDate:function(){var t=this.imgList.length;if(this.count<t)return this.count+=1},dealErrImg:function(t){(t||window.event).target.src=o.a},showCollapse:function(){var a=this,i="",e="",s="",n="";i=this.getStyleFn(".el-header","height"),e=this.getStyleFn(".base-analysis .el-header","height"),this.moreOptVisible?(this.moreOptVisible=!1,n=i+e+8+"px",t(".area-heat-main").animate({marginTop:n})):(this.moreOptVisible=!0,setTimeout(function(){s=a.getStyleFn(".analysis-option-wrapper","height"),n=i+e+s+8+"px",t(".area-heat-main").animate({marginTop:n})},1e3))},getMallOpt:function(){var t=this;this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(a){var i="",e=null;if(a.data.data.length>=1){var s=window.sessionStorage.getItem("mallId");s&&Number(s),a.data.data.forEach(function(a,e){t.mallData.push(a),s&&a.id==s&&(i=a.name)}),t.asisName=i||a.data.data[0].name,e=s?Number(s):a.data.data[0].id,t.$refs.init.initAsis(e)}})},getChannel:function(){var t=this;this.flagArr=[],this.imgList=[],this.newImgList=[],this.heatInstance={},this.sliderDisabled=!0,this.axios.get("/channels",{params:{mallId:this.propParams.asis_org,isMallGate:0,_t:Date.parse(new Date)/1e3}}).then(function(a){if(a.data.data.forEach(function(a,i){t.imgList[i]={id:a.id,channelnum:a.serialnum,shotpic:"https://store.keliuyun.com/snapshot/real/"+a.serialnum+".jpg?x-oss-process=style/thumbnail-0.1",loading:!0},t.heatInstance[i]={}}),t.liWidth=t.computedW(),t.imgList.length>2&&t.imgList.length<=4)for(var i=Math.ceil(t.imgList.length/2),e=0;e<i;e++){var s=[];if(0==e)for(var n=0;n<2;n++)t.imgList[n]&&s.push(t.imgList[n]);else for(var l=2*e;l<=2*e+2;l++)t.imgList[l]&&s.push(t.imgList[l]);t.newImgList[e]=s}else for(i=Math.ceil(t.imgList.length/3),e=0;e<i;e++){s=[];if(0==e)for(n=0;n<=2;n++)t.imgList[n]&&s.push(t.imgList[n]);else for(l=3*e;l<=3*e+2;l++)t.imgList[l]&&s.push(t.imgList[l]);t.newImgList[e]=s}t.loading=!1}).catch(function(t){console.log(t)})},getTableData:function(t,a){var i=this,e={orgIds:this.propParams.asis_org,startDate:this.propParams.asis_time,endDate:this.propParams.asis_time,_t:Date.parse(new Date)/1e3};this.heatDataObj={},this.axios.get("/heatmap/trackHeatmap/"+t,{params:e}).then(function(t){var e=t.data;console.log("result",e),"{}"===s()(e.data)&&console.log("empty data");for(var n in e.data)i.heatDataObj[n]=e.data[n];var l=i,o=new Image;o.src=l.imgList[a].shotpic,o.onload=function(){var t=l.getStyleFn(".area-img","width"),i=l.getStyleFn(".area-img","height");l.getHeatData(t,i,this.width,this.height,a)},o.onerror=function(){var t=this;setTimeout(function(){var i=l.getStyleFn(".area-img","width"),e=l.getStyleFn(".area-img","height"),s=t.width?t.width:i,n=t.height?t.height:e;l.getHeatData(i,e,s,n,a)},100)}}).catch(function(t){i.imgList[a].loading=!1,i.$forceUpdate()})},getHeatData:function(t,a,i,e,n){var l=this,o=this.imgList[n].channelnum;if(this.heatInstance[n]._renderer){var r=document.getElementById(o);if(!r.getContext)return;var h=r.getContext("2d");r.width=t,r.height=a,h.clearRect(0,0,r.width,r.height)}else{var c=document.getElementById(o);c.style.width=t+"px",c.style.height=a+"px",this.heatInstance[n]=this.$heatmapjs.create({container:c})}var m=document.getElementById(o);m.style.width=t+"px",m.style.height=a+"px";var d=[],u={};this.heatDataObj[o]&&"{}"!==s()(this.heatDataObj[o])&&this.heatDataObj[o].forEach(function(s){s.v>l.valMax&&(l.valMax=s.v),s.v<l.valMin&&(l.valMin=s.v),u={x:parseInt(s.x*t/i),y:parseInt(s.y*a/e),value:s.v},d.push(u)});var p={min:isNaN(this.valMin)?1:this.valMin,max:isNaN(this.valMax)?1:Math.ceil(20*this.valMax),data:d};if(this.heatDataSource[n]=p,this.flagArr.push(!0),this.heatInstance[n].setData(p),this.imgList[n].loading=!1,this.$forceUpdate(),this.flagArr.length==this.imgList.length){var g=isNaN(this.valMax)?1:Math.ceil(20*this.valMax);this.sliderVal=isNaN(this.valMax)?1:Math.ceil(20*this.valMax),this.sliderMax=isNaN(this.valMax)?1:Math.ceil(40*this.valMax),this.valMin=isNaN(this.valMin)?1:this.valMin,this.heatDataSource.forEach(function(t){t.max=g});for(var v in this.heatInstance)"{}"!==s()(this.heatInstance[v])&&this.heatInstance[v].setDataMax(g);this.sliderDisabled=!1}console.log("sliderVal",this.sliderVal,"sliderMax",this.sliderMax,"heatInstance",this.heatInstance),this.loading=!1},getHeatMax:function(t){this.$message({showClose:!0,type:"info",message:"当前最大值:"+this.heatInstance[t].getData().max})},slideHandle:function(t){console.log("sliderVal",t);for(var a in this.heatInstance)this.heatInstance[a]&&(this.heatInstance[a].setDataMax(t),this.heatInstance[a].repaint());console.log("slider change",this.heatInstance)},initTab:function(t){this.loading=!0,this.asisName=t.asis_tit,this.propParams=t,this.getChannel()},reportHandler:function(t){var a=this;if(this.loading=!0,this.valMax=1,this.valMin=9999,this.asisName=t.asis_tit,"{}"!==s()(this.propParams)&&this.propParams.asis_time[0]===t.asis_time[0]&&this.propParams.asis_time[1]===t.asis_time[1])return this.sameTimeReq=!0,this.$message.info("same time request!"),void setTimeout(function(){a.loading=!1},1e3);this.propParams=t,this.getChannel()}}}}).call(a,i("7t+N"))},in3i:function(t,a,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=i("gUEv"),s={render:function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"base-analysis"},[i("el-header",{attrs:{height:"70px"}},[i("span",{staticClass:"asis-title"},[t._v(t._s(t.asisName)+" "+t._s(t.$t("asis.Trackheat")))]),t._v(" "),i("span",{staticClass:"more-option-wrapper",on:{click:t.showCollapse}},[i("span",{staticClass:"more-option-text"},[t._v(t._s(t.$t("asis.moreOp")))]),t._v(" "),i("i",{class:t.moreOptVisible?"el-icon-arrow-down more-option-arrow":"el-icon-arrow-down more-option-arrow more-option-up"})])]),t._v(" "),i("in-heat-option",{directives:[{name:"show",rawName:"v-show",value:t.moreOptVisible,expression:"moreOptVisible"}],ref:"init",attrs:{mallData:t.mallData},on:{reportTime:t.reportHandler,initData:t.initTab}}),t._v(" "),i("div",{staticClass:"element-main area-heat-main"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"area-heat-container"},[i("div",{attrs:{id:"areaHeatmap"}},[i("div",{staticClass:"heat-silder"},[i("el-slider",{attrs:{max:t.sliderMax,min:1,vertical:"",disabled:t.sliderDisabled,height:"200px"},on:{change:function(a){t.slideHandle(t.sliderVal)}},model:{value:t.sliderVal,callback:function(a){t.sliderVal=a},expression:"sliderVal"}})],1),t._v(" "),t._l(t.newImgList,function(a,e){return i("ul",{key:e,staticClass:"inside-bg-box"},t._l(a,function(a,e){return i("li",{key:e,staticClass:"inside-bg-item",style:t.liWidth},[i("img",{staticClass:"area-img",attrs:{onload:t.getDate(),src:a.shotpic},on:{error:function(a){t.dealErrImg(a)}}}),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"item1.loading"}],staticClass:"heatmap-div"},[i("div",{attrs:{id:a.channelnum}})])])}))})],2)])])],1)},staticRenderFns:[]},n=function(t){i("DqoF")},l=i("VU/8")(e.a,s,!1,n,"data-v-036aa5a5",null);a.default=l.exports}});