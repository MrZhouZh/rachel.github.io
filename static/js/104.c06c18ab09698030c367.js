webpackJsonp([104],{"6Zbo":function(t,a){},d57R:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("f4Gi"),s={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"base-analysis"},[e("el-header",{attrs:{height:"70px"}},[e("span",{staticClass:"asis-title"},[t._v(t._s(t.asisName)+" "+t._s(t.$t("asis.Areaheat")))]),t._v(" "),e("span",{staticClass:"more-option-wrapper",on:{click:t.showCollapse}},[e("span",{staticClass:"more-option-text"},[t._v(t._s(t.$t("asis.moreOp")))]),t._v(" "),e("i",{class:t.moreOptVisible?"el-icon-arrow-down more-option-arrow":"el-icon-arrow-down more-option-arrow more-option-up"})])]),t._v(" "),e("area-heat-option",{directives:[{name:"show",rawName:"v-show",value:t.moreOptVisible,expression:"moreOptVisible"}],ref:"init",attrs:{mallData:t.mallData},on:{reportTime:t.reportHandler,initData:t.initTab}}),t._v(" "),e("div",{staticClass:"element-main area-heat-main"},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"},{name:"show",rawName:"v-show",value:t.isTabChart,expression:"isTabChart"}],staticClass:"area-heat-container"},[e("div",{attrs:{id:"areaHeatmap"}},[e("div",{staticClass:"heat-silder"},[e("el-slider",{attrs:{max:t.siliderMaxVal,min:1,vertical:"",disabled:t.sliderDisabled,height:"200px"},on:{change:function(a){t.slideHandle(t.sliderVal)}},model:{value:t.sliderVal,callback:function(a){t.sliderVal=a},expression:"sliderVal"}})],1),t._v(" "),e("img",{staticClass:"area-img",style:{width:t.bgW,height:t.bgH},attrs:{src:t.defaultImg}})]),t._v(" "),e("span",{staticClass:"report-type-box"},[e("span",{class:t.isTabChart?"report-item report-item-tab":"report-item",on:{click:function(a){t.selReport("heatmap")}}}),t._v(" "),e("span",{class:t.isTabChart?"report-item bar-report":"report-item bar-report report-item-bar",on:{click:function(a){t.selReport("bar")}}})])]),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"},{name:"show",rawName:"v-show",value:t.isBarChart,expression:"isBarChart"}],staticClass:"bar-container download-parent"},[e("span",{staticClass:"ehcarts-title"},[t._v(t._s(t.residenceTitle))]),t._v(" "),e("div",{attrs:{id:"heatBar"}}),t._v(" "),e("span",{staticClass:"report-type-box"},[e("span",{class:t.isTabChart?"report-item report-item-tab":"report-item",on:{click:function(a){t.selReport("heatmap")}}}),t._v(" "),e("span",{class:t.isTabChart?"report-item bar-report":"report-item bar-report report-item-bar",on:{click:function(a){t.selReport("bar")}}})])])])],1)},staticRenderFns:[]},n=function(t){e("6Zbo")},l=e("VU/8")(i.a,s,!1,n,"data-v-7b8b1804",null);a.default=l.exports},f4Gi:function(t,a,e){"use strict";(function(t){var i=e("wkuu"),s=e.n(i),n=e("paEM"),l=e("ctpb"),o=e.n(l),r=e("SVvQ"),d=e.n(r);a.a={data:function(){return{moreOptVisible:!1,mallData:[],asisName:"",propParams:{},loading:!0,heatmapInstance:{},defaultImg:"",sliderVal:null,siliderMaxVal:null,sliderDisabled:!0,residenceTitle:"区域滞留时间分布",isTabChart:!0,isBarChart:!0,heatData:{},xAxisData:[],barData:[],bgW:"",bgH:""}},components:{"area-heat-option":n.a},created:function(){},mounted:function(){this.getMallOpt(),this.showCollapse()},methods:{showCollapse:function(){var a=this,e="",i="",s="",n="";e=this.getStyleFn(".el-header","height"),i=this.getStyleFn(".analysis-wrapper .el-header","height"),this.moreOptVisible?(this.moreOptVisible=!1,n=e+i+8+"px",t(".area-heat-main").animate({marginTop:n})):(this.moreOptVisible=!0,setTimeout(function(){s=a.getStyleFn(".analysis-option-wrapper","height"),n=e+i+s+8+"px",t(".area-heat-main").animate({marginTop:n})},100))},getMallOpt:function(){var t=this;this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(a){var e="",i=null;if(a.data.data.length>=1){var s=window.sessionStorage.getItem("mallId");s&&Number(s),a.data.data.forEach(function(a,i){t.mallData.push(a),s&&a.id==s&&(e=a.name)}),t.asisName=e||a.data.data[0].name,i=s?Number(s):a.data.data[0].id,t.$refs.init.initAsis(i)}})},getTableData:function(){this.sliderDisabled=!0;var t=this,a=new Image;a.src=this.defaultImg,a.onload=function(){var a=t.getStyleFn(".area-img","width"),e=t.getStyleFn(".area-img","height");t.getHeatData(a,e)}},getHeatData:function(t,a){var e=this,i={orgIds:this.propParams.asis_org,option:this.propParams.asis_option,startDate:this.propParams.asis_time,endDate:this.propParams.asis_time,_t:Date.parse(new Date)/1e3},s={TAB_INNUM:"区域滞留人数分布",TAB_RESIDENCE:"区域滞留时间分布",TAB_AVERAGE:"区域平均滞留时间分布"};if(this.residenceTitle=s[i.option]?s[i.option]:"区域滞留人数分布",this.heatmapInstance._renderer){var n=document.querySelector("canvas");if(!n.getContext)return;var l=document.getElementById("areaHeatmap");l.style.width=t+"px",l.style.height=a+"px";var o=n.getContext("2d");n.width=t,n.height=a,o.clearRect(0,0,n.width,n.height)}else{var r=document.getElementById("areaHeatmap");r.style.width=t+"px",r.style.height=a+"px",this.heatmapInstance=this.$heatmapjs.create({container:r})}var d=document.querySelector("canvas");d.style.width=t+"px",d.style.height=a+"px";this.getStyleFn("#areaHeatmap","width"),this.getStyleFn("#areaHeatmap","height"),this.normalWidth,this.normalHeight;this.axios.get("/heatmap/zoneHotmap/mall",{params:i}).then(function(i){var s=i.data,n=[],l={},o=[],r=[],d=[];for(var h in s.data){var m=s.data[h].innum?s.data[h].innum:s.data[h].residence?s.data[h].residence:s.data[h].average?s.data[h].average:null;r.push(s.data[h].zoneName);var c=s.data[h].innum?s.data[h].innum:s.data[h].residence?s.data[h].residence:s.data[h].average?s.data[h].average:null;if(d.push(c),m&&s.data[h].zoneX&&s.data[h].zoneY){o.push(m);for(var p=0;p<10;p++){var u=e.random(0,1);l={x:e.getRandomPoint(s.data[h].zoneX/e.normalWidth*t),y:e.getRandomPoint(s.data[h].zoneY/e.normalHeight*a),value:m*u},n.push(l)}}}e.barChartFn("heatBar",r,d);var v=o.length?Math.max.apply(null,o):1,f={max:isNaN(v)?1:v,data:n};e.xAxisData=r,e.barData=d,e.heatData=f,e.siliderMaxVal=isNaN(v)?1:v,e.sliderVal=isNaN(v)?1:Math.ceil(v/2),e.heatmapInstance.setData(f),e.sliderDisabled=e.sliderVal==e.siliderMaxVal==1,setTimeout(function(){e.loading=!1},300)}).catch(function(t){e.loading=!1})},barChartFn:function(t,a,e){var i=this,s={},n=document.getElementById(t);s=this.$echarts.getInstanceByDom(n)?this.$echarts.getInstanceByDom(n):this.$echarts.init(n);var l={color:"#3BB8FF",grid:{top:70,left:60,bottom:66,right:40},tooltip:{trigger:"axis",backgroundColor:"#fff",padding:[0,0,0,0],textStyle:{color:"#333"},axisPointer:{type:"line",animation:!0,lineStyle:{color:"transparent"}},extraCssText:"box-shadow: 0px 0px 10px -4px rgba(3, 3, 3, .4)"},yAxis:{type:"value",nameRotate:1,splitLine:{lineStyle:{color:"#EBEBEB"}},axisLine:{lineStyle:{color:"#888"}},axisTick:{show:!1},axisLabel:{fontSize:12,fontFamily:this.fontFamily,color:"#666"}},xAxis:{splitLine:{show:!1},axisLine:{lineStyle:{color:"#888"}},axisTick:{show:!1},axisLabel:{fontSize:12,fontFamily:this.fontFamily,color:"#666"},data:a}};"string"==typeof l.title&&(l.title={text:"区域热力滞留时间",show:!1,textStyle:{color:"#444",fontSize:18,fontFamily:this.fontFamily,fontWeight:"normal"},left:26,top:20}),l.series=[],l.series.push({data:e});try{if(e.length>0)for(var o=0;o<l.series.length;o++)l.series[o].type="bar",l.series[o].barMaxWidth="40px",l.series[o].barGap="6px";e.length||(l.graphic={type:"text",left:"center",top:"middle",z:100,style:{fill:"#333",text:this.$t("echartsTitle.noData"),font:"14px "+this.fontFamily}},s.clear(),setTimeout(function(){s.setOption(l)},500))}catch(t){}l.tooltip.formatter=function(t,a,e){var s="",n="";if(t.length>0){if(n=t[0].axisValue,s+='<div style="font-size:14px;height:32px;color:#0069FF;border-radius:4px;line-height:36px;padding-left:15px;padding-right:15px;text-align: left;">'+n+"</div><div>","TAB_INNUM"==i.propParams.asis_option)for(var l=0;l<t.length;l++)s+='<p style="font-size:13px;padding:4px 23px 6px 15px;color:#333;text-align: left;">'+(t[l].data?t[l].data:0)+(t[l].data?t[l].data>1e5?"万人次":"人次":"")+"</p>";else for(var o=0;o<t.length;o++)s+='<p style="font-size:13px;padding:4px 23px 6px 15px;color:#333;text-align: left;">'+(t[o].data?t[o].data>60?(t[o].data/60).toFixed(1):t[o].data:0)+(t[o].data?t[o].data>60?"分":"秒":"")+"</p>";return s+="</div>"}},s.clear(),s.setOption(l),this.isBarChart=!1},slideHandle:function(t){this.heatmapInstance.setDataMax(t)},initTab:function(t){237==t.asis_org?this.defaultImg=o.a:this.defaultImg=d.a,this.getImg(t.asis_org,t,!0)},reportHandler:function(t){237==t.asis_org?this.defaultImg=o.a:this.defaultImg=d.a,this.getImg(t.asis_org,t)},getImg:function(t,a,e){var i=this;this.bgW=this.bgH="",this.axios.get("/floors",{params:{mallId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){var n=t.data;n.data.length>0?i.defaultImg=window.apiUrl+"/floors/img/"+n.data[0].floorPlan:(i.defaultImg=s.a,i.bgW="100%"),i.loading=!0,e||(i.isTabChart=!0),i.asisName=a.asis_tit,i.propParams=a,i.getTableData()})},selReport:function(t){if("heatmap"===t){if(this.isTabChart)return;this.isBarChart=!1,this.isTabChart=!0}else{if(!this.isTabChart)return;this.isTabChart=!1,this.isBarChart=!0}},random:function(t,a){for(var e=Math.random()*(a+1-t)+t;e>a;)e=Math.random()*(a+1-t)+t;return e},getRandomPoint:function(t){var a=this.random(-70,70),e=void 0;if((e=parseInt(t-a))>0)return e;this.getRandomPoint(t)}}}}).call(a,e("7t+N"))},gRdQ:function(t,a){},paEM:function(t,a,e){"use strict";var i={props:{mallData:Array},data:function(){return{pickerOptions1:{disabledDate:function(t){return t.getTime()>Date.now()}},weekPickerOpt:{firstDayOfWeek:1},tabItem:[],panelObj:{mallPanel:!1},dayTime:"",mallVal:"",paramId:"",methodList:[{label:"manNum",value:"TAB_INNUM",active:!1},{label:"residenceTime",value:"TAB_RESIDENCE",active:!1},{label:"comprehensive",value:"TAB_AVERAGE",active:!1}],showMethodVal:""}},created:function(){this.tabItem=[],this.tabItem.push({label:"mall",value:"mall",className:"analysis-item"})},mounted:function(){this.showMethodHandle(0),this.dayTime=dateUnit.dateFormat(new Date,"yyyy-MM-dd")},methods:{i18nFormatter:function(t){var a="asisTab."+t;return this.$t(a)},initAsis:function(t){this.paramId=t,this.mallVal=t,this.tabClickHandle(0);var a={asis_time:this.dayTime,asis_org:this.paramId,asis_option:this.showMethodVal,asis_tit:this.getItemName(this.mallData,this.mallVal)};this.$emit("initData",a)},tabClickHandle:function(t){if("analysis-item"===this.tabItem[t].className){this.tabItem.forEach(function(t){t.className="analysis-item"}),this.tabItem[t].className="analysis-item tabs-active";for(var a in this.panelObj)this.panelObj[a]=!1;switch(this.asisLevel="",this.tabItem[t].value){case"mall":this.panelObj.mallPanel=!0,this.asisLevel="mall"}}},showMethodHandle:function(t){this.methodList[t].active||(this.methodList.forEach(function(t){t.active=!1}),this.methodList[t].active=!0,this.showMethodVal=this.methodList[t].value)},confirmCondition:function(){var t={asis_time:"",asis_org:"",asis_option:"",asis_tit:""};this.mallVal&&(t.asis_option=this.showMethodVal,t.asis_time=this.dayTime,t.asis_org=this.mallVal,t.asis_tit=this.getItemName(this.mallData,this.mallVal),this.$emit("reportTime",t))},getItemName:function(t,a){var e="",i=a.toString().split(",")[0];return t.forEach(function(t){t.id==i&&(e=t.name)}),e},resetRefresh:function(){this.tabClickHandle(0),this.mallVal=this.mallData[0].id,this.dayTime=dateUnit.dateFormat(new Date,"yyyy-MM-dd")}}},s={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"analysis-option-wrapper"},[e("div",{staticClass:"analysis-level-wrapper"},[e("div",{staticClass:"analysis-level-left"},[e("i",{staticClass:"el-icon-search"}),t._v(" "),e("span",{staticClass:"analysis-level-text"},[t._v(t._s(t.$t("asisTab.level")))])]),t._v(" "),e("div",{staticClass:"analysis-level-right"},[e("ul",{staticClass:"analysis-type-box"},t._l(t.tabItem,function(a,i){return e("li",{key:a.value,class:a.className,on:{click:function(a){t.tabClickHandle(i)}}},[e("span",{staticClass:"analysis-item-title"},[t._v(t._s(t.i18nFormatter(a.label)))])])}))])]),t._v(" "),e("div",{staticClass:"panels-content"},[e("div",{staticClass:"panels-main-top"},[t.panelObj.mallPanel?e("ul",{staticClass:"condition-box"},[e("li",{staticClass:"condition-item"},[e("span",{staticClass:"condition-item-text"},[t._v(t._s(t.$t("asisTab.mallT")))]),t._v(" "),e("div",{staticClass:"condition-item-option"},[e("el-select",{staticClass:"mall-sel-box",attrs:{filterable:"",placeholder:"请选择广场"},model:{value:t.mallVal,callback:function(a){t.mallVal=a},expression:"mallVal"}},t._l(t.mallData,function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1)]),t._v(" "),e("li",{staticClass:"condition-item"},[e("span",{staticClass:"condition-item-text"},[t._v(t._s(t.$t("asisTab.date")))]),t._v(" "),e("div",{staticClass:"condition-item-option"},[e("el-date-picker",{staticClass:"date-input analysis-date-input",attrs:{"value-format":"yyyy-MM-dd",align:"right",type:"date",size:"mini",placeholder:t.$t("pholder.date"),"picker-options":t.pickerOptions1},model:{value:t.dayTime,callback:function(a){t.dayTime=a},expression:"dayTime"}})],1)])]):t._e()]),t._v(" "),e("div",{staticClass:"panels-main-bottom"},[e("ul",{staticClass:"condition-box"},[e("li",{staticClass:"condition-item"},[e("span",{staticClass:"condition-item-text"},[t._v("热力图展示方式 :")]),t._v(" "),e("div",{staticClass:"condition-item-option"},[e("ul",{staticClass:"show-method-box"},t._l(t.methodList,function(a,i){return e("li",{key:a.label,class:a.active?"show-method-item is-active":"show-method-item",on:{click:function(a){t.showMethodHandle(i)}}},[e("span",{staticClass:"show-method-type"},[t._v(t._s(t.i18nFormatter(a.label)))])])}))])]),t._v(" "),e("li",{staticClass:"condition-item"},[e("el-button",{staticClass:"primary-btn analysis-collapse-btn",attrs:{type:"primary",size:"samll"},on:{click:t.confirmCondition}},[t._v(t._s(t.$t("button.confirm")))]),t._v(" "),e("el-button",{staticClass:"reset-btn analysis-collapse-btn",attrs:{size:"samll"},on:{click:t.resetRefresh}},[t._v(t._s(t.$t("button.reset")))])],1)])])])])},staticRenderFns:[]},n=e("VU/8")(i,s,!1,function(t){e("gRdQ")},"data-v-0ae118d4",null);a.a=n.exports}});