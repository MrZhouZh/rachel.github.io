webpackJsonp([106],{"/XpX":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("G8xV"),o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login-wrapper"},["mall"!==e.$Project?a("div",{staticClass:"login-header"},[a("lange-Select",{staticClass:"login-lang"})],1):e._e(),e._v(" "),a("div",{staticClass:"login-box"},[a("div",{staticClass:"login-bg"}),e._v(" "),a("div",{staticClass:"right-form"},[a("el-form",{ref:"loginForm",staticClass:"demo-ruleForm",attrs:{model:e.loginForm,"status-icon":"",rules:e.myRules,"label-width":"100px"}},[a("el-form-item",{attrs:{prop:"loginName"}},[a("el-input",{staticClass:"form-inp",model:{value:e.loginForm.loginName,callback:function(t){e.$set(e.loginForm,"loginName",t)},expression:"loginForm.loginName"}},[a("i",{staticClass:"custom-icon loginUser-icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),a("el-form-item",{attrs:{prop:"password"}},[a("el-input",{staticClass:"form-inp",attrs:{type:"password","auto-complete":"off"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.submitForm("loginForm")}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}},[a("i",{staticClass:"custom-icon pass-icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),a("el-form-item",{staticClass:"form-submit-wrapper"},[a("el-button",{staticClass:"submit-btn",attrs:{type:"primary"},on:{click:function(t){e.submitForm("loginForm")}}},[e._v(e._s(e.$t("login.btn")))])],1),e._v(" "),a("el-form-item",{staticClass:"remember-box"},[a("el-checkbox",{model:{value:e.rememberPass,callback:function(t){e.rememberPass=t},expression:"rememberPass"}},[e._v(e._s(e.$t("login.rememberPw")))])],1)],1),e._v(" "),a("p",{staticClass:"login-footer"},[e._v("北京文安智能技术股份有限公司")])],1),e._v(" "),a("p",{staticClass:"login-footer"},[e._v("北京文安智能技术股份有限公司")])]),e._v(" "),a("el-dialog",{staticClass:"countdown-diglog",attrs:{title:e.$t("message.prompt"),visible:e.centerDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("div",{staticClass:"show-body"},[a("span",{staticClass:"countdown"},[e._v("cookie失效,"+e._s(e.second)+"秒后跳转页面\n            "),a("i",{staticClass:"el-icon-loading"})])])])],1)},staticRenderFns:[]},n=function(e){a("092j"),a("Uh32")},i=a("VU/8")(s.a,o,!1,n,"data-v-ed01c422",null);t.default=i.exports},"092j":function(e,t){},G8xV:function(e,t,a){"use strict";(function(e){var s=a("mvHQ"),o=a.n(s),n=a("n2YA");window.addEventListener("resize",function(){e(".login-wrapper").css({height:window.innerHeight+"px"})}),t.a={data:function(){return{loginForm:{loginName:"",password:""},rememberPass:!0,myRules:{loginName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},asusAtoken:"",centerDialogVisible:!1,second:3,treeData:[],appunid:""}},components:{"lange-Select":n.a},created:function(){var e=this;document.addEventListener("keydown",function(t){13===window.event.keyCode&&e.submitForm("loginForm")})},mounted:function(){this.checkCookie();var t=this;e.ajax({url:window.apiUrl+"/users/relogin",dataType:"text",type:"post",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){if(e){var a=JSON.parse(e);if(200==a.code)t.$cookie.set("userId",a.data.user.id),t.$cookie.set("atoken",a.data.atoken),t.$cookie.set("rtoken",a.data.rtoken),t.$cookie.set("user_unid",a.data.user_unid),t.$cookie.set("user_type",a.data.userType),a.data.user.loginName?(t.$cookie.set("username",a.data.user.loginName),t.setSessionLocal("loginName",a.data.user.loginName)):t.$cookie.set("username",a.username),"super"===a.data.userType?t.getAccName(0,!0):a.data.user.accountId?(t.$cookie.set("accountId",a.data.user.accountId),t.getAccName(a.data.user.accountId)):t.getAccName(-1),t.$cookie.get("atoken")&&t.getNode();else if(200!=a.ecode)if(a.enote&&t.$message({showClose:!0,type:"warning",message:a.enote}),a.ssoReturnUrl){if(t.centerDialogVisible=!0,0!=t.second)var s=setInterval(function(){t.second--,0==t.second&&(t.centerDialogVisible=!1,clearInterval(s),window.location.href=a.ssoReturnUrl)},1e3)}else t.$router.push("/")}else t.$router.push("/")},error:function(e){t.$message({showClose:!0,type:"error",message:e.status})}})},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.axios.post("/users/login",t.loginForm).then(function(e){t.$cookie.set("userId",e.data.data.user.id),t.$cookie.set("atoken",e.data.data.atoken),t.$cookie.set("rtoken",e.data.data.rtoken),t.$cookie.set("user_unid",e.data.data.user_unid),t.$cookie.set("user_type",e.data.data.userType),t.setSessionLocal("loginName",e.data.data.user.loginName),t.rememberPass?(t.$cookie.set("username",t.loginForm.loginName),t.$cookie.set("pwd",t.loginForm.password)):(t.$cookie.remove("username"),t.$cookie.remove("pwd")),e.data.data.user.accountId?(t.$cookie.set("accountId",e.data.data.user.accountId),t.getAccName(e.data.data.user.accountId)):t.getAccName(-1)}).catch(function(e){t.$message({showClose:!0,type:"error",message:t.$t("message.loginFailed")})})})},getNode:function(){var e=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps",{params:{_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data.list_data;0==a.length&&e.$message({showClose:!0,type:"warning",message:e.$t("message.nomenu")}),a.forEach(function(t,a){t.name==e.$Project&&(e.appunid=t.unid)}),e.getMeun(e.appunid)}).catch(function(e){})},getMeun:function(e){var t=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps/"+e+"/menus",{params:{_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data.menu_tree,s=[];if(0==a.length)t.$message({showClose:!0,type:"warning",message:t.$t("message.nomenu")});else{a.length>=2?s.push(a[1]):s.push(a[0]);var n=[];0!=s.length&&s.forEach(function(e,t){e.children.forEach(function(e,t){var a=[],s={};s.unid=e.unid,s.id=e.perm_unid,s.label=e.name,n.push(s),e.children.forEach(function(t,s){var o={};e.unid==t.parent&&(o.unid=t.unid,o.id=t.perm_unid,o.label=t.name),a.push(o)}),n[t].children=a})}),t.treeData=n;var i=o()(t.treeData);window.localStorage.setItem("menu",i),window.sessionStorage.setItem("loginVal",!0),console.log("treeData",t.treeData,(new Date).getTime()),t.$router.push("/home")}}).catch(function(e){})},getAccName:function(e){var t=this;e=-1==e?null:e,this.axios.get("/accounts",{params:{id:e,_t:Date.parse(new Date)/1e3}}).then(function(e){if(e.data.data.length<1)t.$message({showClose:!0,type:"wraning",message:t.$t("message.noBloc")});else{var a=e.data.data[0].name;t.$cookie.set("accountId",e.data.data[0].id),t.$cookie.set("accountName",a),t.getcityList()}})},getcityList:function(){this.axios.get("/citys",{params:{_t:Date.parse(new Date)/1e3}}).then(function(e){var t={};e.data.data.forEach(function(e,a,s){t[e.cityId]=e.cityName});var a=o()(t);window.sessionStorage.setItem("cityMap",a)}).catch(function(e){})},checkCookie:function(){var e=this.$cookie.get("username"),t=this.$cookie.get("pwd");""!==e&&""!==t?(this.loginForm.loginName=e,this.loginForm.password=t):(this.loginForm.loginName="",this.loginForm.password="")}}}}).call(t,a("7t+N"))},Uh32:function(e,t){}});