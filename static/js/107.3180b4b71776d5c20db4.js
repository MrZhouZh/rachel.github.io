webpackJsonp([107],{"/Z1x":function(e,t){},EV1k:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("broi"),a={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"login-wrapper"},["mall"!==e.$Project?o("div",{staticClass:"login-header"},[o("lange-Select",{staticClass:"login-lang"})],1):e._e(),e._v(" "),o("div",{staticClass:"login-box"},[o("div",{staticClass:"login-bg"}),e._v(" "),o("div",{staticClass:"right-form"},[o("el-form",{ref:"loginForm",staticClass:"demo-ruleForm",attrs:{model:e.loginForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[o("el-form-item",{attrs:{prop:"loginName"}},[o("el-input",{staticClass:"form-inp",model:{value:e.loginForm.loginName,callback:function(t){e.$set(e.loginForm,"loginName",t)},expression:"loginForm.loginName"}},[o("i",{staticClass:"custom-icon loginUser-icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),o("el-form-item",{attrs:{prop:"password"}},[o("el-input",{staticClass:"form-inp",attrs:{type:"password","auto-complete":"off"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.submitForm("loginForm")}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}},[o("i",{staticClass:"custom-icon pass-icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),o("el-form-item",{staticClass:"form-submit-wrapper"},[o("el-button",{staticClass:"submit-btn",attrs:{type:"primary"},on:{click:function(t){e.submitForm("loginForm")}}},[e._v(e._s(e.falg?e.$t("login.loginLoading"):e.$t("login.btn")))])],1),e._v(" "),o("el-form-item",{staticClass:"remember-box"},[o("el-checkbox",{model:{value:e.rememberPass,callback:function(t){e.rememberPass=t},expression:"rememberPass"}},[e._v(e._s(e.$t("login.rememberPw")))])],1)],1),e._v(" "),o("p",{staticClass:"login-footer"},[e._v("北京文安智能技术股份有限公司")])],1)]),e._v(" "),o("el-dialog",{staticClass:"manage-dialog",attrs:{title:e.$t("dialog.resetPW"),visible:e.passwordDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.passwordDialogVisible=t},close:function(t){e.cancledialog()}}},[o("el-form",{ref:"passwordForm",attrs:{model:e.passwordForm,"status-icon":"",rules:e.newRules,"label-width":"formLabelWidth"}},[o("el-form-item",{attrs:{label:e.$t("dialog.newPW"),prop:"newpass"}},[o("el-input",{attrs:{type:"password"},model:{value:e.passwordForm.newpass,callback:function(t){e.$set(e.passwordForm,"newpass",t)},expression:"passwordForm.newpass"}}),e._v(" "),o("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("dialog.confirmPW"),prop:"checkPass"}},[o("el-input",{attrs:{type:"password"},model:{value:e.passwordForm.checkPass,callback:function(t){e.$set(e.passwordForm,"checkPass",t)},expression:"passwordForm.checkPass"}}),e._v(" "),o("i",{staticClass:"error-tip"},[e._v("*")])],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticClass:"dialog-btn",on:{click:function(t){e.passwordDialogVisible=!1}}},[e._v(e._s(e.$t("dialog.cancel")))]),e._v(" "),o("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(t){e.changeSubmit("passwordForm")}}},[e._v(e._s(e.$t("dialog.confirm")))])],1)],1)],1)},staticRenderFns:[]},n=function(e){o("/Z1x")},i=o("VU/8")(s.a,a,!1,n,"data-v-09255530",null);t.default=i.exports},broi:function(e,t,o){"use strict";(function(e){var s=o("//Fk"),a=o.n(s),n=o("mvHQ"),i=o.n(n),r=o("n2YA"),c=(o("liqX"),o("mw3O"));o.n(c);window.addEventListener("resize",function(){e(".login-wrapper").css({height:window.innerHeight+"px"})}),t.a={data:function(){var e=this;return{loginForm:{loginName:"",password:""},rememberPass:!0,rules:{loginName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},falg:!1,treeData:[],appunid:"",passwordDialogVisible:!1,passwordForm:{newpass:"",checkPass:""},newRules:{newpass:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:function(t,o,s){if(!/^(?![A-Z]+$)(?![a-z]+$)(?!\d+$)(?![\W_]+$)\S{6,16}$/.test(o))return s(new Error("请输入不小于六位包含字母数字的密码"));""===o?s(new Error("请输入密码")):o==e.loginForm.password?s(new Error("新旧密码相同")):(""!==e.passwordForm.checkPass&&e.$refs.passwordForm.validateField("checkPass"),s())},trigger:"change"}],checkPass:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:function(t,o,s){if(!/^(?![A-Z]+$)(?![a-z]+$)(?!\d+$)(?![\W_]+$)\S{6,16}$/.test(o))return s(new Error("请输入不小于六位包含字母数字的密码"));""===o?s(new Error("请再次输入密码")):o!==e.passwordForm.newpass?s(new Error("两次输入密码不一致!")):s()},trigger:"change"}]}}},components:{"lange-Select":r.a},created:function(){var e=this;document.addEventListener("keyup",function(t){13===window.event.keyCode&&e.submitForm("loginForm")})},mounted:function(){this.checkCookie()},methods:{submitForm:function(e){var t=this;document.documentMode;this.$refs[e].validate(function(e){if(!e)return!1;t.falg||(t.falg=!0,setTimeout(function(){t.falg=!1},3e3),t.axios.post("/users/login",t.loginForm).then(function(e){0==e.data.success&&500==e.data.code?t.$message({showClose:!0,type:"error",message:e.data.msg}):"123456"==t.loginForm.password?(t.$cookie.set("atoken",e.data.data.atoken),t.passwordDialogVisible=!0):(t.$cookie.set("userId",e.data.data.user.id),t.$cookie.set("atoken",e.data.data.atoken),t.$cookie.set("rtoken",e.data.data.rtoken),t.$cookie.set("user_unid",e.data.data.user_unid),t.$cookie.set("user_type",e.data.data.userType),t.setSessionLocal("loginName",e.data.data.user.loginName),t.rememberPass?(t.$cookie.set("username",t.loginForm.loginName),t.$cookie.set("pwd",t.loginForm.password)):(t.$cookie.remove("username"),t.$cookie.remove("pwd")),"super"===e.data.data.userType?t.getAccName(0,!0):e.data.data.user.accountId?(t.$cookie.set("accountId",e.data.data.user.accountId),t.getAccName(e.data.data.user.accountId)):(t.$cookie.set("accountId",e.data.data.user.accountId),t.getAccName(-1),t.$cookie.set("accountId",-1),t.$cookie.set("accountName","")))}).catch(function(e){t.$message({showClose:!0,type:"error",message:t.$t("message.loginFailed")+""+e.message})}))})},getNode:function(){var e=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps",{params:{_t:Date.parse(new Date)/1e3}}).then(function(t){var o=t.data.list_data;0==o.length&&(e.$message({showClose:!0,type:"warning",message:e.$t("message.nomenu")}),e.removeCookies()),o.forEach(function(t,o){t.name==e.$Project&&(e.appunid=t.unid)}),e.getMeun(e.appunid)}).catch(function(t){e.removeCookies()})},getMeun:function(e){var t=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps/"+e+"/menus",{params:{_t:Date.parse(new Date)/1e3}}).then(function(e){var o=e.data.menu_tree,s=[];if(0==o.length)t.$message({showClose:!0,type:"warning",message:t.$t("message.nomenu")}),t.removeCookies();else{o.length>=2?s.push(o[1]):s.push(o[0]);var a=[];0!=s.length&&s.forEach(function(e,t){e.children.forEach(function(e,t){var o=[],s={};s.unid=e.unid,s.id=e.perm_unid,s.label=e.name,a.push(s),e.children.forEach(function(t,s){var a={};e.unid==t.parent&&(a.unid=t.unid,a.id=t.perm_unid,a.label=t.name),o.push(a)}),a[t].children=o})}),t.treeData=a;var n=i()(t.treeData);window.localStorage.setItem("menu",n),window.sessionStorage.setItem("loginVal",!0),t.$router.push("/home")}}).catch(function(e){t.removeCookies()})},getAccName:function(e,t){var o=this;e=-1==e||0==e?null:e,this.axios.get("/accounts",{params:{id:e,_t:(new Date).getTime()/1e3}}).then(function(e){if(e.data.data.length<1)t?(o.$cookie.set("accountId",0),o.$cookie.set("accountName","none"),o.getmallId()):o.$message({showClose:!0,type:"warning",message:o.$t("message.noBloc")});else{var s=e.data.data[0].name;o.$cookie.set("accountId",e.data.data[0].id),o.$cookie.set("accountName",s),o.getmallId(),o.getcityList(),window.allMenu&&(window.sessionStorage.setItem("loginVal",!0),o.$router.push("/home"))}window.allMenu||o.getNode()}).catch(function(e){})},getmallId:function(){var e=this;this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:(new Date).getTime()/1e3}}).then(function(t){e.$cookie.set("orgId",t.data.data[0].id)}).catch(function(e){})},getcityList:function(){this.axios.get("/citys",{params:{_t:(new Date).getTime()/1e3}}).then(function(e){var t={};e.data.data.forEach(function(e,o,s){t[e.cityId]=e.cityName});var o=i()(t);window.sessionStorage.setItem("cityMap",o)}).catch(function(e){})},checkCookie:function(){var e=this.$cookie.get("username"),t=this.$cookie.get("pwd");""!==e&&""!==t?(this.loginForm.loginName=e,this.loginForm.password=t):(this.loginForm.loginName="",this.loginForm.password="")},changeSubmit:function(e){var t=this;this.$refs[e].validate(function(e){e&&t.axios.post("users/updateUser",{loginName:t.loginForm.loginName,oldPassWord:t.loginForm.password,password:t.passwordForm.newpass}).then(function(e){t.passwordDialogVisible=!1,t.$cookie.remove("atoken"),t.$message({showClose:!0,message:t.$t("message.changePWSuccess"),type:"success"}).catch(function(e){t.$message({showClose:!0,message:t.$t("message.changePWFailed"),type:"error"})})})})},cancledialog:function(){this.passwordForm={newpass:"",checkPass:""},this.$refs.passwordForm.resetFields()},fetchIe9:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(window.XDomainRequest)return new a.a(function(o,s){var a=t.method||"GET",n=t.timeout||2e4,r=t.contentType||"application/json;charset=utf-8",c=t.body||t.params||{};c instanceof Object&&(c=i()(c));var l=new XDomainRequest;console.log("---------------------------xdr------------------------"),console.log(l),console.log("---------------------------xdr------------------------"),l.open(a,e),l.timeout=n,l.contentType=r,l.onload=function(){try{var e=JSON.parse(l.responseText);return o(e.data)}catch(e){s(e)}return s({})},l.onprogress=function(){},l.ontimeout=function(){return s("XDomainRequest timeout")},l.onerror=function(){return s("XDomainRequest error")},setTimeout(function(){l.send(c)},0)})}}}}).call(t,o("7t+N"))}});