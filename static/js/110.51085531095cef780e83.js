webpackJsonp([110],{Gba7:function(e,t){},g2Ji:function(e,t,a){"use strict";(function(e){var i=a("mvHQ"),o=a.n(i),n=a("wkuu"),r=a.n(n),s=a("ctpb"),l=(a.n(s),a("SVvQ"));a.n(l);t.a={props:{propparam:Object},data:function(){return{floorPlanUrl:window.apiUrl+"/floors/img/",floorSrc:"",loading:!0,trafficFlowLoading:!0,tableKeyToId:{},tableIds:"",emitData:[],naturalWidth:0,naturalHeight:0,firstFlag:!0,orgids:"",starttime:"",endtime:"",legendAside:[],firstZoneName:"",myChart:{},colors:["#e35241","#d83965","#f39c38","#9036aa","#6041b0","#4054af","#4396ec","#4fb9d1","#3f9488","#97c05c","#154bee"],cacheNodeData:[],bgW:"",bgH:"",noDataImg:r.a}},computed:{},components:{},watch:{propparam:{handler:"refreshHandle",immediate:!0}},mounted:function(){},methods:{refreshHandle:function(t){var a=this;"/trafficdirection/ftml"===t.dateType&&(this.bgW=this.bgH="",this.loading=!0,this.emitData=t.data,this.axios.get("/floors",{params:{mallId:t.data.asis_org,_t:Date.parse(new Date)/1e3}}).then(function(i){var o=i.data;o.data.length>0?a.floorSrc=window.apiUrl+"/floors/img/"+o.data[0].floorPlan:(a.floorSrc=r.a,a.bgW="100%"),a.orgids=t.data.asis_org,a.starttime=t.data.asis_time,a.endtime=t.data.asis_time;var n=new Image;n.src=a.floorSrc;var s=a;n.onload=function(){s.naturalWidth=n.width,s.naturalHeight=n.height,e("#graphChart").height(e(".background-img").height()),s.getZones()},n.onerror=function(){s.floorSrc=s.noDataImg,s.$message({type:"info",message:"图片加载失败!"}),s.loading=!1}}))},getZones:function(){var e=this;this.legendAside=[],this.firstZoneName="",this.axios.get("/zones",{params:{mallId:this.emitData.asis_org,type:4,sortName:'"floor".name, "zone".name',_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data;if(a.data.forEach(function(t,a){e.legendAside.push({legendColor:e.colors[a],selected:0==a,name:t.name,id:t.id})}),a.data.length>0){var i=a.data[0].id;e.firstZoneName=a.data[0].name,e.getLinkData(i)}else e.drawNoData()}).catch(function(e){console.log(e.message)})},getLinkData:function(t){var a=this,i={};this.cacheNodeData=[],i={orgIds:this.emitData.asis_org,zoneIds:t,startDate:this.emitData.asis_time,endDate:this.emitData.asis_time,orgType:this.emitData.asis_level,ageStage:this.emitData.asis_age,gender:this.emitData.asis_gender,_t:Date.parse(new Date)/1e3},this.axios.get("/report/movingLine/faceMavingLines",{params:i}).then(function(t){var i=t.data,n=[],r=999999999,s=0,l=!1,c=[],d=[],h=[],g=null,f=null,m={};l=!i.data.node.some(function(e){return e.traffic>0}),i.data.node.forEach(function(e,t){0!=e.traffic&&e.traffic<r&&(r=e.traffic),0!=e.traffic&&e.traffic>s&&(s=e.traffic),d.push({name:e.zoneName,value:e.traffic}),h.push({name:e.zoneName,value:e.residence}),g+=e.traffic,f+=e.residence}),a.cacheNodeData=i.data.node,i.data.node.forEach(function(t,i){var l=[],u=[],p=(s==r||parseInt(10+(t.traffic-r)/(s-r)*90),(t.x/a.normalWidth*e(".background-img").width()).toFixed(2)),v=(t.y/a.normalHeight*e(".background-img").height()).toFixed(2),y={id:String(t.zoneId),name:t.zoneName,value:t.traffic,x:p>e(".background-img").width()?0:p,y:v>e(".background-img").height()?0:v,category:i};t.traffic||t.residence||(y.symbolSize=0),(t.traffic>0||t.residence>0)&&(l=JSON.parse(o()(d)),u=JSON.parse(o()(h)),l.forEach(function(e){e.name===t.zoneName&&(e.tooltip={show:!0,backgroundColor:"rgba(0, 0, 0, .5)",formatter:function(e){var t="",a="";return t+='<div style="font-size:14px;height:31px;color:#fff;border-radius:4px;line-height:31px;padding-left:15px;padding-right:15px; text-align: left;"> 遊逛次数: '+e.data.value+"</div><div>",a=(e.data.value/g*100).toFixed(2)+"%",t+='<p style="font-size:13px; padding:4px 15px; color:#fff; text-align: left;">占比: '+a+"</p>",t+="</div>"}},e.itemStyle={normal:{color:"#5FC5F5"},emphasis:{color:"#5FC5F5"}})}),u.forEach(function(e){e.name===t.zoneName&&(e.tooltip={show:!0,backgroundColor:"rgba(0, 0, 0, .5)",formatter:function(e){var t="",a="";return t+='<div style="font-size:14px;height:31px;color:#fff;border-radius:4px;line-height:31px;padding-left:15px;padding-right:15px; text-align: left;"> 滞留时间: '+e.data.value+"</div><div>",a=(e.data.value/f*100).toFixed(2)+"%",t+='<p style="font-size:13px; padding:4px 15px; color:#fff; text-align: left;">占比: '+a+"</p>",t+="</div>"}},e.itemStyle={normal:{color:"#8F99F0"},emphasis:{color:"#8F99F0"}})}),c.push([{type:"pie",id:"kl"+t.zoneId,radius:[20,0],center:[p,v],hoverAnimation:!1,label:{show:!1},labelLine:{show:!1},tooltip:{show:!1},itemStyle:{normal:{color:"#e0f5ff",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"#e0f5ff",label:{show:!1},labelLine:{show:!1}}},data:l},{type:"pie",id:"zl"+t.zoneId,radius:[30,24],center:[p,v],hoverAnimation:!1,label:{show:!1},labelLine:{show:!1},tooltip:{show:!1},itemStyle:{normal:{color:"#dbdffd",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"#dbdffd",label:{show:!1},labelLine:{show:!1}}},data:u}])),n.push(y),m[a.firstZoneName]=!0}),n.push({id:-1,name:"22",value:-1,x:0,y:0,symbolSize:0,label:{show:!1}},{id:-2,name:"11",value:-1,x:e(".background-img").width(),y:e(".background-img").height(),symbolSize:0,label:{show:!1}});var u=[],p=999999999999,v=0;i.data.line.forEach(function(e){u.push({target:String(e.target),source:String(e.source),value:e.value}),0!=e.value&&e.value<p&&(p=e.value),0!=e.value&&e.value>v&&(v=e.value)}),u.forEach(function(e,t){var i=p==v?1:a.calcSymbol(e.value,p,v,1,20);i=i<0?0:e.value?i:0;var o=p==v?10:a.calcSymbol(e.value,p,v,10,40);o=o<0?0:e.value?o:0,e.lineStyle={normal:{width:l?0:e.value?i:0}},e.symbolSize=e.value?String(l?0:o):"0"});var y=document.getElementById("graphChart");y.style.width=e(".background-img").width()+"px",a.$echarts.getInstanceByDom(y)?(a.$echarts.init(y).dispose(),a.myChart=a.$echarts.init(y)):a.myChart=a.$echarts.init(y);var b=[];b[0]={top:0,left:0,right:0,bottom:1,edgeSymbol:["none","arrow"],categories:a.legendAside,type:"graph",layout:"none",data:n,links:u,edgeSymbolSize:0,symbolSize:5,z:3,focusNodeAdjacency:!0,label:{normal:{show:!l,position:"right",formatter:"{b}:{c}"},emphasis:{show:!1}},lineStyle:{normal:{color:"source",opacity:.8,curveness:.3}}},c.forEach(function(e){b.push(e[0]),b.push(e[1])});var w={tooltip:{},legend:{type:"plain",icon:"circle",top:0,show:!1,selected:m,data:a.legendAside.map(function(e){return{name:e.name,id:e.id}})},color:a.colors,series:b};a.firstFlag||a.myChart.clear(),a.firstFlag=!1,a.myChart.clear(),a.myChart.setOption(w),setTimeout(function(){a.loading=!1},1e3)}).catch(function(e){console.log(e.message)}),window.addEventListener("resize",function(){try{var t=a,i=e(".background-img").width(),o=e(".background-img").height();if(e("#graphChart").height(o),e("#graphChart").width(i),t.myChart.resize({width:i,height:o}),console.log("resize",t.myChart),t.myChart){var n=t.myChart.getOption();t.cacheNodeData.forEach(function(e){var a=(e.x/t.normalWidth*i).toFixed(2),r=(e.y/t.normalHeight*o).toFixed(2);a=a>i?0:a,r=r>o?0:r,n.series.forEach(function(t){"pie"===t.type&&t.center instanceof Array&&t.id.slice(2)==e.zoneId&&(t.center=[a,r])})}),t.myChart.setOption(n)}}catch(e){}})},drawNoData:function(){var t=this,a=document.getElementById("graphChart");a.style.width=e(".background-img").width()+"px",this.$echarts.getInstanceByDom(a)?(this.$echarts.init(a).dispose(),this.myChart=this.$echarts.init(a)):this.myChart=this.$echarts.init(a);var i={};i={tooltip:{},graphic:{type:"text",left:"center",top:"middle",z:100,style:{fill:"#333",text:this.$t("echartsTitle.noData"),font:'14px "PingFang SC", "Lantinghei SC", "Microsoft YaHei", "HanHei SC", "Helvetica Neue", "Open Sans", Arial, "Hiragino Sans GB", 微软雅黑, STHeiti, "WenQuanYi Micro Hei", SimSun, sans-serif'}}},this.firstFlag||this.myChart.clear(),this.firstFlag=!1,this.myChart.clear(),this.myChart.setOption(i),setTimeout(function(){t.loading=!1},1e3)},checkLegend:function(e,t){this.legendAside[t].selected=!e;var a="";this.legendAside.forEach(function(e){e.selected&&(a+=e.id+",")}),a=a.replace(/\,$/,""),this.getLinkData(a)},computeSize:function(e,t,a){return a=a||1,e/a>t?(a+=1,this.computeSize(e,t,a)):a},calcSymbol:function(e,t,a,i,o){return(e-t)/(a-t)*(o-i)+i}}}}).call(t,a("7t+N"))},moER:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("g2Ji"),o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"daily"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"graph-container"},[a("div",{staticClass:"graph-rel"},[a("ul",{staticClass:"legend-container"},e._l(e.legendAside,function(t,i){return a("li",{key:i,staticClass:"legend-item",on:{click:function(a){e.checkLegend(t.selected,i)}}},[a("span",{staticClass:"legend-circle",style:{backgroundColor:t.selected?t.legendColor:"#e5e5e5"}}),e._v(" "),a("span",{staticClass:"legend-text"},[e._v(e._s(t.name))])])})),e._v(" "),a("img",{staticClass:"background-img",style:{width:e.bgW,height:e.bgH},attrs:{src:e.floorSrc,alt:"",onerror:e.noDataImg}}),e._v(" "),a("div",{staticClass:"graph-box",attrs:{id:"graphChart"}})])])])},staticRenderFns:[]},n=function(e){a("Gba7")},r=a("VU/8")(i.a,o,!1,n,"data-v-5d3da4ca",null);t.default=r.exports}});