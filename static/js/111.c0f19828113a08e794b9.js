webpackJsonp([111],{PXba:function(t,e){},Su8I:function(t,e,a){"use strict";(function(t){var i=a("wkuu"),r=a.n(i),n=a("ctpb"),s=(a.n(n),a("SVvQ"));a.n(s);e.a={props:{propparam:Object},data:function(){return{emitData:{},loading:!0,tableIds:"",tableKeyToId:{},params:{},graphBg:"",myEchart:{},firstFlag:!0,tableData:[],tableHeight:0,showTable:!0,colors:["#e35241","#d83965","#f39c38","#9036aa","#6041b0","#4054af","#4396ec","#4fb9d1","#3f9488","#97c05c","#154bee"],bgW:"",bgH:""}},components:{},watch:{propparam:{handler:"refreshHandle",immediate:!0}},created:function(){var e=t(window).height();this.tableHeight=e-.24*e},mounted:function(){},methods:{refreshHandle:function(e){var a=this;"/moveline/trackline"===e.dateType&&(this.bgH=this.bgW="",this.emitData=e.data,this.loading=!0,this.axios.get("/floors",{params:{mallId:e.data.asis_org,_t:Date.parse(new Date)/1e3}}).then(function(e){var i=e.data;i.data.length>0?a.graphBg=window.apiUrl+"/floors/img/"+i.data[0].floorPlan:(a.graphBg=r.a,a.bgW="100%");var n=a,s=new Image;s.src=a.graphBg,s.width=t(".graph-background").width(),s.height=t(".graph-background").height(),s.onload=function(){n.naturalWidth=n.normalWidth,n.naturalHeight=n.normalHeight,t("#tfGraph").height(t(".graph-background").height()),n.getTableData()}}))},collapse:function(){this.showTable=!this.showTable},checkLegend:function(t,e){var a=this.myEchart.getOption();a.legend[0].selected[this.tableData[e].legendName]=t,this.myEchart.setOption(a)},textHidden:function(t){var e=t.toString();return e.length>32?e.substring(0,31)+"...":e},getTableData:function(){var e=this,a={orgIds:this.emitData.asis_org,startDate:this.emitData.asis_time,endDate:this.emitData.asis_time,orgType:this.emitData.asis_level,zoneSize:this.emitData.asis_zonenum,ageStage:this.emitData.asis_age,gender:this.emitData.asis_gender,_t:Date.parse(new Date)/1e3};this.axios.get("/report/movingLine/customerLines",{params:a}).then(function(a){var i=a.data;e.tableData=[];var r=999999999,n=0,s=!1;i.data.length>0&&(s=!i.data.some(function(t){return t.size>0}),i.data.forEach(function(a,i){e.tableData.push({tabOrder:i+1,trackName:a.name,trafficNum:a.size,legendName:"top"+(i+1),legendColor:e.colors[i],selected:!0}),0!=a.size&&a.size<r&&(r=a.size),0!=a.size&&a.size>n&&(n=a.size),a.nodes.push({id:-1,name:"22",value:-1,x:0,y:0,symbolSize:0,label:{show:!1}},{id:-2,name:"11",value:-1,x:t(".graph-background").width(),y:t(".graph-background").height(),symbolSize:5,label:{show:!1}})}),i.data.forEach(function(a,i){a.nodes.forEach(function(r){-1!=r.id&&-2!=r.id&&(r.x=(r.x/e.normalWidth*t(".graph-background").width()).toFixed(2),r.y=(r.y/e.normalHeight*t(".graph-background").height()).toFixed(2),r.value=a.size,r.symbolSize=a.size?15:0,r.label={normal:{show:!0,position:"right",formatter:"{b}"}}),r.category="top"+(i+1)})})),e.drawGraph(i.data,s,n,r)}).catch(function(t){console.log(t)})},drawGraph:function(e,a,i,r){var n=document.getElementById("tfGraph");n.style.width=t(".graph-background").width()+"px",this.$echarts.getInstanceByDom(n)?(this.$echarts.init(n).dispose(),this.myEchart=this.$echarts.init(n)):this.myEchart=this.$echarts.init(n);var s={};if(e.length>0){var o={};e.forEach(function(t,e){o["top"+(e+1)]=!0});var l=this;s={title:{text:""},color:this.colors,tooltip:{},legend:{type:"scroll",show:!1,orient:"vertical",top:0,right:0,itemWidth:14,itemHeight:14,selected:o,data:e.map(function(t,e){return{name:"top"+(e+1),icon:"circle"}})},series:e.map(function(t,n){return{type:"graph",top:0,left:0,right:0,bottom:1,animation:!1,categories:e.map(function(t,e){return{name:"top"+(e+1)}}),lineStyle:{color:l.colors[n],opacity:.8,curveness:.1*n/2+.05},data:t.nodes.map(function(t){return t}),edgeSymbolSize:0,edgeSymbol:["none","arrow"],tooltip:{formatter:function(t){var e="";return e+='<div style="font-size:14px;height:31px;color:#fff;border-radius:4px;line-height:31px;padding-left:10px;padding-right:10px; text-align: left;">轨迹 : top'+(t.seriesIndex+1)+"</div><div>",e+='<p style="font-size:13px; padding:4px 10px; color:#fff; text-align: left;">客流量 : '+t.data.value+"人</p>",e+="</div>"}},links:t.links.map(function(e,n){e.value=t.size;var s=r==i?1:l.calcSymbol(t.size,r,i,1,20);s=s<0?0:t.size?s:0;var o=r==i?10:l.calcSymbol(t.size,r,i,10,40);return o=o<0?0:t.size?o:0,e.lineStyle={normal:{width:a?0:s}},e.symbolSize=t.size?String(a?0:o):"0",e})}})}}else s={title:{text:""},tooltip:{},graphic:{type:"text",left:"center",top:"middle",z:100,style:{fill:"#333",text:this.$t("echartsTitle.noData"),font:'14px "PingFang SC", "Lantinghei SC", "Microsoft YaHei", "HanHei SC", "Helvetica Neue", "Open Sans", Arial, "Hiragino Sans GB", 微软雅黑, STHeiti, "WenQuanYi Micro Hei", SimSun, sans-serif'}}};this.firstFlag||this.myEchart.clear(),this.firstFlag=!1,this.myEchart.clear(),this.myEchart.setOption(s),this.loading=!1},computeSize:function(t,e,a){return a=a||1,t/a>e?(a+=1,this.computeSize(t,e,a)):a}}}}).call(e,a("7t+N"))},a4yw:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Su8I"),r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"customgroup-wrapper"},[a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("el-col",{attrs:{span:10}},[a("div",{staticClass:"tab-container"},[a("el-table",{staticClass:"track-line-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[a("el-table-column",{attrs:{prop:"tabOrder",align:"center",label:t.$t("table.order"),width:"60"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.trackName"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"right",title:"",trigger:"hover"}},[a("span",{attrs:{slot:"reference"},slot:"reference"},[a("span",[t._v(t._s(e.row.trackName))])]),t._v(" "),a("span",[t._v(t._s(e.row.trackName))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"trafficNum",label:t.$t("table.trafficNum"),align:"center",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.showTrack"),align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{staticClass:"track-checkbox",on:{change:function(a){t.checkLegend(e.row.selected,e.$index)}},model:{value:e.row.selected,callback:function(a){t.$set(e.row,"selected",a)},expression:"scope.row.selected"}},[a("span",{staticClass:"legend-span",style:{backgroundColor:e.row.selected?e.row.legendColor:"#e5e5e5"}})])]}}])})],1)],1)]),t._v(" "),a("el-col",{staticClass:"p-col",attrs:{span:14}},[a("div",{staticClass:"tf-container"},[a("div",{staticClass:"tf-graph-container"},[a("img",{staticClass:"graph-background",style:{width:t.bgW,height:t.bgH},attrs:{src:t.graphBg}}),t._v(" "),a("div",{staticClass:"tf-graph-box",attrs:{id:"tfGraph"}})])])])],1)],1)},staticRenderFns:[]},n=function(t){a("PXba")},s=a("VU/8")(i.a,r,!1,n,"data-v-0c2b9ff0",null);e.default=s.exports}});