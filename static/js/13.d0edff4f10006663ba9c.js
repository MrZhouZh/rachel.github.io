webpackJsonp([13],{"1RZA":function(t,e){},B2PR:function(t,e,a){"use strict";(function(t){var l=a("PAnj"),i=a.n(l);e.a={data:function(){return{editDialogVisible:!1,editForm:{floorPlan:""},floorUploadUrl:window.apiUrl+"/floors/upload",mallList:[],uploadHeader:{},rules:{name:[{required:!0,message:"请输入楼层名称",trigger:"blur"}],mallId:[{required:!0,message:"请选择门店",trigger:"change"}]},isIe:null}},mounted:function(){this.uploadHeader={Authorization:this.$cookie.get("atoken")},this.isIe=!!document.documentMode&&document.documentMode},methods:{update:function(){var e=this;t("#fileForm").ajaxSubmit({url:e.floorUploadUrl,type:"post",enctype:"multipart/form-data",dataType:"text",ContentType:"application/x-www-form-urlencoded;charset=utf-8",headers:e.uploadHeader,success:function(a){t("#fileForm").clearForm(),200==a.code&&(e.editForm.floorPlan=a.msg,console.log(e.editForm.floorPlan))}})},dialogInit:function(t){this.rowId=t.id,this.editForm=t,this.editForm.floorPlan=t.floorPlan?t.floorPlan:"",this.editDialogVisible=!0},dialogOpen:function(t){t.accountId=this.$cookie.get("accountId"),this.getMallList(t.accountId)},getMallList:function(t){var e=this;this.mallList=[],this.axios.get("/malls",{params:{accountId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data;e.mallList=a.data}).catch(function(t){})},beforeAvatarUpload:function(t){var e="image/svg+xml"===t.type||"image/jpeg"===t.type;return e||this.$message.error(this.$t("message.uploadImg")+" JPG "+this.$t("message.or")+" SVG "+this.$t("message.imgFormat")),e},handleEditSuccess:function(t,e){this.editFileName=t.msg,this.editForm.floorPlan=URL.createObjectURL(e.raw),this.$forceUpdate()},handleAvatarError:function(t,e){this.$message({showClose:!0,message:this.$t("message.bind"),type:"warning"})},editSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;e.editForm.accountId=e.$cookie.get("accountId"),e.editForm.floorPlan=e.editFileName?e.editFileName:e.editForm.floorPlan,e.axios.post("/floors/"+e.rowId,e.editForm).then(function(t){e.editDialogVisible=!1,e.$parent.getTableData()}).catch(function(t){})})},editDialogClose:function(){this.$refs.editForm.clearValidate(),this.editForm={floorPlan:""},this.editFileName=""},floorPlanFormatter:function(t){if(console.log(t),t){if(-1!=t.indexOf("blob:"))return t;return window.apiUrl+"/floors/img/"+t}return i.a}}}}).call(e,a("7t+N"))},MlzA:function(t,e){},UV3r:function(t,e,a){"use strict";var l=a("zeSq"),i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"manage-dialog",attrs:{title:t.$t("button.addFloor"),visible:t.addDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.addDialogVisible=e},open:function(e){t.dialogOpen(t.addForm)},close:t.addDialogClose}},[a("el-form",{ref:"addForm",attrs:{model:t.addForm,"status-icon":"",rules:t.rules}},[a("el-form-item",{attrs:{label:t.$t("table.floorName"),prop:"name"}},[a("el-input",{model:{value:t.addForm.name,callback:function(e){t.$set(t.addForm,"name",e)},expression:"addForm.name"}}),t._v(" "),a("i",{staticClass:"error-tip"},[t._v("*")])],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.state"),prop:"status"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:t.$t("pholder.state")},model:{value:t.addForm.status,callback:function(e){t.$set(t.addForm,"status",e)},expression:"addForm.status"}},[a("el-option",{attrs:{label:t.$t("pholder.state1"),value:1}}),t._v(" "),a("el-option",{attrs:{label:t.$t("pholder.state2"),value:2}})],1)],1),t._v(" "),t.isIe<=9&&"number"==typeof t.isIe?a("el-form-item",{attrs:{label:t.$t("dialog.logo"),prop:"logoPath"}},[t.addForm.floorPlan?a("img",{staticClass:"avatar",attrs:{src:t.floorPlanFormatter(t.addForm.floorPlan)}}):t._e(),t._v(" "),a("form",{attrs:{id:"fileForm",enctype:"multipart/form-data",methods:"post"}},[a("input",{attrs:{type:"file",id:"fileInput",name:"file"},on:{change:t.update}})])]):a("el-form-item",{attrs:{label:t.$t("table.floorPlan"),prop:"floorPlan"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:t.floorUploadUrl,headers:t.uploadHeader,"show-file-list":!1,"before-upload":t.beforeAvatarUpload,"on-success":t.handleAvatarSuccess,"on-error":t.handleAvatarError}},[t.addForm.floorPlan?a("img",{staticClass:"avatar",attrs:{src:t.addForm.floorPlan}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),t._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("图片尺寸推荐 3x4 比例")])])],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.externalNum"),prop:"externalId"}},[a("el-input",{model:{value:t.addForm.externalId,callback:function(e){t.$set(t.addForm,"externalId",t._n(e))},expression:"addForm.externalId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.square"),prop:"mallId"}},[a("el-select",{staticClass:"manage-sel",attrs:{filterable:"",placeholder:t.$t("pholder.select"),"no-data-text":t.$t("pholder.nodata")},model:{value:t.addForm.mallId,callback:function(e){t.$set(t.addForm,"mallId",e)},expression:"addForm.mallId"}},t._l(t.mallList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),t._v(" "),a("i",{staticClass:"error-tip"},[t._v("*")])],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.describe")}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.addForm.intro,callback:function(e){t.$set(t.addForm,"intro",e)},expression:"addForm.intro"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(e){t.addDialogVisible=!1}}},[t._v(t._s(t.$t("dialog.cancel")))]),t._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(e){t.addSubmit("addForm")}}},[t._v(t._s(t.$t("dialog.confirm")))])],1)],1)},staticRenderFns:[]},o=function(t){a("1RZA")},s=a("VU/8")(l.a,i,!1,o,"data-v-e85e0170",null);e.a=s.exports},VAEt:function(t,e,a){"use strict";var l=a("mvHQ"),i=a.n(l),o={data:function(){return{bindVisible:!1,bindFloorId:"",bindVal:"",floorAllGate:[],gateList:[],bindGateList:[],noDataText:"",bindBtnDisabled:!1,cancelBtnDisabled:!1}},created:function(){},methods:{dialogInit:function(t){this.bindFloorId=t.id,this.getFloorAllGate(t.mallId),this.bindVisible=!0},getFloorAllGate:function(t){var e=this;this.floorAllGate=[],this.axios.get("/gates",{params:{mallId:t,status:1,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data;a.data.forEach(function(t){t.label=t.name,t.value=t.id,t.isMallGate=t.isMallGate}),e.floorAllGate=a.data,e.getFloorGates(e.bindFloorId)}).catch(function(t){})},getFloorGates:function(t){var e=this;this.gateList=[],this.bindGateList=[],this.axios.get("/floorGates",{params:{floorId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data,l={},o={};a.data.length>=0&&(e.floorAllGate.forEach(function(t){(o={}).label=t.label,o.value=t.value,o.isCheck=!1,o.className="gate-item",o.type=0,e.gateList.push(o)}),a.data.forEach(function(t){e.floorAllGate.forEach(function(a){a.id==t.gateId&&((l={}).label=a.label,l.value=a.value,l.isCheck=!1,l.className="gate-item",l.type=t.type,1==t.type?(l.btnColor="#3BB8FF",l.direction="正向"):(l.btnColor="#87D14B",l.direction="反向"),l.id=t.id,e.bindGateList.push(l))})}),0==e.gateList.length&&(e.noDataText="数据为空")),window.sessionStorage.setItem("bindlist",i()(e.gateList))}).catch(function(t){})},filterGateList:function(){var t=this.bindVal.replace(/\s+/g,"").toLocaleLowerCase(),e=JSON.parse(window.sessionStorage.getItem("bindlist"));if(""!=t){var a=[];this.gateList.filter(function(e){-1!==e.label.toLocaleLowerCase().indexOf(t)&&a.push(e)}),0==a.length&&e.forEach(function(e){-1!==e.label.toLocaleLowerCase().indexOf(t)&&a.push(e)}),0==a.length&&(this.noDataText="未找到匹配数据"),this.gateList=a}else this.gateList=e},checkGate:function(t){this.gateList[t].isCheck||(this.curCheckGate={},this.gateList.forEach(function(t){t.isCheck=!1,t.className="gate-item"}),this.gateList[t].isCheck=!0,this.gateList[t].className="gate-item gate-item-checked",this.curCheckGate=this.gateList[t])},bindClick:function(t){var e=this;if(this.curCheckGate.value){this.bindBtnDisabled=!0;var a=void 0,l="",o="";switch(t){case"positive":a="正向",l="#3BB8FF",o=1;break;case"reverse":a="反向",l="#87D14B",o=2;break;case"heating":a="热力",l="#000",o=4}var s="";if(this.bindGateList.forEach(function(t){t.value==e.curCheckGate.value&&(s=t.type==o?"same":1!=t.type&&2!=t.type||1!=o&&2!=o?4==t.type&&4==o?"heating":"":"posRev")}),"same"===s)return this.$message({showClose:!0,type:"warning",message:this.$t("message.bindGate")}),void(this.bindBtnDisabled=!1);if("posRev"===s)return this.$message({showClose:!0,type:"warning",message:this.$t("message.alreadyBound")}),void(this.bindBtnDisabled=!1);if("heating"===s)return this.$message({showClose:!0,type:"warning",message:this.$t("message.alreadyBound")}),void(this.bindBtnDisabled=!1);var n={};this.axios.post("/floorGates",{floorId:this.bindFloorId,gateId:this.curCheckGate.value,type:o,createUser:this.$cookie.get("userId"),modifyUser:this.$cookie.get("userId")}).then(function(t){200==t.data.code?((n=JSON.parse(i()(e.curCheckGate))).id=t.data.data.id,n.type=o,n.direction=a,n.btnColor=l,e.bindGateList.push(n),window.sessionStorage.setItem("bindlist",i()(e.gateList)),0==e.gateList.length&&(e.noDataText=e.$t("echartsTitle.noData")),e.$parent.getTableData()):e.$message({showClose:!0,type:"info",message:e.$t("message.bind")+t.data.msg}),e.bindBtnDisabled=!1}).catch(function(t){})}},cancelBind:function(t){var e=this,a={};this.$confirm(this.$t("message.confirDelete"),this.$t("message.prompt"),{confirmButtonText:this.$t("message.confirm"),cancelButtonText:this.$t("message.cancel"),type:"warning"}).then(function(){e.cancelBtnDisabled=!0,e.axios.delete("/floorGates/"+e.bindGateList[t].id,{params:{}}).then(function(l){200==l.data.code?((a=JSON.parse(i()(e.bindGateList[t]))).isCheck=!1,a.className="gate-item",e.bindGateList.splice(t,1)):e.$message({showClose:!0,type:"info",message:e.$t("message.uploadFailed")+l.data.msg}),e.cancelBtnDisabled=!1}).catch(function(t){console.log("catch:",t,t.message),e.cancelBtnDisabled=!1})}).catch(function(t){})},closeBindDialog:function(){this.gateList.forEach(function(t){t.isCheck=!1,t.className="gate-item"}),this.bindVal="",this.bindGateList.length=0,this.noDataText="load"}},beforeDestroy:function(){window.sessionStorage.removeItem("bindlist")}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"manage-dialog bind-dialog bind-middle-dialog",attrs:{title:"监控点绑定",visible:t.bindVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.bindVisible=e},close:t.closeBindDialog}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"gate-list-wrapper"},[a("div",{staticClass:"origin-input-box"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.bindVal,expression:"bindVal"}],staticClass:"origin-input__inner",attrs:{type:"value",placeholder:"请输入监控点名称"},domProps:{value:t.bindVal},on:{keyup:t.filterGateList,input:function(e){e.target.composing||(t.bindVal=e.target.value)}}}),t._v(" "),a("i",{staticClass:"el-icon-search bind-search"})]),t._v(" "),a("el-scrollbar",{staticStyle:{height:"100%","max-height":"306px"},attrs:{"wrap-class":"list-scrollbar",native:!1}},[a("ul",{staticClass:"gate-list-left"},[t._l(t.gateList,function(e,l){return a("li",{key:l,class:e.className,on:{click:function(e){t.checkGate(l)}}},[a("span",{staticClass:"gate-item-text",attrs:{title:e.label}},[t._v(t._s(e.label))]),t._v(" "),e.isCheck?a("i",{staticClass:"el-icon-circle-check checked-icon"}):t._e()])}),t._v(" "),0==t.gateList.length?a("li",[t._v(t._s(t.noDataText))]):t._e()],2)])],1)]),t._v(" "),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"bind-btn-box"},[a("div",{staticClass:"lg-wrapper"},[a("el-button",{staticClass:"bind-btn",attrs:{disabled:t.bindBtnDisabled},on:{click:function(e){t.bindClick("positive")}}},[t._v("正向绑定"),a("i",{staticClass:"el-icon-d-arrow-right el-icon--right right-icon"})]),t._v(" "),a("el-button",{staticClass:"bind-btn reverse-btn",attrs:{disabled:t.bindBtnDisabled},on:{click:function(e){t.bindClick("reverse")}}},[t._v("反向绑定"),a("i",{staticClass:"el-icon-d-arrow-right el-icon--right right-icon"})]),t._v(" "),a("el-button",{staticClass:"bind-btn reverse-btn",staticStyle:{background:"#000"},attrs:{disabled:t.bindBtnDisabled},on:{click:function(e){t.bindClick("heating")}}},[t._v("热力绑定"),a("i",{staticClass:"el-icon-d-arrow-right el-icon--right right-icon"})])],1)])]),t._v(" "),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"gate-list-wrapper"},[a("p",{staticClass:"band-box"},[t._v("已绑定监控点")]),t._v(" "),a("el-scrollbar",{staticStyle:{height:"100%","max-height":"306px"},attrs:{"wrap-class":"list-scrollbar",native:!1}},[a("ul",{staticClass:"gate-list-left"},t._l(t.bindGateList,function(e,l){return a("li",{key:l,class:t.cancelBtnDisabled?"bind-gate-item bind-disabled":"bind-gate-item",on:{click:function(e){t.cancelBind(l)}}},[a("el-button",{staticClass:"gate-btn",style:{"border-color":e.btnColor},attrs:{title:e.label+e.direction}},[t._v(t._s(e.label+" "+e.direction))]),t._v(" "),a("i",{staticClass:"el-icon-circle-close gate-close-btn",attrs:{title:"取消绑定"}})],1)}))])],1)])],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(e){t.bindVisible=!1}}},[t._v("关 闭")])],1)],1)},staticRenderFns:[]},n=a("VU/8")(o,s,!1,null,null,null);e.a=n.exports},c5AV:function(t,e,a){"use strict";var l=a("B2PR"),i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"manage-dialog",attrs:{title:t.$t("dialog.editFloor"),visible:t.editDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.editDialogVisible=e},open:function(e){t.dialogOpen(t.editForm)},close:function(e){t.editDialogClose()}}},[a("el-form",{ref:"editForm",attrs:{model:t.editForm,rules:t.rules}},[a("el-form-item",{attrs:{label:t.$t("table.floorName"),prop:"name"}},[a("el-input",{model:{value:t.editForm.name,callback:function(e){t.$set(t.editForm,"name",e)},expression:"editForm.name"}}),t._v(" "),a("i",{staticClass:"error-tip"},[t._v("*")])],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.state"),prop:"status"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:t.$t("pholder.state")},model:{value:t.editForm.status,callback:function(e){t.$set(t.editForm,"status",e)},expression:"editForm.status"}},[a("el-option",{attrs:{label:t.$t("pholder.state1"),value:1}}),t._v(" "),a("el-option",{attrs:{label:t.$t("pholder.state2"),value:2}})],1),t._v(" "),a("i",{staticClass:"error-tip"},[t._v("*")])],1),t._v(" "),t.isIe<=9&&"number"==typeof t.isIe?a("el-form-item",{attrs:{label:t.$t("dialog.logo"),prop:"logoPath"}},[t.editForm.floorPlan?a("img",{staticClass:"avatar",attrs:{src:t.floorPlanFormatter(t.editForm.floorPlan)}}):t._e(),t._v(" "),a("form",{attrs:{id:"fileForm",enctype:"multipart/form-data",methods:"post"}},[a("input",{attrs:{type:"file",id:"fileInput",name:"file"},on:{change:t.update}})])]):a("el-form-item",{attrs:{label:t.$t("table.floorPlan"),prop:"floorPlan"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:t.floorUploadUrl,headers:t.uploadHeader,"show-file-list":!1,"before-upload":t.beforeAvatarUpload,"on-success":t.handleEditSuccess,"on-error":t.handleAvatarError}},[t.editForm.floorPlan?a("img",{staticClass:"avatar",attrs:{src:t.floorPlanFormatter(t.editForm.floorPlan)}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),t._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("图片尺寸推荐 3x4 比例")])])],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.externalNum"),prop:"externalId"}},[a("el-input",{model:{value:t.editForm.externalId,callback:function(e){t.$set(t.editForm,"externalId",e)},expression:"editForm.externalId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.square"),prop:"mallId"}},[a("el-select",{staticClass:"manage-sel",attrs:{filterable:"",placeholder:t.$t("pholder.select"),disabled:"","no-data-text":t.$t("pholder.nodata")},model:{value:t.editForm.mallId,callback:function(e){t.$set(t.editForm,"mallId",e)},expression:"editForm.mallId"}},t._l(t.mallList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),t._v(" "),a("i",{staticClass:"error-tip"},[t._v("*")])],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.describe")}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.editForm.intro,callback:function(e){t.$set(t.editForm,"intro",e)},expression:"editForm.intro"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(e){t.editDialogVisible=!1}}},[t._v(t._s(t.$t("dialog.cancel")))]),t._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(e){t.editSubmit("editForm")}}},[t._v(t._s(t.$t("dialog.confirm")))])],1)],1)},staticRenderFns:[]},o=a("VU/8")(l.a,i,!1,null,null,null);e.a=o.exports},iIPX:function(t,e,a){"use strict";(function(t){var l,i=a("bOdI"),o=a.n(i),s=a("mvHQ"),n=a.n(s),r=a("PAnj"),c=a.n(r),d=a("UV3r"),u=a("c5AV"),m=a("VAEt");e.a={data:function(){return{blocValue:"",blocList:[],mallValue:"",mallListForTerm:[],tableHeight:0,name_like:"",rowId:"",tableData:[],total:0,pageSize:10,currentPage:1,accountList:[],cStatus:1,isSup:null}},components:{"add-floor-dialog":d.a,"edit-floor-dialog":u.a,"bind-gate-dialog":m.a},created:function(){var e=t(window).height();this.tableHeight=e-.24*e,this.isSup="super"===this.$cookie.get("user_type"),this.getAccountList()},mounted:function(){},methods:(l={getTableData:function(){var t=this,e={accountId:this.blocValue,mallId:this.mallValue,name_like:"%"+this.name_like+"%",status:this.cStatus?this.cStatus:null,page:this.currentPage,pageSize:this.pageSize,_t:Date.parse(new Date)/1e3};this.name_like||(e.name_like=null),this.axios.get("/floors",{params:e}).then(function(e){t.tableData=[];var a=e.data;a.data.list.forEach(function(e,a){e.tabOrder=(t.currentPage-1)*t.pageSize+a+1,e.children=[]}),t.tableData=a.data.list,t.total=a.data.total}).catch(function(t){})},sizeChange:function(t){this.pageSize=t,this.getTableData()},cerrentChange:function(t){this.currentPage!=t&&(this.currentPage=t,this.getTableData())},mallChange:function(){this.setSessionLocal("manageMallId",this.mallValue)},addFloorHandle:function(){this.$refs.addfloorModel.dialogInit(this.mallValue)},bindRow:function(t){this.$refs.bindgateModel.dialogInit(t)},editRow:function(t){this.rowId=t.id;var e=JSON.parse(n()(t));this.$refs.editfloorModel.dialogInit(e)},changeStatus:function(t){var e=this;2!==t.status&&this.axios.post("/floors/"+t.id,{status:2}).then(function(t){e.getTableData()}).catch(function(t){})},deleteRow:function(t,e){var a=this;this.$confirm(this.$t("message.delete"),this.$t("message.prompt"),{confirmButtonText:this.$t("message.confirm"),cancelButtonText:this.$t("message.cancel"),type:"warning"}).then(function(){var l=e[t].id;a.axios.delete("/floors/"+l,{params:{}}).then(function(a){e.splice(t,1)}).catch(function(t){})}).catch(function(){a.$message({showClose:!0,type:"info",message:a.$t("message.cancelDelete")})})},searchFun:function(){this.currentPage=1,this.getTableData()},dateFormatter:function(t,e,a){if(a.split(" "))return a.split(" ")[0]},statusFormatter:function(t,e,a,l){return a=1==a?this.$t("table.stateA"):this.$t("table.stateB")},floorPlanFormatter:function(t){if(t){return window.apiUrl+"/floors/img/"+t}return c.a}},o()(l,"statusFormatter",function(t,e,a){return a=1==a?this.$t("pholder.state1"):this.$t("pholder.state2")}),o()(l,"getAccountList",function(){this.blocValue=this.$cookie.get("accountId"),this.getMallListForTerm(this.blocValue,!0)}),o()(l,"blocChange",function(){this.getMallListForTerm(this.blocValue)}),o()(l,"getMallListForTerm",function(t,e){var a=this;this.mallListForTerm=[],this.mallValue="",this.axios.get("/malls",{params:{accountId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){var l=t.data;a.mallListForTerm=l.data,a.getSessionLocal("manageMallId")?a.mallValue=Number(a.getSessionLocal("manageMallId")):(a.mallListForTerm.forEach(function(t,e,l){0==e&&(a.mallValue=t.id)}),a.setSessionLocal("manageMallId",a.mallValue)),e&&a.getTableData()}).catch(function(t){})}),l)}}).call(e,a("7t+N"))},mIrA:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("iIPX"),i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"manage-container floorManage-wrapper"},[a("el-row",{staticClass:"manage-head-wrapper"},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"manage-select-box"},[a("el-select",{attrs:{filterable:"",placeholder:"广场选择"},on:{change:t.mallChange},model:{value:t.mallValue,callback:function(e){t.mallValue=e},expression:"mallValue"}},t._l(t.mallListForTerm,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("div",{staticClass:"manage-select-box status-box"},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:t.$t("pholder.state")},model:{value:t.cStatus,callback:function(e){t.cStatus=e},expression:"cStatus"}},[a("el-option",{attrs:{label:t.$t("pholder.allstate"),value:""}}),t._v(" "),a("el-option",{attrs:{label:t.$t("pholder.state1"),value:1}}),t._v(" "),a("el-option",{attrs:{label:t.$t("pholder.state2"),value:2}})],1)],1),t._v(" "),a("div",{staticClass:"manage-input-box"},[a("el-input",{staticClass:"search-inp",attrs:{size:"mini",placeholder:t.$t("pholder.floor"),clearable:""},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.searchFun(e)}},model:{value:t.name_like,callback:function(e){t.name_like=e},expression:"name_like"}})],1),t._v(" "),a("el-button",{staticClass:"search-btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.searchFun}},[t._v(t._s(t.$t("button.search")))])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-button",{staticClass:"manage-add-btn",attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.addFloorHandle}},[t._v(t._s(t.$t("button.addFloor")))])],1)],1),t._v(" "),a("el-row",{staticClass:"manage-content"},[a("el-col",{attrs:{span:24}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"max-height":t.tableHeight,"empty-text":t.$t("echartsTitle.noData"),"header-row-class-name":"manage-tab-head"}},[a("el-table-column",{attrs:{prop:"tabOrder",align:"center",label:t.$t("table.order"),width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:t.$t("table.floorName"),align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"floorPlan","header-align":"center",label:t.$t("table.floorPlan"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"right",title:"",trigger:"hover"}},[a("img",{staticClass:"zoomout-img",attrs:{src:t.floorPlanFormatter(e.row.floorPlan),width:"300",height:"300"}}),t._v(" "),a("img",{staticClass:"face-img",attrs:{slot:"reference",src:t.floorPlanFormatter(e.row.floorPlan),alt:e.row.floorPlan,width:"50",height:"50"},slot:"reference"})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"externalId",label:t.$t("table.externalNum"),align:"center",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"mall.name",label:t.$t("table.square"),align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",formatter:t.statusFormatter,align:"center",label:t.$t("table.state")}}),t._v(" "),a("el-table-column",{attrs:{prop:"intro",label:t.$t("table.describe"),align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.monitorSiteBind"),align:"center",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.bindRow(e.row)}}},[t._v(t._s(t.$t("button.unbind")))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.operate"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.editRow(e.row)}}},[t._v(t._s(t.$t("button.edit")))]),t._v(" "),a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.changeStatus(e.row)}}},[t._v(t._s(t.$t("button.disable")))])]}}])})],1),t._v(" "),a("el-pagination",{staticClass:"manage-pagination-box",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,50,100],"page-size":t.pageSize,layout:"sizes, prev, pager, next, slot",total:t.total},on:{"size-change":t.sizeChange,"current-change":t.cerrentChange}},[a("span",{staticClass:"slot-pagination-ele slot-ele-total"},[t._v(t._s(t.$t("table.pageHead"))+" "+t._s(t.total)+" "+t._s(t.$t("table.pageTail")))])])],1)],1),t._v(" "),a("add-floor-dialog",{ref:"addfloorModel"}),t._v(" "),a("edit-floor-dialog",{ref:"editfloorModel"}),t._v(" "),a("bind-gate-dialog",{ref:"bindgateModel"})],1)},staticRenderFns:[]},o=function(t){a("MlzA")},s=a("VU/8")(l.a,i,!1,o,"data-v-a5041d00",null);e.default=s.exports},zeSq:function(t,e,a){"use strict";(function(t){e.a={data:function(){return{addDialogVisible:!1,mallList:[],uploadHeader:{},addForm:{name:"",floorPlan:"",externalId:"",mallId:"",intro:""},addFileName:"",floorUploadUrl:window.apiUrl+"/floors/upload",rules:{name:[{required:!0,message:"请输入楼层名称",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}],mallId:[{required:!0,message:"请选择广场",trigger:"change"}]},curMallId:null,isIe:null}},components:{},mounted:function(){this.uploadHeader={Authorization:this.$cookie.get("atoken")},this.isIe=!!document.documentMode&&document.documentMode},methods:{update:function(){var e=this;t.support.cors=!0,t("#fileForm").ajaxSubmit({url:e.floorUploadUrl,type:"post",enctype:"multipart/form-data",dataType:"text",ContentType:"application/x-www-form-urlencoded;charset=utf-8",beforeSubmit:function(t,e,a){console.log("before submit",t,e,a)},headers:e.uploadHeader,success:function(a){t("#fileForm").clearForm(),200==a.code&&(e.addForm.floorPlan=a.msg)}})},dialogInit:function(t){this.curMallId=t,this.addDialogVisible=!0},dialogOpen:function(t){t.accountId=this.$cookie.get("accountId"),this.getMallList(t.accountId)},getMallList:function(t){var e=this;this.addForm.mallId="",this.axios.get("/malls",{params:{accountId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data;a.data.forEach(function(t){t.id==e.curMallId&&(e.addForm.mallId=t.id)}),e.mallList=a.data,e.mallList.length>0&&(e.curMallId||(e.addForm.mallId=e.mallList[0].id))}).catch(function(t){})},beforeAvatarUpload:function(t){var e="image/svg+xml"===t.type||"image/jpeg"===t.type;return e||this.$message.error(this.$t("message.uploadImg")+" JPG "+this.$t("message.or")+" SVG "+this.$t("message.imgFormat")),e},handleAvatarSuccess:function(t,e){this.addFileName=t.msg,this.addForm.floorPlan=URL.createObjectURL(e.raw)},handleAvatarError:function(t,e){this.$message({showClose:!0,message:this.$t("message.uploadFailed"),type:"warning"})},addSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;e.addForm.createUser=e.$cookie.get("userId"),e.addForm.modifyUser=e.$cookie.get("userId"),e.addForm.accountId=e.$cookie.get("accountId"),e.addForm.floorPlan=e.addFileName,e.axios.post("/floors",e.addForm).then(function(t){e.addDialogVisible=!1,e.$parent.getTableData()}).catch(function(t){})})},addDialogClose:function(){this.$refs.addForm.resetFields()},floorPlanFormatter:function(t){if(console.log(t),t){if(-1!=t.indexOf("blob:"))return t;return window.apiUrl+"/floors/img/"+t}return defaultImg}}}}).call(e,a("7t+N"))}});