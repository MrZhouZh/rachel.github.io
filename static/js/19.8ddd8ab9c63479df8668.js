webpackJsonp([19],{ClXI:function(e,t,a){"use strict";(function(e){var s=a("mvHQ"),l=a.n(s),i=a("ZelU"),n=a("YAMR");t.a={data:function(){return{pagesizeArr:[10,20,50,100],tableHeight:0,loginName_like:"",tableData:[],total:0,pageSize:10,currentPage:1,isSup:!1}},components:{"add-user-dialog":i.a,"edit-user-dialog":n.a},created:function(){this.isSup="super"===this.$cookie.get("user_type");var t=e(window).height();this.tableHeight=t-.24*t,this.getTableData()},methods:{getTableData:function(){var e=this,t={loginName_like:"%"+this.loginName_like+"%",accountId:this.$cookie.get("accountId"),page:this.currentPage,pageSize:this.pageSize,_t:Date.parse(new Date)/1e3};this.loginName_like||(t.loginName_like=null),this.axios.get("/users",{params:t}).then(function(t){var a=t.data;a.data.list.forEach(function(t,a){t.status=t.status?t.status:0,t.tabOrder=(e.currentPage-1)*e.pageSize+a+1}),e.tableData=a.data.list,e.total=a.data.total}).catch(function(e){})},accnameFormat:function(e,t,a){var s=this.getSessionLocal("account",a);return s||"--"},statusFormatter:function(e,t,a,s){return a?0==a?this.$t("dialog.close"):this.$t("dialog.open"):this.$t("dialog.close")},sizeChange:function(e){this.pageSize=e,this.getTableData()},cerrentChange:function(e){this.currentPage!=e&&(this.currentPage=e,this.getTableData())},addUserHandle:function(){this.$refs.addUserRef.dialogInit(this.isSup)},editRow:function(e){var t=JSON.parse(l()(e));this.$refs.editUserRef.dialogInit(t)},resetPW:function(e){var t=this;this.axios.post("/users/reset",{loginName:e.loginName}).then(function(e){t.$message({showClose:!0,type:"success",message:t.$t("message.resetPWSuccess")})}).catch(function(e){t.$message({showClose:!0,type:"error",message:t.$t("message.resetPWFailed")})})},searchFun:function(){this.currentPage=1,this.getTableData()}}}}).call(t,a("7t+N"))},Eyjd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("ClXI"),l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"bloc-wrapper manage-container"},[a("el-row",{staticClass:"manage-head-wrapper"},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"manage-input-box"},[a("el-input",{staticClass:"search-inp",attrs:{size:"mini",placeholder:e.$t("table.username"),clearable:""},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.searchFun(t)}},model:{value:e.loginName_like,callback:function(t){e.loginName_like=t},expression:"loginName_like"}})],1),e._v(" "),a("el-button",{staticClass:"search-btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.searchFun}},[e._v(e._s(e.$t("button.search")))])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-button",{staticClass:"manage-add-btn",attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:e.addUserHandle}},[e._v(e._s(e.$t("button.addUser")))])],1)],1),e._v(" "),a("el-row",{staticClass:"manage-content"},[a("el-col",{attrs:{span:24}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"max-height":e.tableHeight,"header-row-class-name":"manage-tab-head"}},[a("el-table-column",{attrs:{prop:"tabOrder",align:"center",label:e.$t("table.order"),width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"loginName",align:"center",label:e.$t("table.username")}}),e._v(" "),a("el-table-column",{attrs:{prop:"realName",align:"center",label:e.$t("table.name")}}),e._v(" "),a("el-table-column",{attrs:{prop:"accountId",formatter:e.accnameFormat,align:"center",label:e.$t("table.merchant")}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",align:"center",label:e.$t("table.CreatTime")}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",align:"center",label:e.$t("table.Userstate"),formatter:e.statusFormatter}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("table.operate"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){e.editRow(t.row)}}},[e._v(e._s(e.$t("button.edit")))]),e._v(" "),e.isSup?a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){e.resetPW(t.row)}}},[e._v(e._s(e.$t("button.resetPW")))]):e._e()]}}])})],1),e._v(" "),a("el-pagination",{staticClass:"manage-pagination-box",attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"sizes, prev, pager, next, slot",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.cerrentChange}},[a("span",{staticClass:"slot-pagination-ele slot-ele-total"},[e._v(e._s(e.$t("table.pageHead"))+" "+e._s(e.total)+" "+e._s(e.$t("table.pageTail")))])])],1)],1),e._v(" "),a("add-user-dialog",{ref:"addUserRef"}),e._v(" "),a("edit-user-dialog",{ref:"editUserRef"})],1)},staticRenderFns:[]},i=function(e){a("Lb34")},n=a("VU/8")(s.a,l,!1,i,"data-v-b6c0e8ac",null);t.default=n.exports},Lb34:function(e,t){},YAMR:function(e,t,a){"use strict";var s={data:function(){return{editDialogVisible:!1,editForm:{status:null},permissionTags:[],mallMenuVal:[],menuPermissionVal:"",mallArr:[],roleArr:[],roleTags:[],userunid:"",oldMallMenuArr:[]}},methods:{dialogInit:function(e){this.editMallList(e.accountId,e.id),this.editForm=e,this.editDialogVisible=!0,this.editForm.status=Number(e.status);var t=this.$cookie.get("user_unid");this.$Menu||(this.getNowUserRole(t),this.getUserunid(e.loginName))},getAllRole:function(){var e=this;this.axios.get(window.menuUrl+"/api/v1/auth/roles",{params:{order:"asc",sortby:"name",_t:Date.parse(new Date)/1e3}}).then(function(t){e.roleArr=t.data.list_data}).catch(function(e){})},getNowUserRole:function(e){var t=this;this.axios.get(window.menuUrl+"/api/v1/auth/users/"+e+"/roles",{params:{order:"asc",sortby:"create_dt",is_active:!0,_t:Date.parse(new Date)/1e3}}).then(function(e){t.roleArr=e.data.list_data}).catch(function(e){})},getUserunid:function(e){var t=this;this.axios.get(window.menuUrl+"/api/v1/auth/users",{params:{user_type:"user",username:e,_t:Date.parse(new Date)/1e3}}).then(function(e){t.userunid=e.data.list_data[0].user_unid,t.getUserRole()}).catch(function(e){})},bindRole:function(){var e=this;this.axios.post(window.menuUrl+"/api/v1/auth/users/"+this.userunid+"/roles",{role_unid:this.menuPermissionVal}).then(function(t){e.$message({showClose:!0,message:e.$t("message.bindSuccess"),type:"success"})}).catch(function(t){e.$message({showClose:!0,message:e.$t("message.bindFailed"),type:"error"})})},getUserRole:function(){var e=this;this.axios.get(window.menuUrl+"/api/v1/auth/users/"+this.userunid+"/roles",{params:{order:"asc",sortby:"name",_t:Date.parse(new Date)/1e3}}).then(function(t){e.roleTags=t.data.list_data}).catch(function(e){})},removeRole:function(e){var t=this;this.axios.delete(window.menuUrl+"/api/v1/auth/users/"+this.userunid+"/roles/"+e).then(function(e){t.$message({showClose:!0,message:t.$t("message.deleteSuccess"),type:"success"}),t.getUserRole()}).catch(function(e){t.$message({showClose:!0,message:t.$t("message.deleteFailed"),type:"error"})})},editMallList:function(e,t){var a=this;this.mallArr=[],e&&this.axios.get("/malls",{params:{accountId:e,_t:Date.parse(new Date)/1e3}}).then(function(e){var s=e.data;s.data.length>0&&(a.mallArr=s.data,a.getMallMenu(t))}).catch(function(e){})},getMallMenu:function(e){var t=this;this.mallMenuVal=[],this.permissionTags=[],e&&this.axios.get("/userMalls",{params:{userId:e,_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.length>0?(a.data.forEach(function(e){e.name=t.getName(t.mallArr,e.mallId),t.mallMenuVal.push(e.mallId),t.oldMallMenuArr=t.mallMenuVal}),t.permissionTags=a.data):t.mallMenuVal=[]}).catch(function(e){})},givePermission:function(e){var t=this;if(console.log(this.mallMenuVal.length,this.oldMallMenuArr.length),this.mallMenuVal.length>=this.oldMallMenuArr.length){if(this.mallMenuVal.length>0){var a="";a=this.mallMenuVal[this.mallMenuVal.length-1];if(this.permissionTags.some(function(e){return e.mallId==a}))return;var s=this.getName(this.mallArr,a);this.axios.post("/userMalls",{userId:e,mallId:a}).then(function(e){var a=e.data;200==a.code?(t.$message({showClose:!0,type:"success",message:t.$t("message.allocate")}),a.data.name=s,t.permissionTags.push(a.data),console.log(t.permissionTags,t.mallArr),t.oldMallMenuArr=t.mallMenuVal):(console.log(123456789),t.mallMenuVal.pop())})}}else if(this.mallMenuVal.length<this.oldMallMenuArr.length)for(var l=0;l<this.oldMallMenuArr.length;l++)-1===this.mallMenuVal.indexOf(this.oldMallMenuArr[l])&&(console.log(this.oldMallMenuArr[l]),this.permissionTags.forEach(function(e){e.mallId==t.oldMallMenuArr[l]&&t.removePermission(e)}))},removePermission:function(e,t){var a=this;console.log(e,this.mallMenuVal),this.axios.delete("/userMalls/"+e.id).then(function(s){var l=s.data;200==l.code?(a.$message({showClose:!0,type:"success",message:a.$t("message.deleteSuccess")}),t&&a.mallMenuVal.splice(a.mallMenuVal.indexOf(e.mallId),1),a.permissionTags.splice(a.permissionTags.indexOf(e),1),console.log("del after",a.mallMenuVal,a.oldMallMenuArr),a.oldMallMenuArr=a.mallMenuVal):a.$message({showClose:!0,type:"error",message:a.$t("message.deleteFailed")+l.msg})}).catch(function(e){a.$message({showClose:!0,type:"error",message:a.$t("message.deleteFailed")})})},getName:function(e,t){var a="";return e.forEach(function(e){e.id==t&&(a=e.name)}),a},editSubmit:function(){var e=this;this.axios.post("/users/"+this.editForm.id,{status:this.editForm.status}).then(function(t){e.$parent.getTableData()}).catch(function(e){}),this.menuPermissionVal&&this.bindRole(),this.editDialogVisible=!1},editDialogClose:function(e){this.$refs.editForm.clearValidate(),this.editForm={},this.mallMenuVal=[],this.permissionTags=[],this.menuPermissionVal=""}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"manage-dialog edit-user-dialog",attrs:{title:e.$t("dialog.editUser"),visible:e.editDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editDialogVisible=t},close:function(t){e.editDialogClose()}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,"status-icon":""}},[a("el-form-item",{attrs:{label:e.$t("dialog.userState"),prop:"status"}},[[a("el-switch",{staticStyle:{top:"5px"},attrs:{"active-text":e.$t("dialog.close"),"inactive-text":e.$t("dialog.open"),"active-color":"#ff4949","inactive-color":"#13ce66","active-value":0,"inactive-value":1},model:{value:e.editForm.status,callback:function(t){e.$set(e.editForm,"status",t)},expression:"editForm.status"}})]],2),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.mallPermiss")}},[a("el-select",{attrs:{placeholder:"选择门店权限",multiple:"","collapse-tags":"",filterable:""},on:{change:function(t){e.givePermission(e.editForm.id,!0)}},model:{value:e.mallMenuVal,callback:function(t){e.mallMenuVal=t},expression:"mallMenuVal"}},e._l(e.mallArr,function(t,s){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[a("span",{staticClass:"custom-checkbox__input"},[a("span",{staticClass:"custom-checkbox__inner"})]),e._v(" "),a("span",{staticStyle:{"padding-left":"5px"}},[e._v(e._s(t.name))])])}))],1),e._v(" "),e.$Menu?e._e():a("el-form-item",{attrs:{label:e.$t("dialog.selectRole")}},[a("el-select",{attrs:{placeholder:"选择角色权限",filterable:""},model:{value:e.menuPermissionVal,callback:function(t){e.menuPermissionVal=t},expression:"menuPermissionVal"}},e._l(e.roleArr,function(e,t){return a("el-option",{key:e.role_unid,attrs:{label:e.name,value:e.role_unid}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.permission")}},[a("el-scrollbar",{attrs:{"wrap-class":"list-scrollbar tag-scrollbar",native:!1}},[e._l(e.permissionTags,function(t){return a("el-tag",{key:t.name,attrs:{closable:""},on:{close:function(a){e.removePermission(t)}}},[e._v("\n\t\t\t\t\t\t"+e._s(t.name)+"\n\t\t\t\t\t")])}),e._v(" "),e.permissionTags.length?e._e():a("span",{staticClass:"all-permission"},[e._v(e._s(e.$t("dialog.allPermiss")))])],2)],1),e._v(" "),e.$Menu?e._e():a("el-form-item",{attrs:{label:e.$t("dialog.hasRole")}},[a("el-scrollbar",{attrs:{"wrap-class":"list-scrollbar tag-scrollbar",native:!1}},[e._l(e.roleTags,function(t){return a("el-tag",{key:t.role_unid,staticClass:"role-tag",attrs:{closable:""},on:{close:function(a){e.removeRole(t.role_unid)}}},[e._v("\n\t\t\t\t\t\t"+e._s(t.name)+"\n\t\t\t\t\t")])}),e._v(" "),e.roleTags.length?e._e():a("span",{staticClass:"all-permission"},[e._v(e._s(e.$t("dialog.noRole")))])],2)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(t){e.editDialogVisible=!1}}},[e._v(e._s(e.$t("dialog.cancel")))]),e._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(t){e.editSubmit("editForm")}}},[e._v(e._s(e.$t("dialog.confirm")))])],1)],1)},staticRenderFns:[]},i=a("VU/8")(s,l,!1,function(e){a("f0Ko"),a("gPLu")},"data-v-0302c73f",null);t.a=i.exports},ZelU:function(e,t,a){"use strict";var s={data:function(){var e=this;return{addDialogVisible:!1,addForm:{loginName:"",realName:"",password:"",tel:"",email:"",accountId:""},accList:[],isSup:!1,rules:{realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],loginName:[{required:!0,message:"请输入姓名",trigger:"blur"},{validator:function(t,a,s){if(""===a)return s(new Error("请输入用户名"));e.axios.get("/users",{params:{loginName:a,_t:Date.parse(new Date)/1e3}}).then(function(e){if(0!=e.data.data.length)return s(new Error("用户名重复,请重新输入"));s()}).catch(function(e){})},trigger:"blur"}],password:[{validator:function(e,t,a){if(!/^(?![A-Z]+$)(?![a-z]+$)(?!\d+$)(?![\W_]+$)\S{6,16}$/.test(t))return a(new Error("请输入不小于六位包含字母数字的密码"));a()},trigger:"change"}],accountId:[{required:!0,message:"请选择所属集团",trigger:"change"}]}}},methods:{dialogInit:function(e){this.isSup=e,this.addDialogVisible=!0},addDialogClose:function(){this.$refs.addForm.resetFields()},dialogOpen:function(){this.getAccList()},getAccList:function(){var e=this,t={};this.isSup||(t.id=this.$cookie.get("accountId")),t._t=Date.parse(new Date)/1e3,this.addForm.accountId="",this.accList=[],this.axios.get("/accounts",{params:t}).then(function(t){var a=t.data;a.data.length>0&&(e.addForm.accountId=a.data[0].id),e.accList=a.data})},getMallList:function(e){var t=this;this.mallList=[],this.addForm.mallId=[],e&&this.axios.get("/malls",{params:{accountId:e,_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;t.mallList=a.data,t.mallList.length>0?t.addForm.mallId=[t.mallList[0].id]:t.addForm.mallId=[]}).catch(function(e){})},getZoneList:function(){var e=this,t=this.$cookie.get("accountId");this.axios.get("/zones",{params:{accountId:t,sortName:'"floor".name, "zone".name',_t:Date.parse(new Date)/1e3}}).then(function(t){e.zoneList=t.data.data,e.zoneList.length>0?e.addForm.zoneId=e.zoneList[0].id:e.addForm.zoneId=""})},addSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.addForm.createUser=t.$cookie.get("userId"),t.addForm.modifyUser=t.$cookie.get("userId"),t.addForm.createTime=dateUnit.dateFormat(new Date,"yyyy-MM-dd HH:mm:ss"),t.axios.post("/users/addUser",t.addForm).then(function(e){var a=e.data;200==a.code?(t.addDialogVisible=!1,t.$parent.getTableData()):t.$message({showClose:!0,type:"error",message:t.$t("message.addUser")+a.msg})}).catch(function(e){})})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"manage-dialog",attrs:{title:e.$t("button.addUser"),visible:e.addDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addDialogVisible=t},close:function(t){e.addDialogClose()},open:function(t){e.dialogOpen()}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"status-icon":"",rules:e.rules}},[a("el-form-item",{attrs:{label:e.$t("dialog.loginName"),prop:"loginName"}},[a("el-input",{model:{value:e.addForm.loginName,callback:function(t){e.$set(e.addForm,"loginName",t)},expression:"addForm.loginName"}}),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.realName"),prop:"realName"}},[a("el-input",{model:{value:e.addForm.realName,callback:function(t){e.$set(e.addForm,"realName",t)},expression:"addForm.realName"}}),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.password"),prop:"password"}},[a("el-input",{attrs:{type:"password"},model:{value:e.addForm.password,callback:function(t){e.$set(e.addForm,"password",t)},expression:"addForm.password"}}),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.tel"),prop:"tel"}},[a("el-input",{model:{value:e.addForm.tel,callback:function(t){e.$set(e.addForm,"tel",t)},expression:"addForm.tel"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.email"),prop:"email"}},[a("el-input",{model:{value:e.addForm.email,callback:function(t){e.$set(e.addForm,"email",t)},expression:"addForm.email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.accountId"),prop:"accountId"}},[a("el-select",{staticClass:"manage-sel dialog-mall-sel",attrs:{filterable:"",placeholder:e.$t("pholder.select"),"no-data-text":e.$t("pholder.nodata")},model:{value:e.addForm.accountId,callback:function(t){e.$set(e.addForm,"accountId",t)},expression:"addForm.accountId"}},e._l(e.accList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(t){e.addDialogVisible=!1}}},[e._v(e._s(e.$t("dialog.cancel")))]),e._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(t){e.addSubmit("addForm")}}},[e._v(e._s(e.$t("dialog.confirm")))])],1)],1)},staticRenderFns:[]},i=a("VU/8")(s,l,!1,function(e){a("kDGF")},"data-v-2ae67b59",null);t.a=i.exports},f0Ko:function(e,t){},gPLu:function(e,t){},kDGF:function(e,t){}});