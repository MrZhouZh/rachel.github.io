webpackJsonp([21],{BGwY:function(t,e,a){"use strict";var i=a("3MSA"),l=a.n(i),n={data:function(){return{isShow:!1,loading:!0,mallVal:"",mallOpt:[],monitoryVal:"",monitoryOpt:[],cameraVal:"",cameraOpt:[],timeVal:[],total:0,pageSize:50,currentPage:1,imgList:[],defaultImg:l.a,staffId:"",roleunid:"",appunid:"",checkedNum:0,hasAddImg:[],noImgText:"",curMallId:null,treeData:[],checkedNode:[],rootTemp:{}}},created:function(){},mounted:function(){},methods:{getNode:function(){var t=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps",{params:{_t:Date.parse(new Date)/1e3}}).then(function(e){e.data.list_data.forEach(function(e,a){e.name==t.$Project&&(t.appunid=e.unid)}),t.getMeun(t.appunid),t.getRloeMenu(t.appunid)}).catch(function(t){})},getMeun:function(t){var e=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps/"+t+"/menus",{params:{_t:Date.parse(new Date)/1e3}}).then(function(t){var a=[];t.data.menu_tree.length>=2?a.push(t.data.menu_tree[1]):a.push(t.data.menu_tree[0]);var i=[],l=[];a.forEach(function(t,a){e.rootTemp={};var n={};n.unid=t.unid,n.id=t.perm_unid,e.rootTemp.unid=t.unid,e.rootTemp.id=t.perm_unid,"mall"==e.$Project?n.label="智慧商业客流分析平台":n.label="智慧连锁客流分析平台",i.push(n),t.children.forEach(function(e,a){var i=[],n={};n.unid=e.unid,n.id=e.perm_unid,n.label=e.note,n.parentId=t.unid,n.parentPermId=t.perm_unid,l.push(n),e.children.forEach(function(t,a){var l={};e.unid==t.parent&&(l.unid=t.unid,l.id=t.perm_unid,l.label=t.note,l.parentId=e.unid,l.parentPermId=e.perm_unid),i.push(l)}),l[a].children=i}),i[a].children=l}),e.treeData=i}).catch(function(t){})},getRloeMenu:function(t){var e=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps/"+t+"/menus",{params:{role:this.roleunid,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=[];t.data.menu_tree[0].children.forEach(function(t,e){t.children.forEach(function(t,e){a.push(t.perm_unid)})}),e.$refs.tree.setCheckedKeys(a)}).catch(function(t){})},dialogInit:function(t){this.roleunid=t,this.getNode(),this.isShow=!0},getMallList:function(){var t=this;this.mallOpt=[],this.mallVal="",this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.forEach(function(e){e.id==t.curMallId&&(t.mallVal=e.id)}),a.data.length>0&&(t.mallOpt=a.data,t.curMallId||(t.mallVal=a.data[0].id),t.getGates(t.mallVal))}).catch(function(t){})},submitAllocate:function(){var t=this,e=this.$refs.tree.getCheckedNodes();this.checkedNode.push({unid:this.rootTemp.unid,perm_unid:this.rootTemp.id}),e.forEach(function(e,a){e.unid!=t.rootTemp.unid&&t.checkedNode.push({unid:e.unid,perm_unid:e.id}),e.parentId&&!t.checkedNode.some(function(t){return e.parentId==t.unid})&&t.checkedNode.push({unid:e.parentId,perm_unid:e.parentPermId})}),this.axios.post(window.menuUrl+"/api/v1/auth/roles/"+this.roleunid+"/apps/"+this.appunid+"/menus",{list_size:this.checkedNode.length,list_data:this.checkedNode}).then(function(e){t.checkedNode=[],200==e.data.ecode&&t.$message({showClose:!0,message:t.$t("message.allocate"),type:"success"})}).catch(function(e){t.checkedNode=[],t.$message({showClose:!0,message:t.$t("message.allocateFailed"),type:"error"})}),this.isShow=!1},closeDialog:function(){this.checkedNode=[],this.isShow=!1}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"loading",rawName:"v-loading.body",value:t.loading,expression:"loading",modifiers:{body:!0}}],staticClass:"manage-dialog menu-dialog",attrs:{title:t.$t("button.permiss"),visible:t.isShow,"close-on-click-modal":!1,"before-close":t.closeDialog},on:{"update:visible":function(e){t.isShow=e}}},[a("div",{staticClass:"page-wrapper"},[a("span",{staticClass:"menu-title"},[t._v(t._s(t.$t("dialog.menuList")))]),t._v(" "),a("el-scrollbar",{staticStyle:{height:"500px","max-height":"320px"},attrs:{"wrap-class":"list-scrollbar",native:!1}},[a("el-tree",{ref:"tree",staticClass:"menu-tree",attrs:{data:t.treeData,"show-checkbox":"","node-key":"id","highlight-current":"","default-expand-all":""}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:t.submitAllocate}},[t._v(t._s(t.$t("dialog.confirm")))])],1)])],1)},staticRenderFns:[]},o=a("VU/8")(n,s,!1,function(t){a("uceF")},"data-v-20ea8e30",null);e.a=o.exports},FuoY:function(t,e){},"G0n/":function(t,e,a){"use strict";(function(t){var i=a("3MSA"),l=a.n(i),n=a("dwSG"),s=a("wMQr"),o=a("BGwY");e.a={data:function(){return{pickerOptions1:{},roleName:"",mallName:"",mallVal:"",mallOpt:[],monitoryVal:"",monitoryName:"",monitoryOpt:[],cameraVal:"",cameraOpt:[],typeVal:"",defaultImg:l.a,tableData:[],total:0,pageSize:10,currentPage:1,pagesizeArr:[10,20,50,100],tableHeight:0,loading:!0,isEffect:!0,addDialogVisible:!1,noDataText:"",statusVal:"",statusOpt:[{name:"stateA",id:1,value:!0},{name:"stateB",id:2,value:!1}]}},components:{"add-dialog":n.a,"edit-dialog":s.a,"add-image":o.a},created:function(){var e=t(window).height();this.tableHeight=e-.24*e,this.getMallList()},mounted:function(){var t=this;setTimeout(function(){t.getTableData()},500)},methods:{i18n:function(t){var e="table."+t;return this.$t(e)},activeFormatter:function(t,e,a){return a=1==a?"正常":"停用"},getTableData:function(){var t=this;this.loading=!0,this.tableData=[],this.axios.get(window.menuUrl+"/api/v1/auth/users/"+this.$cookie.get("user_unid")+"/roles",{params:{order:"asc",sortby:"create_dt",is_active:this.statusVal,name__like:this.roleName?this.roleName:null,offset:1==this.currentPage?0:10*(this.currentPage-1),limit:this.pageSize,_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;t.tableData=a.list_data,t.total=a.total_num,setTimeout(function(){t.loading=!1},1e3)}).catch(function(t){})},expandHandle:function(t,e){var a=this;this.$refs.row_table.store.states.expandRows=e.length?[t]:[];var i=!1;this.$refs.row_table.store.states.expandRows.length>0&&(this.$refs.row_table.store.states.expandRows[0].id=t.id,i=!0),this.noDataText="load",t.children=[],i&&this.axios.get("/staffFaces",{params:{staffId:t.id,_t:Date.parse(new Date)/1e3}}).then(function(e){var i=e.data;0==i.data.length&&(a.noDataText=a.$t("echartsTitle.noData")),i.data.forEach(function(t){t.facePic=t.facePic?t.facePic:"0"}),t.children=i.data}).catch(function(t){})},sizeChange:function(t){this.pageSize=t,this.getTableData()},cerrentChange:function(t){this.currentPage!=t&&(this.currentPage=t,this.getTableData())},getMallList:function(){var t=this;this.mallOpt=[],this.mallVal="",this.mallName="",this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data.data;a.length>0&&(t.mallOpt=a,t.mallVal=a[0].id,t.mallName=a[0].name)}).catch(function(t){})},chooseMall:function(t){var e=this;this.monitoryOpt.forEach(function(a){a.id==t&&(e.mallName=a.name)})},delHandle:function(t){var e=this;this.$confirm(this.$t("message.confirDelete"),this.$t("message.prompt"),{confirmButtonText:this.$t("message.confirm"),cancelButtonText:this.$t("message.cancel"),type:"warning"}).then(function(){e.removeRole(t.role_unid)})},removeRole:function(t){var e=this;this.axios.delete(window.menuUrl+"/api/v1/auth/users/"+this.$cookie.get("user_unid")+"/roles/"+t).then(function(t){e.$message({showClose:!0,message:e.$t("message.deleteSuccess"),type:"success"}),e.getTableData()}).catch(function(t){e.$message({showClose:!0,message:e.$t("message.deleteFailed"),type:"error"})})},addClerk:function(){this.$refs.addModel.dialogInit(this.mallVal)},permissHandle:function(t){this.$refs.imageModel.dialogInit(t.role_unid)},editHandle:function(t){this.$refs.editModel.dialogInit(t)},searchFun:function(){this.currentPage=1,this.getTableData()}}}}).call(e,a("7t+N"))},XFoD:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("G0n/"),l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"manage-container clerk-wrapper"},[a("el-row",{staticClass:"manage-head-wrapper"},[a("el-col",{attrs:{span:22}},[a("div",{staticClass:"manage-select-box"},[a("el-select",{staticClass:"mall-opt",attrs:{placeholder:t.$t("table.state")},model:{value:t.statusVal,callback:function(e){t.statusVal=e},expression:"statusVal"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),t._l(t.statusOpt,function(e,i){return a("el-option",{key:e.id,attrs:{label:t.i18n(e.name),value:e.value}})})],2)],1),t._v(" "),a("div",{staticClass:"manage-select-box"},[a("el-input",{staticClass:"search-inp",attrs:{placeholder:t.$t("table.roleName"),clearable:""},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.searchFun(e)}},model:{value:t.roleName,callback:function(e){t.roleName=e},expression:"roleName"}})],1),t._v(" "),a("el-button",{staticClass:"search-btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.searchFun}},[t._v(t._s(t.$t("button.search")))])],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"btn-box"},[a("el-button",{staticClass:"manage-add-btn fl-btn",attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.addClerk}},[t._v(t._s(t.$t("dialog.addRole")))])],1)])],1),t._v(" "),a("el-row",{staticClass:"manage-content"},[a("el-col",{attrs:{span:24}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"row_table",staticClass:"clerk-manage-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"max-height":t.tableHeight,"header-row-class-name":"manage-tab-head"},on:{"expand-change":t.expandHandle}},[a("el-table-column",{attrs:{label:t.$t("table.order"),align:"center",type:"index",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.roleName"),align:"center",prop:"name"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.state"),align:"center",prop:"is_active",formatter:t.activeFormatter}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.CreatTime"),align:"center",prop:"create_dt","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.describe"),align:"center",prop:"role_unid","min-width":"200"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.operate"),align:"center","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.permissHandle(e.row)}}},[t._v(t._s(t.$t("button.permiss")))]),t._v(" "),a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.editHandle(e.row)}}},[t._v(t._s(t.$t("button.edit")))]),t._v(" "),a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.delHandle(e.row)}}},[t._v(t._s(t.$t("button.delete")))])]}}])})],1),t._v(" "),a("el-pagination",{staticClass:"manage-pagination-box",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,50,100],"page-size":t.pageSize,layout:"sizes, prev, pager, next, slot",total:t.total},on:{"size-change":t.sizeChange,"current-change":t.cerrentChange}},[a("span",{staticClass:"slot-pagination-ele slot-ele-total"},[t._v(t._s(t.$t("table.pageHead"))+" "+t._s(t.total)+" "+t._s(t.$t("table.pageTail")))])])],1)],1),t._v(" "),a("add-dialog",{ref:"addModel"}),t._v(" "),a("edit-dialog",{ref:"editModel"}),t._v(" "),a("add-image",{ref:"imageModel"})],1)},staticRenderFns:[]},n=function(t){a("FuoY")},s=a("VU/8")(i.a,l,!1,n,"data-v-66c77446",null);e.default=s.exports},dwSG:function(t,e,a){"use strict";a("RRo+");var i={data:function(){return{isShow:!1,addForm:{name:"",mallId:null,gender:null,age:null,position:""},mallList:[],rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}]},curMallId:null}},created:function(){},methods:{dialogInit:function(t){this.curMallId=t,this.getMallList(),this.isShow=!0},getMallList:function(){var t=this;this.mallList=[],this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.forEach(function(e){e.id==t.curMallId&&(t.addForm.mallId=e.id)}),a.data.length>0&&(t.curMallId||(t.addForm.mallId=a.data[0].id),t.mallList=a.data)}).catch(function(t){})},bindRole:function(t){var e=this;this.axios.post(window.menuUrl+"/api/v1/auth/users/"+this.$cookie.get("user_unid")+"/roles",{role_unid:t}).then(function(t){e.$message({showClose:!0,message:e.$t("message.bindSuccess"),type:"success"}),e.$refs.addForm.resetFields(),e.$parent.getTableData()}).catch(function(t){e.$message({showClose:!0,message:e.$t("message.bindFailed"),type:"error"})})},addSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;e.axios.post(window.menuUrl+"/api/v1/auth/roles/",{name:e.addForm.name}).then(function(t){var a=t.data;a&&e.bindRole(a.role_unid)}).catch(function(t){})}),this.isShow=!1},closeDialog:function(){this.$refs.addForm.resetFields(),this.isShow=!1}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{staticClass:"manage-dialog",attrs:{title:t.$t("dialog.addRole"),visible:t.isShow,"before-close":t.closeDialog},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"addForm",attrs:{model:t.addForm,"status-icon":"",rules:t.rules}},[a("el-form-item",{attrs:{label:t.$t("table.roleName"),prop:"name"}},[a("el-input",{model:{value:t.addForm.name,callback:function(e){t.$set(t.addForm,"name",e)},expression:"addForm.name"}}),t._v(" "),a("i",{staticClass:"error-tip"},[t._v("*")])],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.englishName"),prop:"enName"}},[a("el-input",{model:{value:t.addForm.enName,callback:function(e){t.$set(t.addForm,"enName",e)},expression:"addForm.enName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.state"),prop:"stutas"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:t.$t("pholder.state"),"no-data-text":t.$t("pholder.nodata")},model:{value:t.addForm.stutas,callback:function(e){t.$set(t.addForm,"stutas",e)},expression:"addForm.stutas"}},[a("el-option",{attrs:{label:t.$t("table.stateA"),value:1}}),t._v(" "),a("el-option",{attrs:{label:t.$t("table.stateB"),value:2}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.describe"),prop:"position"}},[a("el-input",{model:{value:t.addForm.position,callback:function(e){t.$set(t.addForm,"position",e)},expression:"addForm.position"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:t.closeDialog}},[t._v(t._s(t.$t("dialog.cancel")))]),t._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(e){t.addSubmit("addForm")}}},[t._v(t._s(t.$t("dialog.confirm")))])],1)],1)],1)},staticRenderFns:[]},n=a("VU/8")(i,l,!1,null,null,null);e.a=n.exports},uceF:function(t,e){},wMQr:function(t,e,a){"use strict";var i={data:function(){return{isShow:!1,loading:!0,editForm:{name:"",position:"",is_active:null,mallId:"",role_unid:""},employeeId:"",mallList:[],rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}]}}},created:function(){this.getMallList()},methods:{dialogInit:function(t){this.isShow=!0,this.loading=!1,this.employeeId=t.id;for(var e in this.editForm)this.editForm[e]=t[e]},editSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;e.axios.post(window.menuUrl+"/api/v1/auth/roles/"+e.editForm.role_unid,{name:e.editForm.name,is_active:e.editForm.is_active}).then(function(t){t.data;e.isShow=!1,e.$parent.getTableData()})})},getMallList:function(){var t=this;this.mallList=[],this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data.data;a.length>0&&(t.mallList=a,t.editForm.mallId=a[0].id)}).catch(function(t){})},closeDialog:function(){this.$refs.editForm.resetFields(),this.isShow=!1}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"loading",rawName:"v-loading.body",value:t.loading,expression:"loading",modifiers:{body:!0}}],staticClass:"manage-dialog",attrs:{title:t.$t("dialog.editRole"),visible:t.isShow,"before-close":t.closeDialog},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"editForm",attrs:{model:t.editForm,"status-icon":"",rules:t.rules}},[a("el-form-item",{attrs:{label:t.$t("table.roleName"),prop:"name"}},[a("el-input",{model:{value:t.editForm.name,callback:function(e){t.$set(t.editForm,"name",e)},expression:"editForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.englishName"),prop:"enName"}},[a("el-input",{model:{value:t.editForm.enName,callback:function(e){t.$set(t.editForm,"enName",e)},expression:"editForm.enName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.state"),prop:"is_active"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:t.$t("pholder.state"),"no-data-text":t.$t("pholder.nodata")},model:{value:t.editForm.is_active,callback:function(e){t.$set(t.editForm,"is_active",e)},expression:"editForm.is_active"}},[a("el-option",{attrs:{label:t.$t("table.stateA"),value:!0}}),t._v(" "),a("el-option",{attrs:{label:t.$t("table.stateB"),value:!1}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.square"),prop:"mallId"}},[a("el-select",{staticClass:"manage-sel",attrs:{filterable:"",placeholder:t.$t("pholder.select"),"no-data-text":t.$t("pholder.nodata")},model:{value:t.editForm.mallId,callback:function(e){t.$set(t.editForm,"mallId",e)},expression:"editForm.mallId"}},t._l(t.mallList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.describe"),prop:"role_unid"}},[a("el-input",{attrs:{disabled:""},model:{value:t.editForm.role_unid,callback:function(e){t.$set(t.editForm,"role_unid",e)},expression:"editForm.role_unid"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(e){t.isShow=!1}}},[t._v(t._s(t.$t("dialog.cancel")))]),t._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(e){t.editSubmit("editForm")}}},[t._v(t._s(t.$t("dialog.confirm")))])],1)],1)],1)},staticRenderFns:[]},n=a("VU/8")(i,l,!1,null,null,null);e.a=n.exports}});