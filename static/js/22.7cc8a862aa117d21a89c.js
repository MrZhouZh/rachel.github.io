webpackJsonp([22],{"+RWB":function(e,t,a){"use strict";(function(e){var l=a("mvHQ"),i=a.n(l),s=a("GcBR"),n=a("0xw8");t.a={data:function(){return{blocList:[],mallListForTerm:[],floorListForTerm:[],blocValue:"",mallValue:"",floorValue:"",tableHeight:0,tableData:[],total:0,pageSize:10,currentPage:1,mallList:[],noDataText:""}},components:{"add-act-dialog":s.a,"edit-act-dialog":n.a},created:function(){var t=e(window).height();this.tableHeight=t-.24*t,this.getAccountList()},methods:{levelFormat:function(e,t,a){return 1==a?"集团":"广场"},timeFormat:function(e,t,a){var l="";return a&&(l=a.split(" ")[0]),l},getTableData:function(){var e=this,t=this.mallValue?this.mallValue:null,a={accountId:this.blocValue,mallId:t,page:this.currentPage,pageSize:this.pageSize,_t:Date.parse(new Date)/1e3};this.axios.get("/events",{params:a}).then(function(t){e.tableData=[];var a=t.data;a.data.list.forEach(function(t,a){0==t.type?t.type="节假日":t.type="活动",t.tabOrder=(e.currentPage-1)*e.pageSize+a+1,t.durationDay=(Date.parse(t.endDate.replace(/\-/,"/"))-Date.parse(t.startDate.replace(/\-/,"/")))/36e5/24+1}),e.tableData=a.data.list,e.total=a.data.total}).catch(function(e){})},sizeChange:function(e){this.pageSize=e,this.getTableData()},cerrentChange:function(e){this.currentPage!=e&&(this.currentPage=e,this.getTableData())},addActHandle:function(){this.$refs.addactModel.dialogInit(this.mallValue)},editRow:function(e){var t=JSON.parse(i()(e));this.$refs.editactModel.dialogInit(t)},delRow:function(e){var t=this;this.$confirm(this.$t("message.deleteEvent"),this.$t("message.prompt"),{confirmButtonText:this.$t("message.confirm"),cancelButtonText:this.$t("message.cancel"),type:"warning"}).then(function(){t.axios.delete("/events/"+e.id,{params:{}}).then(function(e){200==e.data.code?(t.$message({showClose:!0,type:"success",message:t.$t("message.deleteSuccess")}),t.getTableData()):t.$message({showClose:!0,type:"warning",message:t.$t("message.deleteFailed")+e.data.msg})}).catch(function(e){})}).catch(function(){t.$message({showClose:!0,type:"info",message:t.$t("message.cancelDelete")})})},searchFun:function(){this.currentPage=1,this.getTableData()},dateFormatter:function(e,t,a){var l="";return a.split(" ")&&(l=a.split(" ")[0]),l},typeFormatter:function(e,t,a){return 1==a?"店铺":2==a?"区":"主力店"},statusFormatter:function(e,t,a){return 1==a?"正常":"停用"},getAccountList:function(){this.blocValue=this.$cookie.get("accountId"),this.getMallListForTerm(this.blocValue,!0)},getMallList:function(e){var t=this;this.mallList=[],this.addForm.mallId="",this.axios.get("/malls",{params:{accountId:e,_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.length>0&&(t.addForm.mallId=a.data[0].id,t.mallList=a.data)}).catch(function(e){})},mallChange:function(){this.setSessionLocal("manageMallId",this.mallValue)},getMallListForTerm:function(e,t){var a=this;this.mallListForTerm=[],this.mallValue="",this.mallList=[],this.axios.get("/malls",{params:{accountId:e,_t:Date.parse(new Date)/1e3}}).then(function(e){var l=e.data;a.mallListForTerm=l.data,a.mallList=l.data,a.getSessionLocal("manageMallId")?a.mallValue=Number(a.getSessionLocal("manageMallId")):(a.mallListForTerm.forEach(function(e,t,l){0==t&&(a.mallValue=e.id)}),a.setSessionLocal("manageMallId",a.mallValue)),t&&a.getTableData()}).catch(function(e){})}}}}).call(t,a("7t+N"))},"0UKX":function(e,t){},"0xw8":function(e,t,a){"use strict";var l={data:function(){return{editDialogVisible:!1,editMallList:[],editAbleType:!1,editAbleLevel:!1,editForm:{name:"",mallId:null,type:null,level:null,startDate:"",endDate:"",eventDate:"",intro:""},rowId:null,rules:{}}},methods:{dialogInit:function(e){this.rowId=e.id;for(var t in this.editForm)this.editForm[t]=e[t];this.editDialogVisible=!0},dialogOpen:function(e){e.accountId=Number(this.$cookie.get("accountId")),this.getEditMallList(e.accountId),"节假日"==this.editForm.type&&(this.editAbleLevel=!0)},getEditMallList:function(e){var t=this;this.editMallList=[],this.editForm.mallId="",this.axios.get("/malls",{params:{accountId:e,_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.length&&(t.editForm.mallId=a.data[0].id,t.editMallList=a.data)}).catch(function(e){})},changeAddMall:function(){},editchangeType:function(e){0==e?(this.editForm.level=1,this.editAbleLevel=!0):this.editAbleLevel=!1},editchangeLevel:function(e){2==e?(this.editForm.type=1,this.editAbleType=!0):this.editAbleType=!1},endDateChange:function(){var e="",t="";if(e=this.editForm.startDate,t=this.editForm.endDate,e&&t){if(!(Date.parse(t)>=Date.parse(e)))return this.$message({showClose:!0,message:this.$t("message.timeIllegal"),type:"warning"}),void(this.editForm.endDate="")}},editSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.axios.post("/events/"+t.rowId,t.editForm).then(function(e){200==e.data.code?(t.editDialogVisible=!1,t.$parent.getTableData()):t.$message({showClose:!0,type:"warning",message:t.$t("message.editAbnormal")+e.data.msg})}).catch(function(e){})})},editDialogClose:function(){this.$refs.editForm.resetFields(),this.editAbleType=!1,this.editAbleLevel=!1}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"manage-dialog",attrs:{title:e.$t("dialog.editEvent"),visible:e.editDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editDialogVisible=t},open:function(t){e.dialogOpen(e.editForm)},close:e.editDialogClose}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$t("table.eventName"),prop:"name"}},[a("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.square"),prop:"mallId"}},[a("el-select",{staticClass:"manage-sel",attrs:{filterable:"",placeholder:e.$t("pholder.mall"),"no-data-text":e.$t("pholder.nodata")},on:{change:e.changeAddMall},model:{value:e.editForm.mallId,callback:function(t){e.$set(e.editForm,"mallId",t)},expression:"editForm.mallId"}},e._l(e.editMallList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.type"),prop:"type"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:e.$t("pholder.eventType"),disabled:e.editAbleType},on:{change:e.editchangeType},model:{value:e.editForm.type,callback:function(t){e.$set(e.editForm,"type",t)},expression:"editForm.type"}},[a("el-option",{attrs:{label:"节假日",value:0}},[e._v(e._s(e.$t("pholder.eventTypeA")))]),e._v(" "),a("el-option",{attrs:{label:"活动",value:1}},[e._v(e._s(e.$t("pholder.eventTypeB")))])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.eventLevel"),prop:"level"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:e.$t("pholder.eventLevel"),disabled:e.editAbleLevel},on:{change:e.editchangeLevel},model:{value:e.editForm.level,callback:function(t){e.$set(e.editForm,"level",t)},expression:"editForm.level"}},[a("el-option",{attrs:{label:"集团",value:1}},[e._v(e._s(e.$t("pholder.eventLevelA")))]),e._v(" "),a("el-option",{attrs:{label:"广场",value:2}},[e._v(e._s(e.$t("pholder.eventLevelB")))])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.duration")}},[a("el-col",{attrs:{span:11}},[a("el-form-item",{staticClass:"spe-form-item"},[a("el-date-picker",{staticClass:"manage-date-inp",attrs:{format:"MM 月 dd 日",type:"date",size:"mini","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:e.$t("pholder.startDate")},model:{value:e.editForm.startDate,callback:function(t){e.$set(e.editForm,"startDate",t)},expression:"editForm.startDate"}})],1)],1),e._v(" "),a("el-col",{staticClass:"line",staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("-")]),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{staticClass:"spe-form-item"},[a("el-date-picker",{staticClass:"manage-date-inp",attrs:{format:"MM 月 dd 日",type:"date",size:"mini","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:e.$t("pholder.endDate")},on:{change:e.endDateChange},model:{value:e.editForm.endDate,callback:function(t){e.$set(e.editForm,"endDate",t)},expression:"editForm.endDate"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.eventDay")}},[a("el-date-picker",{staticClass:"manage-date-inp",attrs:{format:"yyyy-MM-dd",type:"date",size:"mini","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:e.$t("table.eventDay")},model:{value:e.editForm.eventDate,callback:function(t){e.$set(e.editForm,"eventDate",t)},expression:"editForm.eventDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.describe"),prop:"intro"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.editForm.intro,callback:function(t){e.$set(e.editForm,"intro",t)},expression:"editForm.intro"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(t){e.editDialogVisible=!1}}},[e._v(e._s(e.$t("dialog.cancel")))]),e._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(t){e.editSubmit("editForm")}}},[e._v(e._s(e.$t("dialog.confirm")))])],1)],1)},staticRenderFns:[]},s=a("VU/8")(l,i,!1,function(e){a("7Xs+")},"data-v-47e94e76",null);t.a=s.exports},"7Xs+":function(e,t){},"9Hqb":function(e,t){},GcBR:function(e,t,a){"use strict";var l={data:function(){return{addDialogVisible:!1,addMallList:[],addAbleType:!1,addAbleLevel:!1,addForm:{name:"",mallId:null,type:null,level:null,startDate:"",endDate:"",eventDate:"",intro:""},rules:{name:[{required:!0,message:"请输入区域名称",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],floorId:[{required:!0,message:"请选择区域",trigger:"change"}],startDate:[{required:!0,message:"请选择日期",trigger:"change"}],endDate:[{required:!0,message:"请选择日期",trigger:"change"}],eventDate:[{required:!0,message:"请选择日期",trigger:"change"}]},curMallId:null}},methods:{dialogInit:function(e){this.curMallId=e,this.addDialogVisible=!0},dialogOpen:function(e,t){e.accountId=Number(this.$cookie.get("accountId")),this.getAddMallList(e.accountId)},getAddMallList:function(e){var t=this;this.addMallList=[],this.addForm.mallId="",this.axios.get("/malls",{params:{accountId:e,_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.forEach(function(e){e.id==t.curMallId&&(t.addForm.mallId=e.id)}),a.data.length&&(t.curMallId||(t.addForm.mallId=a.data[0].id),t.addMallList=a.data)}).catch(function(e){})},addchangeType:function(e){0==e?(this.addForm.level=1,this.addAbleLevel=!0):this.addAbleLevel=!1},addchangeLevel:function(e){2==e?(this.addForm.type=1,this.addAbleType=!0):this.addAbleType=!1},endDateChange:function(){var e="",t="";if(e=this.addForm.startDate,t=this.addForm.endDate,e&&t){if(!(Date.parse(t)>=Date.parse(e)))return this.$message({showClose:!0,message:this.$t("message.timeIllegal"),type:"warning"}),void(this.addForm.endDate="")}},addSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.axios.post("/events",t.addForm).then(function(e){200==e.data.code?(t.addDialogVisible=!1,t.$parent.getTableData()):t.$message({showClose:!0,type:"warning",message:t.$t("message.addAbnormal")+e.data.msg})}).catch(function(e){})})},addDialogClose:function(){this.$refs.addForm.resetFields(),this.addForm={name:"",mallId:null,type:null,level:null,startDate:"",endDate:"",eventDate:"",intro:""},this.addAbleType=!1,this.addAbleLevel=!1}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"manage-dialog",attrs:{title:e.$t("button.addEvent"),visible:e.addDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addDialogVisible=t},open:function(t){e.dialogOpen(e.addForm)},close:e.addDialogClose}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"status-icon":"",rules:e.rules}},[a("el-form-item",{attrs:{label:e.$t("table.eventName"),prop:"name"}},[a("el-input",{model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}}),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.square"),prop:"mallId"}},[a("el-select",{staticClass:"manage-sel",attrs:{filterable:"",placeholder:e.$t("pholder.mall"),"no-data-text":e.$t("pholder.nodata")},model:{value:e.addForm.mallId,callback:function(t){e.$set(e.addForm,"mallId",t)},expression:"addForm.mallId"}},e._l(e.addMallList,function(e,t){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.id}})})),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.type"),prop:"type"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:e.$t("pholder.eventType"),disabled:e.addAbleType},on:{change:e.addchangeType},model:{value:e.addForm.type,callback:function(t){e.$set(e.addForm,"type",t)},expression:"addForm.type"}},[a("el-option",{attrs:{label:"节假日",value:0}},[e._v(e._s(e.$t("pholder.eventTypeA")))]),e._v(" "),a("el-option",{attrs:{label:"活动",value:1}},[e._v(e._s(e.$t("pholder.eventTypeB")))])],1),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.eventLevel"),prop:"level"}},[a("el-select",{staticClass:"manage-sel",attrs:{id:"addForm.level",placeholder:e.$t("pholder.eventLevel"),disabled:e.addAbleLevel},on:{change:e.addchangeLevel},model:{value:e.addForm.level,callback:function(t){e.$set(e.addForm,"level",t)},expression:"addForm.level"}},[a("el-option",{attrs:{label:"集团",value:1}},[e._v(e._s(e.$t("pholder.eventLevelA")))]),e._v(" "),a("el-option",{attrs:{label:"广场",value:2}},[e._v(e._s(e.$t("pholder.eventLevelB")))])],1),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("dialog.duration"),prop:"startDate"}},[a("el-col",{attrs:{span:11}},[a("el-form-item",{staticClass:"spe-form-item"},[a("el-date-picker",{staticClass:"manage-date-inp",attrs:{format:"MM 月 dd 日",type:"date",size:"mini","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:e.$t("pholder.startDate")},model:{value:e.addForm.startDate,callback:function(t){e.$set(e.addForm,"startDate",t)},expression:"addForm.startDate"}})],1)],1),e._v(" "),a("el-col",{staticClass:"line",staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("-")]),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{staticClass:"spe-form-item"},[a("el-date-picker",{staticClass:"manage-date-inp",attrs:{format:"MM 月 dd 日",type:"date",size:"mini","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:e.$t("pholder.endDate")},on:{change:function(t){e.endDateChange()}},model:{value:e.addForm.endDate,callback:function(t){e.$set(e.addForm,"endDate",t)},expression:"addForm.endDate"}})],1)],1),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.eventDay"),prop:"eventDate"}},[a("el-date-picker",{staticClass:"manage-date-inp",attrs:{format:"yyyy-MM-dd",type:"date",size:"mini","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:e.$t("table.eventDay")},model:{value:e.addForm.eventDate,callback:function(t){e.$set(e.addForm,"eventDate",t)},expression:"addForm.eventDate"}}),e._v(" "),a("i",{staticClass:"error-tip"},[e._v("*")])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("table.describe"),prop:"intro"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.addForm.intro,callback:function(t){e.$set(e.addForm,"intro",t)},expression:"addForm.intro"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(t){e.addDialogVisible=!1}}},[e._v(e._s(e.$t("dialog.cancel")))]),e._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(t){e.addSubmit("addForm")}}},[e._v(e._s(e.$t("dialog.confirm")))])],1)],1)},staticRenderFns:[]},s=a("VU/8")(l,i,!1,function(e){a("9Hqb")},"data-v-548d7c38",null);t.a=s.exports},zVxZ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("+RWB"),i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"manage-container zoneManage-wrapper"},[a("el-row",{staticClass:"manage-head-wrapper"},[a("el-col",{attrs:{span:18}},[a("span",{staticClass:"manage-select-box"},[a("el-select",{attrs:{filterable:"",placeholder:e.$t("pholder.select")},on:{change:e.mallChange},model:{value:e.mallValue,callback:function(t){e.mallValue=t},expression:"mallValue"}},e._l(e.mallListForTerm,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-button",{staticClass:"search-btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.searchFun}},[e._v(e._s(e.$t("button.search")))])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-button",{staticClass:"manage-add-btn",attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:e.addActHandle}},[e._v(e._s(e.$t("button.addEvent")))])],1)],1),e._v(" "),a("el-row",{staticClass:"manage-content"},[a("el-col",{attrs:{span:24}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"max-height":e.tableHeight,"header-row-class-name":"manage-tab-head"}},[a("el-table-column",{attrs:{prop:"tabOrder",align:"center",label:e.$t("table.order"),width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:e.$t("table.eventName"),align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mall.name",label:e.$t("table.square"),align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:e.$t("table.type"),align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"level",formatter:e.levelFormat,label:e.$t("table.eventLevel"),align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"startDate",label:e.$t("table.startTime"),formatter:e.timeFormat,align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"endDate",label:e.$t("table.endTime"),formatter:e.timeFormat,align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"eventDate",label:e.$t("table.eventDay"),formatter:e.timeFormat,align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"durationDay",label:e.$t("table.lastDay"),align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"intro",label:e.$t("table.eventDescription"),align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("table.operate"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){e.editRow(t.row)}}},[e._v(e._s(e.$t("button.edit")))]),e._v(" "),a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){e.delRow(t.row)}}},[e._v(e._s(e.$t("button.delete")))])]}}])})],1),e._v(" "),a("el-pagination",{staticClass:"manage-pagination-box",attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"sizes, prev, pager, next, slot",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.cerrentChange}},[a("span",{staticClass:"slot-pagination-ele slot-ele-total"},[e._v(e._s(e.$t("table.pageHead"))+" "+e._s(e.total)+" "+e._s(e.$t("table.pageTail")))])])],1)],1),e._v(" "),a("add-act-dialog",{ref:"addactModel"}),e._v(" "),a("edit-act-dialog",{ref:"editactModel"})],1)},staticRenderFns:[]},s=function(e){a("0UKX")},n=a("VU/8")(l.a,i,!1,s,"data-v-edaac63e",null);t.default=n.exports}});