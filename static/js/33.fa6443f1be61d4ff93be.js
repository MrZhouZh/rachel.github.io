webpackJsonp([33],{"5bYp":function(t,a){},GGyT:function(t,a){},cS8O:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("tWso"),l={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"camera-wrapper"},[e("el-header",{attrs:{height:"70px"}},[e("span",{staticClass:"behavior-title"},[t._v(t._s(t.repTitle)+"店员抓拍记录2")]),t._v(" "),e("span",{staticClass:"more-option-wrapper",on:{click:t.showCollapse}},[e("span",{staticClass:"more-option-text"},[t._v("更多选项")]),t._v(" "),e("i",{class:t.moreOptVisible?"el-icon-arrow-down more-option-arrow":"el-icon-arrow-down more-option-arrow more-option-up"})])]),t._v(" "),e("clerk-option",{directives:[{name:"show",rawName:"v-show",value:t.moreOptVisible,expression:"moreOptVisible"}],on:{emitParams:t.getPatams,emitTitle:t.getTitle,startLoading:t.startLoad}}),t._v(" "),e("div",{staticClass:"element-main behavior-main"},[e("div",{staticClass:"behavior-table-page"},[e("div",{staticClass:"behavior-table"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,"max-height":t.tableHeight,"header-row-class-name":"behavior-thead"},on:{"cell-mouse-enter":t.mouseenterHandle,"cell-mouse-leave":t.mouseleaveHandle}},[e("el-table-column",{attrs:{label:"序号",align:"center",prop:"seriesNum",width:"100"}}),t._v(" "),e("el-table-column",{attrs:{label:"姓名",align:"center",prop:"name"}}),t._v(" "),e("el-table-column",{attrs:{label:"年龄",align:"center",prop:"age"}}),t._v(" "),e("el-table-column",{attrs:{label:"性别",align:"center",prop:"gender",formatter:t.genderFormatter}}),t._v(" "),e("el-table-column",{attrs:{label:"时间",align:"center",prop:"counttime"}}),t._v(" "),e("el-table-column",{attrs:{label:"人脸图",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"face-img-box"},[e("img",{staticClass:"face-img",attrs:{src:t.dealImg(a.row),width:"50",height:"50",alt:""},on:{error:t.dealErrImg}})])]}}])}),t._v(" "),e("el-table-column",{attrs:{label:"对比图",align:"center"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("div",{staticClass:"face-img-box"},[e("img",{staticClass:"face-img",attrs:{src:t.row.staffPhotos,width:"50",height:"50",alt:""}})])]}}])})],1)],1),t._v(" "),e("div",{staticClass:"page-wrapper"},[e("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":t.pageArr,"page-size":t.pageSize,layout:"sizes, prev, pager, next, slot",total:t.totalPage},on:{"size-change":t.sizeChange,"current-change":t.handleCurrentChange}},[e("span",{staticClass:"slot-pagination-ele slot-ele-total"},[t._v("共 "+t._s(t.totalPage)+" 条记录, 每页显示")])])],1)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.detailVisible,expression:"detailVisible"}],staticClass:"detail-box",style:t.detailStyle},[e("div",{staticClass:"detail-img-box"},[e("img",{staticClass:"detail-img",attrs:{src:t.staffPic1,alt:""}})]),t._v(" "),e("div",{staticClass:"detail-img-box"},[e("img",{staticClass:"detail-img",attrs:{src:t.staffPic2,alt:""}})])])])],1)},staticRenderFns:[]},o=function(t){e("GGyT")},s=e("VU/8")(i.a,l,!1,o,"data-v-eb27a1cc",null);a.default=s.exports},tWso:function(t,a,e){"use strict";(function(t){var i=e("yKsA"),l=e("3MSA"),o=e.n(l);a.a={data:function(){return{params:{url:"",param:""},moreOptVisible:!1,tableData:[],defaultImg:o.a,currentPage:1,pageArr:[10,50,100],pageSize:10,totalPage:0,repTitle:"",loading:!0,tableHeight:0,emitData:{},detailStyle:{},detailVisible:!1,staffPic1:"",staffPic2:""}},components:{"clerk-option":i.a},created:function(){this.tableHeight=this.moreOptVisible?t(window).height()-300:t(window).height()-200},methods:{showCollapse:function(){var a=this,e="",i="",l="",o="";e=this.getStyleFn(".el-header","height"),i=this.getStyleFn(".camera-wrapper .el-header","height"),this.moreOptVisible?(this.moreOptVisible=!1,o=e+i+8+"px",t(".behavior-main").animate({marginTop:o})):(this.moreOptVisible=!0,setTimeout(function(){l=a.getStyleFn(".behavior-more-option","height"),o=e+i+l+8+"px",t(".behavior-main").animate({marginTop:o})},100))},setStaffDic:function(t){var a=this;this.axios.get("/staffs",{params:{mallId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){t.data.data.forEach(function(t){a.setSessionLocal("staff-"+t.personUnid,t.name),a.setSessionLocal("staffphoto-"+t.personUnid,t.photo)}),a.getTableData()})},getTableData:function(){var t=this;this.axios.get("/faceRecognitions",{params:this.emitData}).then(function(a){var e=a.data;200==e.code?(t.tableData=[],t.totalPage=e.data.total,e.data.list.forEach(function(a,e){a.pic=a.channelSerialnum+"|"+(a.facePic?a.facePic:"0"),a.seriesNum=(t.currentPage-1)*t.pageSize+e+1;var i=t.getSessionLocal("staff",a.personUnid);a.name=i||"未知";var l=t.getSessionLocal("staffphoto",a.personUnid);a.staffPhotos=l&&"undefined"!==l?window.apiUrl+"/staffs/img/"+l:t.defaultImg}),t.tableData=e.data.list,setTimeout(function(){t.loading=!1},1e3)):t.$message({showClose:!0,type:"error",message:t.$t("message.captureFailed")+e.msg})}).catch(function(t){})},dealImg:function(t){var a=t.pic.split("|")[0],e=t.pic.split("|")[1],i=t.counttime.split(" ")[0],l=i.split("-")[0]+i.split("-")[1]+i.split("-")[2];return"0"===e?this.defaultImg:window.picUrl+"/face/"+l+"/"+a+"/"+e},dealErrImg:function(t){(t||window.event).target.src=o.a},genderFormatter:function(t,a,e){var i="";return i=this.getSessionLocal("gender",e),i||"--"},handleSizeChange:function(t){this.emitData.pageSize=t,this.pageSize=t,this.loading=!0,this.getTableData()},handleCurrentChange:function(t){this.currentPage,this.emitData.page=t,this.currentPage=t,this.loading=!0,this.getTableData()},changeCurpage:function(t,a){this.currentPage=t},sizeChange:function(t){this.pageSize=t,this.emitData.pageSize=t,this.loading=!0,this.getTableData()},getTitle:function(t){this.repTitle=t},startLoad:function(t){"camera"===t&&(this.loading=!0)},getPatams:function(t){this.pageSize=t.pageSize,this.currentPage=t.page,this.emitData=t,this.setStaffDic(t.mallId)},mouseenterHandle:function(t,a,e,i){var l=parseInt(window.getComputedStyle(document.querySelector(".behavior-main")).marginLeft.replace(/[a-z]/g,"")),o=i.pageY-50+"px",s=i.pageX-l+10+"px";this.detailStyle={width:"auto",left:s,top:o};var n=this;n.isLoadErr(n.dealImg(t),function(t){n.staffPic1=t}),n.staffPic2=t.staffPhotos?t.staffPhotos:n.defaultImg,n.detailVisible=!0},isLoadErr:function(t,a){a=a||function(){};var e=new Image;e.src=t,e.onload=function(){a(t)},e.onerror=function(){a(o.a)}},mouseleaveHandle:function(t,a,e,i){this.detailVisible=!1,this.detailStyle={width:"auto"}}}}}).call(a,e("7t+N"))},yKsA:function(t,a,e){"use strict";var i={props:{params:Object,pageSize:[String,Number]},data:function(){return{date1:"",pickerOptions1:{disabledDate:function(t){return t.getTime()>Date.now()}},mallName:"",mallVal:"",mallOpt:[],monitoryVal:"",monitoryName:"",monitoryOpt:[],cameraVal:"",cameraOpt:[],timeVal:[],account_id:"",Params:{},isEffect:!0}},created:function(){this.timeVal=[dateUnit.dateFormat(new Date,"yyyy-MM-dd")+" 00:00:00",dateUnit.dateFormat(new Date,"yyyy-MM-dd")+" 23:59:59"],this.getMallList()},mounted:function(){},methods:{getMallList:function(){var t=this;this.mallOpt=[],this.mallVal="",this.mallName="",this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),status:1,_t:Date.parse(new Date)/1e3}}).then(function(a){var e=a.data.data,i="";if(e.length>0){var l=window.sessionStorage.getItem("mallId");l&&Number(l),t.mallOpt=e,e.forEach(function(t,a){l&&t.id==l&&(i=t.name)}),t.mallName=i||e[0].name,t.mallVal=l?Number(l):e[0].id,t.getGates(t.mallVal),t.clickHandle()}}).catch(function(t){})},chooseMall:function(){var t=this;this.mallOpt.forEach(function(a){a.id==t.mallVal&&(t.mallName=a.name)}),this.getGates(this.mallVal)},getGates:function(t){var a=this;this.monitoryOpt=[],this.monitoryVal="",this.monitoryName="",this.axios.get("/gates",{params:{mallId:t,status:1,isHasFace:1,_t:Date.parse(new Date)/1e3}}).then(function(t){var e=t.data.data;e.length&&(e.unshift({id:"",name:a.$t("pholder.allGate")}),a.monitoryOpt=e,a.monitoryVal=e[0].id,a.monitoryName=e[0].name)}).catch(function(t){})},chooseMonitory:function(){var t=this;this.monitoryOpt.forEach(function(a){a.id==t.monitoryVal&&(t.monitoryName=a.name)})},clickHandle:function(){var t=this;this.$emit("startLoading","camera"),this.timeVal.length<=1&&(this.timeVal=[dateUnit.dateFormat(new Date,"yyyy-MM-dd")+" 00:00:00",dateUnit.dateFormat(new Date,"yyyy-MM-dd")+" 23:59:59"]),setTimeout(function(){var a={counttime_gte:t.timeVal[0],counttime_lte:t.timeVal[1],accountId:t.$cookie.get("accountId"),mallId:t.mallVal,gateId:t.monitoryVal?t.monitoryVal:null,personType:1,direction:1,page:1,pageSize:10,sortName:"counttime",sortOrder:"DESC"};t.Params="&counttime_gte="+t.timeVal[0]+"&counttime_lte="+t.timeVal[1]+"&accountId="+t.$cookie.get("accountId")+"&mallId="+t.mallVal,t.cameraVal&&(t.Params=t.Params+"&channelId="+t.cameraVal),t.monitoryVal&&(t.Params=t.Params+"&gateId="+t.monitoryVal),t.Params=t.Params+"&personType=1",t.Params=t.Params+"&direction=1&page=1&pageSize=10&sortName=counttime&sortOrder=DESC";var e=(t.mallName?t.mallName+"-":t.mallName)+t.monitoryName+" "+t.timeVal[0].split(" ")[0]+"至"+t.timeVal[1].split(" ")[0]+" ";t.$emit("emitTitle",e),t.$emit("emitParams",a)},1e3)},searchHandle:function(t,a){var e=this,i=void 0===a?10:a,l=void 0===t?1:t,o={counttime_gte:this.timeVal[0],counttime_lte:this.timeVal[1],mallId:this.mallVal,gateId:this.monitoryVal?this.monitoryVal:null,personType:1,direction:1,page:l,pageSize:i,sortName:"counttime",sortOrder:"DESC",_t:Date.parse(new Date)/1e3};this.axios.get("/faceRecognitions",{params:o}).then(function(t){var a=t.data;200==a.code?e.$emit("conditionData",a.data):e.$message({showClose:!0,type:"error",message:e.$t("message.captureFailed")+a.msg})}).catch(function(t){})},resetRefresh:function(){this.timeVal=[dateUnit.dateFormat(new Date,"yyyy-MM-dd")+" 00:00:00",dateUnit.dateFormat(new Date,"yyyy-MM-dd")+" 23:59:59"]},uploadData:function(){var t=localStorage.getItem("lang");if(t){t="&localLanguage="+{mall_cn:"zh_CN",zh_CN:"zh_CN",en_US:"en_US",zh_TW:"zh_TW"}[t]}var a=window.apiUrl+"/faceRecognitions/excel?"+this.Params+t;window.open(a)}}},l={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"behavior-more-option behavior-test-option"},[e("div",{staticClass:"opt-left"},[e("div",{staticClass:"test-opt-mall"},[e("el-select",{staticClass:"mall-opt",attrs:{filterable:"",placeholder:t.$t("pholder.shopSelect")},on:{change:t.chooseMall},model:{value:t.mallVal,callback:function(a){t.mallVal=a},expression:"mallVal"}},t._l(t.mallOpt,function(t,a){return e("el-option",{key:t.value,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),e("div",{staticClass:"test-opt-monitory"},[e("el-select",{staticClass:"monitory-opt",attrs:{filterable:"",placeholder:t.$t("pholder.site")},on:{change:t.chooseMonitory},model:{value:t.monitoryVal,callback:function(a){t.monitoryVal=a},expression:"monitoryVal"}},t._l(t.monitoryOpt,function(t,a){return e("el-option",{key:t.value,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),""!==t.monitoryVal?e("div",{staticClass:"test-opt-camera"},[e("el-select",{attrs:{filterable:"",placeholder:t.$t("pholder.camera")},model:{value:t.cameraVal,callback:function(a){t.cameraVal=a},expression:"cameraVal"}},t._l(t.cameraOpt,function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1):t._e(),t._v(" "),e("div",{staticClass:"test-opt-time mr20"},[e("el-date-picker",{staticClass:"time-opt",attrs:{type:"datetimerange","picker-options":t.pickerOptions1,format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":t.$t("pholder.startDate"),"end-placeholder":t.$t("pholder.endDate")},on:{change:t.clickHandle},model:{value:t.timeVal,callback:function(a){t.timeVal=a},expression:"timeVal"}})],1)]),t._v(" "),e("div",{staticClass:"opt-right"},[e("el-button",{staticClass:"primary-btn behavior-collapse-btn",attrs:{type:"primary",size:"samll"},on:{click:t.clickHandle}},[t._v(t._s(t.$t("button.confirm")))]),t._v(" "),e("el-button",{staticClass:"primary-btn behavior-collapse-btn",attrs:{type:"primary",size:"samll"},on:{click:t.uploadData}},[t._v(t._s(t.$t("button.load")))])],1)])},staticRenderFns:[]},o=e("VU/8")(i,l,!1,function(t){e("5bYp")},"data-v-22a0c2aa",null);a.a=o.exports}});