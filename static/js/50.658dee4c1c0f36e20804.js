webpackJsonp([50],{"193Z":function(e,t,a){"use strict";(function(e){var l=a("mvHQ"),i=a.n(l),n=a("PAnj"),s=a.n(n);t.a={data:function(){return{defaultImage:'this.src="'+a("PAnj")+'"',blocList:[],mallListForTerm:[],floorListForTerm:[],zoneListForTerm:[],blocValue:"",mallValue:"",floorValue:"",zoneValue:"",isAisle:"",mallGateVal:"",tableHeight:0,tableData:[],total:0,pageSize:10,currentPage:1,mallList:[],levelVal:"",mallItem:"",mallOps:[],floorItem:"",floorOps:[],zoneItem:"",zoneOps:[],gateItem:"",gateOps:[],localIp_like:"",serialnum_like:"",cStatus:"",lang:"",channelTime:{},allRefresh:!1,Img:"",showImg:!1}},watch:{},mounted:function(){},created:function(){var t=e(window).height();this.tableHeight=t-.24*t,this.getAccountList(),this.getImgTime()},methods:{i18n:function(e){var t="pholder."+e;return"allFloor"==e?this.$t(t):e},bindRow:function(){this.$refs.bindModel.dialogInit()},addDeviceHandle:function(){this.$refs.addeviceModel.dialogInit(this.mallValue)},refresh:function(t){var a=this;1==t?(a.allRefresh=!0,e.ajax({url:"devices/snapshot",type:"get",dataType:"json",crossDomain:!0,success:function(e){setTimeout(function(){a.getImgTime(),a.tableData.forEach(function(e){e.photoUrl=a.dealImg(e.serialnum),a.allRefresh=!1})},3e3)},error:function(e){setTimeout(function(){a.allRefresh=!1},3e3)}})):(t.imgLoading=!0,e.ajax({url:"devices/snapshot/"+t.serialnum,type:"get",dataType:"json",crossDomain:!0,success:function(e){setTimeout(function(){a.getImgTime(),t.photoUrl=a.dealImg(t.serialnum),t.imgLoading=!1},3e3)},error:function(e){setTimeout(function(){t.imgLoading=!1},3e3)}}))},enlargeImg:function(e){e?(this.showImg=!0,this.Img=e):this.Img=s.a},showImgDiv:function(){1==this.showImg&&(this.showImg=!1)},getImgTime:function(){var e=this;this.axios.get("/channelSnapshots/nearlySnapshot",{params:{_t:Date.parse(new Date)/1e3}}).then(function(t){var a={};t.data.data.forEach(function(e){a[e.channelId]=e.counttime}),e.channelTime=a})},changeTime:function(e,t,a){if(a&&this.channelTime[a])return this.channelTime[a]},getTableData:function(){var e=this;this.tableData=[];var t={mallId:this.mallValue,floorId_arr:this.floorValue?this.floorValue:null,zoneId_arr:this.zoneValue?this.zoneValue:null,isMallGate:this.mallGateVal?this.mallGateVal:null,status:this.cStatus,gateId_null:!1,Ip:"%"+this.localIp_like+"%",serialnum_like:"%"+this.serialnum_like+"%",page:this.currentPage,pageSize:this.pageSize,sortName:'"device".local_ip ,"channel".serialnum',_t:Date.parse(new Date)/1e3};this.axios.get("/channels/filter",{params:t}).then(function(t){var a=t.data;a.data.list.forEach(function(t,a){t.tabOrder=(e.currentPage-1)*e.pageSize+a+1,t.photoUrl=e.dealImg(t.serialnum),t.imgLoading=!1}),e.tableData=a.data.list,e.total=a.data.total}).catch(function(e){})},sizeChange:function(e){this.pageSize=e,this.getTableData()},cerrentChange:function(e){this.currentPage!=e&&(this.currentPage=e,this.getTableData())},statusFormatter:function(e,t,a){return 1==a?"在线":"离线"},searchFun:function(){this.currentPage=1,this.getTableData()},getAccountList:function(){var e=this;this.blocList=[],this.blocValue="",this.axios.get("/accounts",{params:{_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data;a.data.forEach(function(t,a,l){t.id==e.$cookie.get("accountId")&&(e.blocValue=t.id)}),e.blocList=a.data,e.getMallListForTerm(e.blocValue)}).catch(function(e){})},blocChange:function(){this.getMallListForTerm(this.blocValue)},mallChange:function(){this.getFloorListForTerm(this.mallValue)},floorChange:function(){this.getZoneListForTerm(this.mallValue,this.floorValue)},getMallListForTerm:function(e){var t=this;this.mallListForTerm=[],this.mallValue="",this.axios.get("/malls",{params:{accountId:e,_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.length&&(t.mallValue=a.data[0].id,t.getFloorListForTerm(t.mallValue),t.mallListForTerm=a.data),t.getTableData()}).catch(function(e){})},getFloorListForTerm:function(e){var t=this;this.floorValue="",this.floorListForTerm=[],this.axios.get("/floors",{params:{mallId:e,_t:Date.parse(new Date)/1e3}}).then(function(a){var l=a.data;l.data.length>0?(l.data.unshift({id:"",name:t.$t("pholder.allFloor")}),t.floorValue=l.data[0].id,t.getZoneListForTerm(e,t.floorValue),t.floorListForTerm=l.data):t.getZoneListForTerm(e)}).catch(function(e){})},getZoneListForTerm:function(e,t){var a=this;this.zoneValue="",this.zoneListForTerm=[],this.axios.get("/zones",{params:{mallId:e,floorId:t||null,sortName:'"floor".name, "zone".name',_t:Date.parse(new Date)/1e3}}).then(function(e){var t=e.data;t.data.length>0&&t.data.unshift({id:"",name:"全部区域"}),a.zoneListForTerm=t.data,a.floorListForTerm.forEach(function(e){0==index&&(a.zoneValue=e.id)})}).catch(function(e){})},editRow:function(e){var t=JSON.parse(i()(e));this.$refs.editdeviceModel.dialogInit(t)},detailRow:function(e){var t=JSON.parse(i()(e));this.$refs.detailModel.dialogInit(t)},dealImg:function(e,t){if(e&&t){return"snapshot/real/"+e+".jpg?x-oss-process=style/thumbnail-0.1?t="+Date.parse(new Date)/1e3}if(e){return"snapshot/real/"+e+".jpg?t="+Date.parse(new Date)/1e3}}}}}).call(t,a("7t+N"))},"4wEt":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("193Z"),i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"manage-container deviceStatus-wrapper"},[a("el-row",{staticClass:"manage-head-wrapper"},[a("el-col",{attrs:{span:20,sm:20}},[a("div",{staticClass:"manage-select-box"},[a("el-select",{attrs:{filterable:"",placeholder:e.$t("pholder.shop")},on:{change:e.mallChange},model:{value:e.mallValue,callback:function(t){e.mallValue=t},expression:"mallValue"}},e._l(e.mallListForTerm,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"mall"==e.$Project,expression:"$Project == 'mall' ? true : false"}],staticClass:"manage-select-box"},[a("el-select",{attrs:{filterable:"",placeholder:e.$t("pholder.floor")},on:{change:e.floorChange},model:{value:e.floorValue,callback:function(t){e.floorValue=t},expression:"floorValue"}},e._l(e.floorListForTerm,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"mall"==e.$Project,expression:"$Project == 'mall' ? true : false"}],staticClass:"manage-select-box"},[a("el-select",{attrs:{filterable:"",placeholder:e.$t("pholder.area")},model:{value:e.zoneValue,callback:function(t){e.zoneValue=t},expression:"zoneValue"}},e._l(e.zoneListForTerm,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("div",{staticClass:"manage-select-box"},[a("el-select",{staticClass:"mall-gate-sel",attrs:{placeholder:e.$t("asisTab.inOut")},model:{value:e.isAisle,callback:function(t){e.isAisle=t},expression:"isAisle"}},[a("el-option",{attrs:{label:e.$t("pholder.all"),value:""}}),e._v(" "),a("el-option",{attrs:{label:e.$t("pholder.inOut"),value:!0}}),e._v(" "),a("el-option",{attrs:{label:e.$t("pholder.Nonentry"),value:!1}})],1)],1),e._v(" "),a("div",{staticClass:"manage-input-box"},[a("el-input",{staticClass:"search-inp",attrs:{placeholder:e.$t("pholder.ip"),clearable:""},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.searchFun(t)}},model:{value:e.localIp_like,callback:function(t){e.localIp_like=t},expression:"localIp_like"}})],1),e._v(" "),a("div",{staticClass:"manage-input-box"},[a("el-input",{staticClass:"search-inp",attrs:{size:"mini",placeholder:e.$t("pholder.deviceNumber"),clearable:""},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.searchFun(t)}},model:{value:e.serialnum_like,callback:function(t){e.serialnum_like=t},expression:"serialnum_like"}})],1),e._v(" "),a("div",{staticClass:"manage-select-box device-inp-box"},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:e.$t("pholder.state")},model:{value:e.cStatus,callback:function(t){e.cStatus=t},expression:"cStatus"}},[a("el-option",{attrs:{label:e.$t("pholder.allstate"),value:""}}),e._v(" "),a("el-option",{attrs:{label:e.$t("pholder.stateA"),value:1}}),e._v(" "),a("el-option",{attrs:{label:e.$t("pholder.stateB"),value:0}})],1)],1),e._v(" "),a("el-button",{staticClass:"search-btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.searchFun}},[e._v(e._s(e.$t("button.search")))])],1),e._v(" "),a("el-col",{attrs:{span:4,sm:4}},[a("div",{staticClass:"btn-box"},[a("el-button",{staticClass:"manage-refresh-btn fl-btn",attrs:{type:"primary",size:"mini",loading:e.allRefresh},on:{click:function(t){e.refresh(!0)}}},[e._v(e._s(e.$t("button.refresh")))])],1)])],1),e._v(" "),a("el-row",{staticClass:"manage-content"},[a("el-col",{attrs:{span:24}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"max-height":e.tableHeight,"header-row-class-name":"manage-tab-head"}},[a("el-table-column",{attrs:{prop:"tabOrder",align:"center",label:e.$t("table.order"),width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("table.localIP"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"iplink-column",attrs:{href:t.row.device.localIp?"http://"+t.row.device.localIp+":8080":"javascript:;",target:"_blank"}},[e._v(e._s(t.row.device.localIp))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"serialnum",label:e.$t("table.deviceNum"),align:"center",width:"220"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:e.$t("table.time"),align:"center",formatter:e.changeTime}}),e._v(" "),a("el-table-column",{attrs:{prop:"gate.name",label:e.$t("table.monitorSiteName"),align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"wanIp",label:e.$t("table.deviceImg"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{placement:"left",title:"",trigger:"hover"}},[a("div",{staticClass:"decive-img-box",attrs:{slot:"reference"},on:{click:function(a){e.enlargeImg(t.row.photoUrl)}},slot:"reference"},[a("img",{staticClass:"device-img",attrs:{src:t.row.photoUrl,width:"50",height:"50",alt:"",onerror:e.defaultImage}})]),e._v(" "),a("img",{staticClass:"float-img",attrs:{src:t.row.photoUrl,width:"200",height:"200",alt:"",onerror:e.defaultImage}})])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("table.operate"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small",disabled:t.row.imgLoading},on:{click:function(a){e.refresh(t.row)}}},[e._v(e._s(e.$t("button.refresh"))),t.row.imgLoading?a("i",{staticClass:"el-icon-loading el-icon--right"}):e._e()])]}}])})],1),e._v(" "),a("el-pagination",{staticClass:"manage-pagination-box",attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"sizes, prev, pager, next, slot",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.cerrentChange}},[a("span",{staticClass:"slot-pagination-ele slot-ele-total"},[e._v(e._s(e.$t("table.pageHead"))+" "+e._s(e.total)+" "+e._s(e.$t("table.pageTail")))])])],1)],1),e._v(" "),e.showImg?a("div",{staticClass:"img-loading-mask",staticStyle:{"background-color":"rgba(0, 0, 0, 0.8)"},on:{click:e.showImgDiv}},[a("div",{staticClass:"enlarge-img"},[a("div",{staticClass:"img-container"},[e._m(0),e._v(" "),a("img",{staticClass:"screen-img",attrs:{src:e.Img,onerror:e.defaultImage}})])])]):e._e()],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"close-img__headerbtn",attrs:{type:"button","aria-label":"Close"}},[t("i",{staticClass:"img__close el-icon el-icon-close"})])}]},n=function(e){a("ohaO")},s=a("VU/8")(l.a,i,!1,n,"data-v-1b3603d1",null);t.default=s.exports},ohaO:function(e,t){}});