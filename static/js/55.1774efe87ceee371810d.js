webpackJsonp([55],{"0tu2":function(t,e,a){"use strict";(function(t){var i=a("wkuu"),r=a.n(i);e.a={props:{propparam:Object},data:function(){return{floorPlanUrl:window.apiUrl+"/floors/img/",blocValue:null,svgPath:"",createSvg:!1,levelHeat:{high:"#f00",middle:"#0f0",low:"#ff0",zero:"none"},checkTemp:"relativeTemp",colorLegend:[{text:"一级",color:"#028108"},{text:"二级",color:"#85c403"},{text:"三级",color:"#f9ff02"},{text:"四级",color:"#f48111"},{text:"五级",color:"#f90000"}],colorLevel:{1:"#028108",2:"#85c403",3:"#f9ff02",4:"#f48111",5:"#f90000"},trafficLevel:[{color:"#028108"},{color:"#85c403"},{color:"#f9ff02"},{color:"#f48111"},{color:"#f90000"}],changeLegend:[],tempData:{},emitData:{},textId:[],polygonId:[]}},watch:{propparam:{handler:"refreshHandle",immediate:!0}},created:function(){this.blocValue=this.$cookie.get("accountId")},mounted:function(){},methods:{refreshHandle:function(t){"/floorheat/floorheatmap"===t.dateType&&(this.emitData=t.data,this.getImage())},getImage:function(){var t=this;this.createSvg=!1;var e={accountId:this.blocValue,mallId:this.emitData.asis_mallId,_t:Date.parse(new Date)/1e3};this.axios.get("/floors/"+this.emitData.asis_org,{params:e}).then(function(e){var a=e.data.data.floorPlan;t.svgPath=a?t.floorPlanUrl+a:r.a,t.createSvg=!0,t.getTempData()}).catch(function(t){console.log(t)})},testData:function(){var t=this;this.tempData={1:{relativeTemperature:[1,200],portraitTemperature:[2,300]},2:{relativeTemperature:[1,200],portraitTemperature:[5,300]},8:{relativeTemperature:[1,200],portraitTemperature:[3,300]},9:{relativeTemperature:[1,200],portraitTemperature:[4,300]},"-1":31578,"-2":2290};this.tempData[-1];for(var e=this.tempData[-2],a=this.tempData[-1],i=.5;i<4;i++){this.trafficLevel[0].text=0;for(i=.5;i<4;i++){var r=((a-e)*i+3*e)/3;3.5==i&&(r=a),this.trafficLevel[i+.5].text=Math.round(r)}}console.log(this.trafficLevel);var l={};if("TAB_RELATIVETEMPERATURE"===this.emitData.asis_kpi){var o=this.tempData[-1],s=this.tempData[-2];delete this.tempData[-1],delete this.tempData[-2];for(i=0;i<5;i++){var n=((o-s)*i+4*s)/4;0==i&&(n=0),this.trafficLevel[i].text=Math.floor(n)}this.changeLegend=this.trafficLevel}else this.changeLegend=this.colorLegend;setTimeout(function(){var e=document.getElementById("heatmapSvg");for(var a in t.tempData)"TAB_RELATIVETEMPERATURE"===t.emitData.asis_kpi?t.tempData[a].relativeTemperature&&(l=e.getElementById(a),t.createCloneEle(a,"relativeTemperature",l)):t.tempData[a].portraitTemperature&&(l=e.getElementById(a),t.createCloneEle(a,"portraitTemperature",l))},500)},getTempData:function(){var t=this;this.trafficLevel=[{color:"#028108"},{color:"#85c403"},{color:"#f9ff02"},{color:"#f48111"},{color:"#f90000"}],this.tempData={};var e={};(e="TAB_RELATIVETEMPERATURE"===this.emitData.asis_kpi?{startDate:this.emitData.asis_time[0],endDate:this.emitData.asis_time[1],option:this.emitData.asis_kpi}:{date:this.emitData.asis_time,option:this.emitData.asis_kpi})._t=Date.parse(new Date)/1e3,this.axios.get("/heatmap/floorHeatmap/"+this.emitData.asis_org,{params:e}).then(function(e){t.tempData=e.data.data;var a={};if("TAB_RELATIVETEMPERATURE"===t.emitData.asis_kpi){var i=t.tempData[-1],r=t.tempData[-2],l=t.tempData[-3];if(i>l){t.trafficLevel[0].text=0;for(var o=.5;o<4;o++){var s=((l-r)*o+3*r)/3;3.5==o&&(s=l),t.trafficLevel[o+.5].text=Math.round(s)}}else for(o=0;o<5;o++){var n=((i-r)*o+4*r)/4;0==o&&(n=0),t.trafficLevel[o].text=Math.round(n)}delete t.tempData[-1],delete t.tempData[-2],delete t.tempData[-3],t.changeLegend=t.trafficLevel}else t.changeLegend=t.colorLegend;setTimeout(function(){var e=document.getElementById("heatmapSvg");for(var i in t.tempData)"TAB_RELATIVETEMPERATURE"===t.emitData.asis_kpi?t.tempData[i].relativeTemperature&&(a=e.getElementById(i),t.createCloneEle(i,"relativeTemperature",a)):t.tempData[i].portraitTemperature&&(a=e.getElementById(i),t.createCloneEle(i,"portraitTemperature",a))},500)}).catch(function(t){console.log(t)})},createCloneEle:function(e,a,i){var r=this.getColorLevel(this.tempData[e][a][0]);if(i){var l=i.parentElement.getElementsByTagName("text")[0],o=t(l).clone();o.attr("id",l.getAttribute("id")+e),o.children("tspan").html(this.tempData[e][a][1]);var s=l.firstElementChild.getAttribute("y")-0+10,n=l.firstElementChild.getAttribute("x")-0+8;o[0].firstElementChild.setAttribute("y",s),o[0].firstElementChild.setAttribute("x",n),l.parentElement.appendChild(o[0]),i.setAttribute("fill",r),i.setAttribute("fill-opacity","0.8")}},getHeatColor:function(t,e){var a="";return a=0==t?"zero":t>=e?"high":t<e&&t<e/3?"middle":"low",this.levelHeat[a]},getColorLevel:function(t){if(t)return this.colorLevel[t]},switchTemp:function(){var e="",a={};if("relativeTemp"==this.checkTemp)for(var i in this.tempData)this.changeLegend=this.trafficLevel,e=this.getColorLevel(this.tempData[i].relativeTemperature[0]),(a=document.getElementById("heatmapSvg").getElementById(i))&&(t(a.nextElementSibling.nextElementSibling).children("tspan").html(this.tempData[i].relativeTemperature[1]),a.setAttribute("fill",e),a.setAttribute("fill-opacity","0.8"));else for(var i in this.tempData)this.changeLegend=this.colorLegend,e=this.getColorLevel(this.tempData[i].portraitTemperature[0]),(a=document.getElementById("heatmapSvg").getElementById(i))&&(t(a.nextElementSibling.nextElementSibling).children("tspan").html(this.tempData[i].portraitTemperature[1]),a.setAttribute("fill",e),a.setAttribute("fill-opacity","0.8"))}}}}).call(e,a("7t+N"))},MIJ0:function(t,e){},ZlAO:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("0tu2"),r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"gate-heatmap"},[a("div",{staticClass:"legend-box"},[a("div",{staticClass:"color-legend"},t._l(t.changeLegend,function(e,i){return a("div",{key:i,staticClass:"color-box"},[a("p",{staticClass:"color-text",style:{top:(i+1)%2==0?"19px":"-21px"}},[t._v(t._s(e.text))]),t._v(" "),a("span",{staticClass:"color-block",style:{"background-color":e.color}}),t._v(" "),a("span",{staticClass:"border-span",style:{top:(i+1)%2==0?"14px":"-5px"}})])}))]),t._v(" "),a("div",{staticClass:"floor-heatmap-box"},[t.createSvg?a("simple-svg",{staticClass:"simple-svg",attrs:{filepath:t.svgPath,fill:"#fff",stroke:"#000",width:"100%",height:"100%",id:"heatmapSvg"}}):t._e()],1)])},staticRenderFns:[]},l=function(t){a("MIJ0")},o=a("VU/8")(i.a,r,!1,l,"data-v-7cf1e511",null);e.default=o.exports}});