webpackJsonp([58],{"+4EN":function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("ZWbj"),s={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"monthly"},[e("div",{staticClass:"asis-table-wrapper single-report-wrapper"},[e("h3",{staticClass:"asis-table-header single-report-header"},[e("el-select",{staticClass:"select-box",attrs:{size:"mini",placeholder:a.$t("pholder.select")},on:{change:function(t){a.changeSel("detailData",a.kpiValue)}},model:{value:a.kpiValue,callback:function(t){a.kpiValue=t},expression:"kpiValue"}},a._l(a.kpiOption,function(t){return e("el-option",{key:t.value,attrs:{label:a.i18n(t.label),value:t.value}})})),a._v(" "),e("span",{staticClass:"asis-table-download",on:{click:function(t){a.dealExport("domDayAdd",a.i18nFormatter(a.detailData_title))}}},[a._v(a._s(a.$t("allPages.load")))])],1),a._v(" "),e("div",{staticClass:"asis-table-content"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:a.selLoading,expression:"selLoading"}],staticClass:"asis-table",staticStyle:{width:"100%"},attrs:{id:"domDayAdd",data:a.tableData,"header-row-class-name":"asis-table-head","max-height":a.tableHeight}},[a._l(a.detailData_head,function(a,t){return e("el-table-column",{key:t,attrs:{prop:a.prop,label:a.label,align:"center","min-width":"100",fixed:0==t}})}),a._v(" "),e("el-table-column",{attrs:{prop:"averageVal",label:a.$t("table.average"),"show-overflow-tooltip":"",align:"center"}}),a._v(" "),e("el-table-column",{attrs:{prop:"sums",label:a.$t("table.total"),"show-overflow-tooltip":"",align:"center"}})],2)],1)])])},staticRenderFns:[]},l=function(a){e("/sQr")},d=e("VU/8")(i.a,s,!1,l,"data-v-a02d48aa",null);t.default=d.exports},"/sQr":function(a,t){},ZWbj:function(a,t,e){"use strict";(function(a){var i=e("mvHQ"),s=e.n(i),l=e("DQZ8");t.a={props:{propparam:Object},data:function(){return{loading:!0,selLoading:!0,kpiValue:"TRAFFIC",kpiOption:[{label:"TRAFFIC",value:"TRAFFIC"},{label:"SALES",value:"SALES"},{label:"DEPTH",value:"DEPTH"},{label:"PREPRICE",value:"PREPRICE"},{label:"PERAREAVALUE",value:"PERAREAVALUE"},{label:"DURATIONTIME",value:"DURATIONTIME"}],kpiData_head:[{label:"层面/指标",prop:"kpi"},{label:"客流量",prop:"flow"},{label:"销售额",prop:"sales"},{label:"进店率",prop:"storeRate"},{label:"成交量",prop:"volume"},{label:"客单价",prop:"guestPrice"},{label:"坪效",prop:"pingEffect"}],detailData_head:[{label:"日期",prop:"date"}],kpiData_title:"",detailData_title:"",kpiData_ops:[],detailData_ops:[],tableKeyToId:{},tableIds:"",emitData:{},headDataName:[],rowLen:Number,tableHeight:0}},computed:{tableData:function(){if(this.detailData_ops.length){var a={},t={},e=0;for(var i in this.detailData_ops[0])"defaultOrg0"==i?a[i]=this.$t("table.total"):"defaultOrg1"==i?a[i]="--":a[i]?a[i]+=item[i]:a[i]=0;this.detailData_ops.map(function(t,i){e+=1;for(var s in t)isNaN(Number(a[s]))||isNaN(Number(t[s]))||(a[s]+=Number(Math.round(100*t[s])/100))});for(var s in a)t[s]="defaultOrg0"==s?this.$t("table.average"):"defaultOrg1"==s?"--":Number(Math.round(a[s]/e*100)/100);return this.detailData_ops.push(t),this.detailData_ops.push(a),this.detailData_ops}}},components:{"common-tab":l.a},watch:{propparam:{handler:"refreshHandle",immediate:!0}},created:function(){var t=a(window).height(),e=.28;t<=720?e=.35:t<=768?e=.33:t<=900?e=.28:t<=1080&&(e=.31),this.tableHeight=t-t*e},mounted:function(){},methods:{i18n:function(a){var t="format."+a;return this.$t(t)},refreshHandle:function(a){"/baseasis/monthly"===a.dateType&&(this.emitData=a.data,this.loading=!0,this.selLoading=!0,this.tableIds&&"{}"!==s()(this.tableKeyToId)?this.getTableData(this.tableIds):this.getTableId())},getTableId:function(){var a=this;this.tableKeyToId={},this.tableIds="",this.axios.get("/reportCharts",{params:{report:"BasicReport",_t:Date.parse(new Date)/1e3}}).then(function(t){var e=t.data.data;e.forEach(function(t,i){a.tableKeyToId[t.key]=t.id,"kpiData"!==t.key&&"detailData"!==t.key||(i==e.length-1?a.tableIds+=t.id:a.tableIds+=t.id+",")}),a.getTableData(a.tableIds)})},getTableData:function(a){var t=this;if(a){this.kpiData_ops=[],this.detailData_ops=[];var e="",i={},s="",l="",d=[];if(this.emitData.asis_time)if(this.emitData.asis_time.getMonth()===(new Date).getMonth()&&this.emitData.asis_time.getFullYear()===(new Date).getFullYear())l=dateUnit.dateFormat(this.emitData.asis_time,"yyyy-MM-dd"),(s=dateUnit.dateFormat(new Date(Date.parse(this.emitData.asis_time.getFullYear()+"/"+(this.emitData.asis_time.getMonth()+1)+"/01")),"yyyy-MM-dd"))==l&&(l=dateUnit.dateFormat(new Date,"yyyy-MM-dd"));else{s=this.emitData.asis_time,l=new Date(Date.parse(this.dayAdd(this.emitData.asis_time,31).replace(/\-/,"/")));var r=this.unitTime(s,l,"month");s=r.startTime,l=r.endTime}else{s=new Date,l=new Date(Date.parse(this.dayAdd(new Date,31).replace(/\-/,"/")));var n=this.unitTime(s,l,"month");s=n.startTime,l=n.endTime}e="/report/basics/"+this.emitData.asis_level,i={orgIds:this.emitData.asis_org,startDate:s,endDate:l,chartIds:a,kpiType:this.kpiValue,_t:Date.parse(new Date)/1e3},this.axios.get(e,{params:i}).then(function(a){setTimeout(function(){t.loading=!1,t.selLoading=!1},500);t.kpiData_title="BasicReportkpiData",t.detailData_title="BasicReportdetailData",a.data.data.body.detailData.xaxis&&(d=a.data.data.body.detailData.xaxis.data,t.rowLen=d.length),t.detailData_head=t.autoComplateHead("detail",d);var e=a.data.data.body.detailData.series;e.length&&(t.detailData_ops=t.dealData(e,t.detailData_head))}).catch(function(a){console.log("err",a.message)})}},autoComplateHead:function(a,t){var e=[];return t.forEach(function(a,t){e.push({prop:"defaultOrg"+t,label:a})}),e},dealData:function(a,t){var e=this,i={},s=[],l="",d=0;return a.forEach(function(a){if(d=0,a.data.length<t.length)for(var r=0,n=t.length;r<n;r++)l=t[r].prop,i[l]=a.data[r]||0==a.data[r]?a.data[r]:"--",i.sums="--",i.averageVal="--","defaultOrg0"!=l&&"defaultOrg1"!=l&&i[l].constructor==Number&&(d+=Number(i[l]));else for(var o=0,h=a.data.length;o<h;o++)l=t[o].prop,i[l]=a.data[o]||0==a.data[o]?a.data[o]:"--",i.sums="--",i.averageVal="--","defaultOrg0"!=l&&"defaultOrg1"!=l&&i[l].constructor==Number&&(d+=Number(i[l]));i.sums=d;var p=d/(e.rowLen-2);i.averageVal=0==p?p:p.toFixed(2),s.push(i),i={}}),s},changeSel:function(a,t){var e=this;this.detailData_ops=[];var i="",s={},l="",d="",r=[],n=this.tableKeyToId[a];if(this.selLoading=!0,this.emitData.asis_time)if(this.emitData.asis_time.getMonth()===(new Date).getMonth())d=dateUnit.dateFormat(this.emitData.asis_time,"yyyy-MM-dd"),(l=dateUnit.dateFormat(new Date(Date.parse(this.emitData.asis_time.getFullYear()+"/"+(this.emitData.asis_time.getMonth()+1)+"/01")),"yyyy-MM-dd"))==d&&(d=dateUnit.dateFormat(new Date,"yyyy-MM-dd"));else{l=this.emitData.asis_time,d=new Date(Date.parse(this.dayAdd(this.emitData.asis_time,31).replace(/\-/,"/")));var o=this.unitTime(l,d,"month");l=o.startTime,d=o.endTime}else d=dateUnit.dateFormat(new Date,"yyyy-MM-dd"),l=dateUnit.dateFormat(new Date(Date.parse((new Date).getFullYear()+"/"+((new Date).getMonth()+1)+"/01")),"yyyy-MM-dd");i="/report/basics/"+this.emitData.asis_level,s={orgIds:this.emitData.asis_org,startDate:l,endDate:d,chartIds:n,kpiType:t,_t:Date.parse(new Date)/1e3},this.axios.get(i,{params:s}).then(function(a){setTimeout(function(){e.selLoading=!1},500);e.detailData_title="BasicReportdetailData",r=a.data.data.body.detailData.xaxis.data,e.detailData_head=e.autoComplateHead("detail",r);var t=a.data.data.body.detailData.series;e.detailData_ops=e.dealData(t,e.detailData_head)}).catch(function(a){})}}}}).call(t,e("7t+N"))}});