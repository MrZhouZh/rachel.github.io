webpackJsonp([68],{WFPH:function(e,t){},qdON:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("woOf"),a=n.n(o),i=n("mvHQ"),r=n.n(i),s=n("GXH0"),d={data:function(){return{btnDisabled:!0,treeData:[],defaultProps:{children:"children"},groupForm:{name:"",pid:"",intro:""},updTitle:"",isRoot:!1,defaultExpand:[],currentNode:{},treeVisible:!1,rootNode:[{label:this.$cookie.get("accountName")+"集团",name:this.$cookie.get("accountName")+"集团",id:-1,accountId:this.$cookie.get("accountId"),children:[]}],maxLevel:4,appunid:""}},components:{Treeselect:n.n(s).a},created:function(){this.getNode()},mounted:function(){this.btnDisabled=!0,this.treeVisible=!0},methods:{createdNode:function(){this.axios.post(window.menuUrl+"/api/v1/auth/apps",{name:"智慧客流分析平台",note:"平台"})},getNode:function(){var e=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps",{params:{_t:Date.parse(new Date)/1e3}}).then(function(t){t.data.list_data.forEach(function(t,n){t.name==e.$Project&&(e.appunid=t.unid)}),e.getMeun(e.appunid)}).catch(function(e){})},getMeun:function(e){var t=this;this.axios.get(window.menuUrl+"/api/v1/auth/apps/"+e+"/menus",{params:{_t:Date.parse(new Date)/1e3}}).then(function(e){var n=[];e.data.menu_tree.length>=2?n.push(e.data.menu_tree[1]):n.push(e.data.menu_tree[0]);var o=[],a=[];n.forEach(function(e,n){var i={};i.unid=e.unid,i.id=e.perm_unid,"mall"==t.$Project?i.label="智慧商业客流分析平台":i.label="智慧连锁客流分析平台",o.push(i),e.children.forEach(function(e,t){var n=[],o={};o.unid=e.unid,o.id=e.perm_unid,o.label=e.note,a.push(o),e.children.forEach(function(t,o){var a={};e.unid==t.parent&&(a.unid=t.unid,a.id=t.perm_unid,a.label=t.note),n.push(a)}),a[t].children=n}),o[n].children=a}),t.treeData=o}).catch(function(e){})},getGroup:function(e){this.axios.get("/groups",{params:{pid:e,_t:Date.parse(new Date)/1e3}}).then(function(e){}).catch(function(e){})},nodeExpand:function(e,t,n){this.currentNode=e},nodeClick:function(e,t,n){if(this.isRoot=1==t.level,-1===e.id)return this.groupForm={name:"",pid:"",id:"",intro:""},void(this.btnDisabled=!0);this.updTitle=!0,this.groupForm.id=e.id,this.groupForm.name=e.label,this.groupForm.pid=e.pid,this.groupForm.intro=e.intro,this.currentNode=e,this.btnDisabled=!1},treeAct:function(e,t,n,o){(e||window.event).stopPropagation(),this.updTitle=!1,this.isRoot=!1,this.currentNode=n,this.groupForm.id="",this.groupForm.name="",this.groupForm.intro="",this.groupForm.pid=t.data.id,this.btnDisabled=!1},delNode:function(e,t,n,o){var a=this;(e||window.event).stopPropagation(),this.$confirm(this.$t("message.confirDelete"),this.$t("message.prompt"),{confirmButtonText:this.$t("message.confirm"),cancelButtonText:this.$t("message.cancel"),type:"warning"}).then(function(){a.axios.delete("/groups/"+n.id,{params:{_t:Date.parse(new Date)/1e3}}).then(function(e){if(200==e.data.code){n.id==a.groupForm.id&&(a.groupForm={name:"",pid:-1,id:"",intro:""});var o=t.parent,i=o.data.children||o.data,r=i.findIndex(function(e){return e.id===n.id});i.splice(r,1),a.$message({showClose:!0,type:"success",message:a.$t("message.node")+a.$t("message.deleteSuccess")})}else a.$message({showClose:!0,type:"error",message:a.$t("message.node")+a.$t("message.deleteFailed")+e.data.msg})})}).catch(function(){})},parentChange:function(e){this.groupForm.pid=e.unid},loadNode:function(e,t){var n=this;0===e.level&&setTimeout(function(){n.treeData=n.rootNode,t(n.rootNode)},0),e.level>=1&&this.getChild(e,t)},getChild:function(e,t){var n=this;this.axios.get("/groups",{params:{pid:e.data.id,accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(o){var a=o.data.data,i=void 0;i=a.length>0,setTimeout(function(){i?(a.forEach(function(e){e.label=e.name,e.children=[]}),n.dealTree(n.treeData,a),t(a)):-1===e.data.id?setTimeout(function(){n.treeData=[],n.treeData=n.rootNode,t([])},0):t([])},500)}).catch(function(e){console.log("load node err:",e.message)})},dealTree:function(e,t){var n=this,o=!1,a=null;t.forEach(function(i,r){e.forEach(function(e,r){i.pid==e.id?(i.label=i.name,i.children=[],e.children.length>0?(e.children.forEach(function(e,t){i.id==e.id&&(o=!0,a=t)}),o?e.children[a]=i:e.children.push(i)):e.children.push(i)):e.children&&n.dealTree(e.children,t)})})},remove:function(e,t){var n=e.parent,o=n.data.children||n.data,a=o.findIndex(function(e){return e.id===t.id});o.splice(a,1)},renderContent:function(e,t){var n=t.node,o=t.data,a=t.store,i=this;return n.level>=this.maxLevel?e("div",{class:"custom-tree-node"},[e("span",{class:"custom-tree-text"},[n.label]),e("span",{class:"el-icon-delete custom-del-icon",on:{click:function(e){return i.delNode(e,n,o,a)}}})]):1!=n.level?e("div",{class:"custom-tree-node"},[e("span",{class:"custom-tree-text"},[n.label]),e("div",[e("span",{class:"el-icon-delete custom-del-icon",on:{click:function(e){return i.delNode(e,n,o,a)}}}),e("span",{class:"el-icon-plus custom-plus-icon",on:{click:function(e){return i.treeAct(e,n,o,a)}}})])]):e("div",{class:"custom-tree-node"},[e("span",{class:"custom-tree-text"},[n.label]),e("span",{class:"el-icon-plus custom-plus-icon",on:{click:function(e){return i.treeAct(e,n,o,a)}}})])},submitForm:function(e){var t=this;if(this.isRoot)return this.rootNode.forEach(function(e){e.label=t.groupForm.name,e.name=t.groupForm.name,e.intro=t.groupForm.intro}),window.sessionStorage.setItem("groupRoot",r()(this.rootNode)),void(this.treeData=this.rootNode);"{}"!==r()(this.currentNode)&&this.$refs[e].validate(function(e){if(e){var n="",o={};o=JSON.parse(r()(t.groupForm)),n="/api/v1/auth/apps/"+t.currentNode.id+"/menus",t.btnDisabled=!0,t.axios.post(window.menuUrl+n,{position:1,name:o.name,note:o.intro,parent:o.pid}).then(function(e){}).catch(function(e){t.btnDisabled=!1,t.$message({showClose:!0,type:"error",message:e.message})})}})},updateTree:function(e,t){for(var n=void 0,o=0;o<e.length;o++)(n=e[o]).id==t.pid?e[o].children&&(e[o].children.length?e[o].children.forEach(function(e){e.id==t.id&&(e.label=t.name,e=a()(e,t))}):e[o].children.push(t)):n.children&&this.updateTree(n.children,t)}}},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"groupManage-wrapper"},[n("el-row",{staticClass:"group-manage-box"},[n("el-col",{staticClass:"group-left-col",attrs:{span:6}},[n("el-scrollbar",{attrs:{"wrap-class":"list-scrollbar group-scrollbar",native:!1}},[e.treeVisible?n("el-tree",{ref:"tree",staticClass:"group-tree-box",attrs:{data:e.treeData,"node-key":"id","default-expanded-keys":e.defaultExpand,load:e.loadNode,"highlight-current":"","expand-on-click-node":!1,props:e.defaultProps,"render-content":e.renderContent},on:{"node-expand":e.nodeExpand,"node-click":e.nodeClick}}):e._e()],1)],1),e._v(" "),n("el-col",{staticClass:"group-right-col",attrs:{span:16,offset:2}},[n("h3",{staticClass:"edit-group-info"},[e._v(e._s(e.updTitle?e.$t("button.groupEdit"):e.$t("button.groupAdd"))+e._s(e.$t("table.addgroup")))]),e._v(" "),n("el-form",{ref:"groupForm",staticClass:"group-form",attrs:{model:e.groupForm,"status-icon":""}},[n("el-form-item",{attrs:{label:e.$t("table.groupName"),prop:"name"}},[n("el-input",{staticClass:"group-name-inp",attrs:{placeholder:e.$t("pholder.groupName")},model:{value:e.groupForm.name,callback:function(t){e.$set(e.groupForm,"name",t)},expression:"groupForm.name"}})],1),e._v(" "),e.isRoot?e._e():n("el-form-item",{attrs:{label:e.$t("table.parentGroup"),prop:"pid"}},[n("treeselect",{staticClass:"group-parent-sel",attrs:{value:e.groupForm.pid,options:e.treeData},on:{select:e.parentChange}})],1),e._v(" "),n("el-form-item",{attrs:{label:e.$t("table.basicInforM"),prop:"intro"}},[n("el-input",{staticClass:"group-info-text",attrs:{type:"textarea"},model:{value:e.groupForm.intro,callback:function(t){e.$set(e.groupForm,"intro",t)},expression:"groupForm.intro"}})],1),e._v(" "),n("el-form-item",[n("el-button",{staticClass:"group-form-btn group-del-btn",attrs:{type:"primary",disabled:""},on:{click:function(t){e.submitForm("groupForm")}}},[e._v(e._s(e.$t("button.confirm")))])],1)],1)],1)],1)],1)},staticRenderFns:[]},l=n("VU/8")(d,c,!1,function(e){n("WFPH")},null,null);t.default=l.exports}});