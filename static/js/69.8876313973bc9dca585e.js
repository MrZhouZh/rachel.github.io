webpackJsonp([69],{a62z:function(e,t){},"lXB/":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("woOf"),n=o.n(r),a=o("mvHQ"),s=o.n(a),i=o("GXH0"),c={data:function(){return{btnDisabled:!0,treeData:[],defaultProps:{children:"children"},groupForm:{name:"",nameEn:"",pid:"",intro:""},updTitle:"",isRoot:!1,defaultExpand:[],currentNode:{},treeVisible:!1,rootNode:[{label:this.$cookie.get("accountName"),name:this.$cookie.get("accountName"),nameEn:"",id:-1,accountId:this.$cookie.get("accountId"),children:[]}],maxLevel:4}},components:{Treeselect:o.n(i).a},created:function(){},mounted:function(){this.btnDisabled=!0,this.treeVisible=!0},methods:{getGroup:function(e){this.axios.get("/groups",{params:{pid:e,_t:Date.parse(new Date)/1e3}}).then(function(e){}).catch(function(e){})},nodeExpand:function(e,t,o){this.currentNode=e},nodeClick:function(e,t,o){if(this.isRoot=1==t.level,-1===e.id)return this.groupForm={name:"",nameEn:"",pid:"",id:"",intro:""},void(this.btnDisabled=!0);this.updTitle=!0,this.groupForm.id=e.id,this.groupForm.name=e.label,this.groupForm.nameEn=e.nameEn,this.groupForm.pid=e.pid,this.groupForm.intro=e.intro,this.currentNode=e,this.btnDisabled=!1},treeAct:function(e,t,o,r){(e||window.event).stopPropagation(),this.updTitle=!1,this.isRoot=!1,this.currentNode=o,this.groupForm.id="",this.groupForm.name="",this.groupForm.nameEn="",this.groupForm.intro="",this.groupForm.pid=t.data.id,this.btnDisabled=!1},delNode:function(e,t,o,r){var n=this;(e||window.event).stopPropagation(),this.$confirm(this.$t("message.confirDelete"),this.$t("message.prompt"),{confirmButtonText:this.$t("message.confirm"),cancelButtonText:this.$t("message.cancel"),type:"warning"}).then(function(){n.axios.delete("/groups/"+o.id,{params:{_t:Date.parse(new Date)/1e3}}).then(function(e){if(200==e.data.code){o.id==n.groupForm.id&&(n.groupForm={name:"",nameEn:"",pid:-1,id:"",intro:""});var r=t.parent,a=r.data.children||r.data,s=a.findIndex(function(e){return e.id===o.id});a.splice(s,1),n.$message({showClose:!0,type:"success",message:n.$t("message.node")+n.$t("message.deleteSuccess")})}else n.$message({showClose:!0,type:"error",message:n.$t("message.node")+n.$t("message.deleteFailed")+e.data.msg})})}).catch(function(){})},parentChange:function(e){this.groupForm.pid=e.id},loadNode:function(e,t){var o=this;0===e.level&&setTimeout(function(){o.treeData=o.rootNode,t(o.rootNode)},0),e.level>=1&&this.getChild(e,t)},getChild:function(e,t){var o=this;this.axios.get("/groups",{params:{pid:e.data.id,accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(r){var n=r.data.data,a=void 0;a=n.length>0,setTimeout(function(){a?(n.forEach(function(e){e.label=e.name,e.children=[]}),o.dealTree(o.treeData,n),t(n)):-1===e.data.id?setTimeout(function(){o.treeData=[],o.treeData=o.rootNode,t([])},0):t([])},500)}).catch(function(e){console.log("load node err:",e.message)})},dealTree:function(e,t){var o=this,r=!1,n=null;t.forEach(function(a,s){e.forEach(function(e,s){a.pid==e.id?(a.label=a.name,a.children=[],e.children.length>0?(e.children.forEach(function(e,t){a.id==e.id&&(r=!0,n=t)}),r?e.children[n]=a:e.children.push(a)):e.children.push(a)):e.children&&o.dealTree(e.children,t)})})},remove:function(e,t){var o=e.parent,r=o.data.children||o.data,n=r.findIndex(function(e){return e.id===t.id});r.splice(n,1)},renderContent:function(e,t){var o=t.node,r=t.data,n=t.store,a=this;return o.level>=this.maxLevel?e("div",{class:"custom-tree-node"},[e("span",{class:"custom-tree-text"},[o.label]),e("span",{class:"el-icon-delete custom-del-icon",on:{click:function(e){return a.delNode(e,o,r,n)}}})]):1!=o.level?e("div",{class:"custom-tree-node"},[e("span",{class:"custom-tree-text"},[o.label]),e("div",[e("span",{class:"el-icon-delete custom-del-icon",on:{click:function(e){return a.delNode(e,o,r,n)}}}),e("span",{class:"el-icon-plus custom-plus-icon",on:{click:function(e){return a.treeAct(e,o,r,n)}}})])]):e("div",{class:"custom-tree-node"},[e("span",{class:"custom-tree-text"},[o.label]),e("span",{class:"el-icon-plus custom-plus-icon",on:{click:function(e){return a.treeAct(e,o,r,n)}}})])},submitForm:function(e){var t=this;if(this.isRoot)return this.rootNode.forEach(function(e){e.label=t.groupForm.name,e.name=t.groupForm.name,e.nameEn=t.groupForm.nameEn,e.intro=t.groupForm.intro}),window.sessionStorage.setItem("groupRoot",s()(this.rootNode)),void(this.treeData=this.rootNode);if("{}"!==s()(this.currentNode)){this.groupForm.createUser=this.$cookie.get("userId"),this.groupForm.modifyUser=this.$cookie.get("userId");var o="",r={},n="";r=JSON.parse(s()(this.groupForm)),this.updTitle?(o="/groups/"+this.currentNode.id,r.modifyUser=this.currentNode.modifyUser,r.createUser=this.currentNode.createUser,r.accountId=this.currentNode.accountId,n="修改"):(o="/groups",r.createUser=this.$cookie.get("userId"),r.modifyUser=this.$cookie.get("userId"),r.accountId=this.currentNode.accountId,n="添加"),this.btnDisabled=!0,this.axios.post(o,r).then(function(e){var o=e.data;if(200==o.code){if(t.updTitle)t.updateTree(t.$refs.tree.children,o.data);else{var r=[];r.push(o.data),t.dealTree(t.treeData,r)}t.$message({showClose:!0,type:"success",message:n+"成功!"})}else t.$message({showClose:!0,type:"error",message:n+"失败!"});t.btnDisabled=!1}).catch(function(e){console.log("error:",e.message),t.btnDisabled=!1,t.$message({showClose:!0,type:"error",message:e.message})})}},updateTree:function(e,t){for(var o=void 0,r=0;r<e.length;r++)(o=e[r]).id==t.pid?e[r].children&&(e[r].children.length?e[r].children.forEach(function(e){e.id==t.id&&(e.label=t.name,e=n()(e,t))}):e[r].children.push(t)):o.children&&this.updateTree(o.children,t)}}},l={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"groupManage-wrapper"},[o("el-row",{staticClass:"group-manage-box"},[o("el-col",{staticClass:"group-left-col",attrs:{span:6}},[o("el-scrollbar",{attrs:{"wrap-class":"list-scrollbar group-scrollbar",native:!1}},[e.treeVisible?o("el-tree",{ref:"tree",staticClass:"group-tree-box",attrs:{data:e.treeData,"node-key":"id","default-expanded-keys":e.defaultExpand,lazy:"",load:e.loadNode,"highlight-current":"","expand-on-click-node":!1,props:e.defaultProps,"render-content":e.renderContent},on:{"node-expand":e.nodeExpand,"node-click":e.nodeClick}}):e._e()],1)],1),e._v(" "),o("el-col",{staticClass:"group-right-col",attrs:{span:16,offset:2}},[o("h3",{staticClass:"edit-group-info"},[e._v(e._s(e.updTitle?e.$t("button.groupEdit"):e.$t("button.groupAdd"))+e._s(e.$t("table.addgroup")))]),e._v(" "),o("el-form",{ref:"groupForm",staticClass:"group-form",attrs:{model:e.groupForm,"status-icon":""}},[o("el-form-item",{attrs:{label:e.$t("table.groupName"),prop:"name"}},[o("el-input",{staticClass:"group-name-inp",attrs:{placeholder:e.$t("pholder.groupName")},model:{value:e.groupForm.name,callback:function(t){e.$set(e.groupForm,"name",t)},expression:"groupForm.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("table.enName"),prop:"nameEn"}},[o("el-input",{staticClass:"group-name-inp",attrs:{placeholder:e.$t("pholder.enName")},model:{value:e.groupForm.nameEn,callback:function(t){e.$set(e.groupForm,"nameEn",t)},expression:"groupForm.nameEn"}})],1),e._v(" "),e.isRoot?e._e():o("el-form-item",{attrs:{label:e.$t("table.parentGroup"),prop:"pid"}},[o("treeselect",{staticClass:"group-parent-sel",attrs:{value:e.groupForm.pid,options:e.treeData},on:{select:e.parentChange}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("table.basicInforM"),prop:"intro"}},[o("el-input",{staticClass:"group-info-text",attrs:{type:"textarea"},model:{value:e.groupForm.intro,callback:function(t){e.$set(e.groupForm,"intro",t)},expression:"groupForm.intro"}})],1),e._v(" "),o("el-form-item",[o("el-button",{staticClass:"group-form-btn group-del-btn",attrs:{type:"primary",disabled:e.btnDisabled},on:{click:function(t){e.submitForm("groupForm")}}},[e._v(e._s(e.$t("button.confirm")))])],1)],1)],1)],1)],1)},staticRenderFns:[]},d=o("VU/8")(c,l,!1,function(e){o("a62z")},null,null);t.default=d.exports}});