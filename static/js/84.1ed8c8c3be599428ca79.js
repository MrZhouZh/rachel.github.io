webpackJsonp([84],{SkSw:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i,s=e("bOdI"),r=e.n(s),n=e("mvHQ"),o=e.n(n),d=e("pJt5"),h=e("jR44"),l=e("DQZ8"),c=(i={props:{propparam:Object}},r()(i,"props",{orgId:[String,Number],propparam:Object}),r()(i,"data",function(){return{historyTab_title:"enteringRateTable",historyChart_title:"enteringRateChart",loading:!0,historyChart_ops:{},historyTab_head:[],historyTab_data:[],chartIds:"",chartKeyToId:{},emitData:{},startTime:"",endTime:""}}),r()(i,"components",{"store-rate-chart":h.a,"common-tab":l.a,"export-data-dialog":d.a}),r()(i,"watch",{propparam:{handler:"refreshHandle",immediate:!0}}),r()(i,"mounted",function(){}),r()(i,"methods",{i18n:function(t){var a="echartsTitle."+t;return this.$t(a)},refreshHandle:function(t){"/StoreRate/storeratio"===t.dateType&&(this.emitData=t.data,this.chartIds&&"{}"!==o()(this.chartKeyToId)?this.getChartData(this.chartIds):this.getChartId())},getChartId:function(){var t=this;this.chartKeyToId={},this.chartIds="",this.axios.get("/reportCharts",{params:{report:"enteringRate",_t:Date.parse(new Date)/1e3}}).then(function(a){var e=a.data.data;e.forEach(function(a,i){t.chartKeyToId[a.key]=a.id,"enteringRateChart"!==a.key&&"enteringRateTable"!==a.key||(i==e.length-1?t.chartIds+=a.id:t.chartIds+=a.id+",")}),t.getChartData(t.chartIds)})},getChartData:function(t){var a=this;if(t){this.historyChart_ops={},this.historyTab_data=[],this.historyTab_head=[];var e="",i={},s=[];if(this.emitData.asis_time)if(this.emitData.asis_time.getMonth()===(new Date).getMonth()&&this.emitData.asis_time.getFullYear()===(new Date).getFullYear())this.endTime=dateUnit.dateFormat(this.emitData.asis_time,"yyyy-MM-dd"),this.startTime=dateUnit.dateFormat(new Date(Date.parse(this.emitData.asis_time.getFullYear()+"/"+(this.emitData.asis_time.getMonth()+1)+"/01")),"yyyy-MM-dd"),this.startTime==this.endTime&&(this.endTime=dateUnit.dateFormat(new Date,"yyyy-MM-dd"));else{this.startTime=this.emitData.asis_time,this.endTime=new Date(Date.parse(this.dayAdd(this.emitData.asis_time,31).replace(/\-/,"/")));var r=this.unitTime(this.startTime,this.endTime,"month");this.startTime=r.startTime,this.endTime=r.endTime}e="/report/enteringRate/"+this.emitData.asis_level,i={orgIds:this.emitData.asis_org,chartIds:t,startDate:this.startTime,endDate:this.endTime,_t:Date.parse(new Date)/1e3},this.axios.get(e,{params:i}).then(function(t){var e=t.data.data.body.enteringRateChart;e.seriesText="rate",a.historyChart_ops=e,t.data.data.body.enteringRateTable.xaxis&&(s=t.data.data.body.enteringRateTable.xaxis.data),a.historyTab_head=a.autoComplateHead(s);var i=t.data.data.body.enteringRateTable.series;i.length&&(a.historyTab_data=a.dealData(i,a.historyTab_head)),setTimeout(function(){a.loading=!1},500)}).catch(function(t){})}},autoComplateHead:function(t){var a=[];return t.forEach(function(t,e){a.push({prop:"defaultOrg"+e,label:t})}),a},dealData:function(t,a){var e={},i=[],s="";return t.forEach(function(t){for(var r=0,n=t.data.length;r<n;r++)s=a[r].prop,e[s]=t.data[r]||0==t.data[r]?t.data[r]:"--";i.push(e),e={}}),i},exportDataHandle:function(t,a,e){var i=this.chartKeyToId[e],s={domId:t,title:a,data:{url:"/report/enteringRate/"+this.emitData.asis_level+"/"+i+"/excel",params:"orgIds="+this.emitData.asis_org+"&startDate="+this.startTime+"&endDate="+this.endTime}};this.$refs.exportDialog.dialogInit(s)}}),i),m={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"store-rate-wrapper"},[e("div",{staticClass:"download-parent ratio-chart-wrapper"},[e("store-rate-chart",{staticClass:"store-rate-chart",attrs:{id:"storeRatio",options:t.historyChart_ops,chartType:"Line"}}),t._v(" "),e("span",{staticClass:"ehcarts-title"},[t._v(t._s(t.i18n(t.historyChart_title)))]),t._v(" "),e("span",{staticClass:"download-text",on:{click:function(a){t.exportDataHandle("storeRatio",t.i18n(t.historyChart_title),"enteringRateChart")}}},[t._v(t._s(t.$t("allPages.load")))])],1),t._v(" "),e("div",{staticClass:"asis-table-wrapper"},[e("h3",{staticClass:"asis-table-header"},[e("span",{staticClass:"asis-table-title"},[t._v(t._s(t.i18n(t.historyTab_title)))]),t._v(" "),e("span",{staticClass:"asis-table-download",on:{click:function(a){t.dealExport("domHistoryTab",t.i18n(t.historyTab_title))}}},[t._v(t._s(t.$t("allPages.load")))])]),t._v(" "),e("div",{staticClass:"asis-table-content"},[e("common-tab",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{tableData:t.historyTab_data,id:"domHistoryTab",headData:t.historyTab_head,tabHeight:""}})],1)]),t._v(" "),e("export-data-dialog",{ref:"exportDialog"})],1)},staticRenderFns:[]},p=e("VU/8")(c,m,!1,function(t){e("kQT7")},"data-v-571e1266",null);a.default=p.exports},kQT7:function(t,a){}});