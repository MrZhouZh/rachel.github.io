webpackJsonp([9],{"+Gr5":function(t,e){},"0CEu":function(t,e,a){"use strict";var i=a("BO1k"),o=a.n(i),s=a("fZjL"),n=a.n(s),l=a("RRo+"),r=a.n(l),c=a("RZfC"),d=a("RO6q"),m=a.n(d),h={components:{"crop-dialog":c.a},data:function(){return{isShow:!1,loading:!0,editForm:{name:"",gender:"",age:"",position:"",mallId:""},employeeId:"",staffProfile:"",mallList:[],PreProfileUrl:"",uploadAction:"/staffs/uploadImg/",uploadHeaders:{},profileFormData:{},imageUrl:"",maxSize:2,rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],age:[{validator:function(t,e,a){if(!e)return a(new Error("年龄不能为空"));setTimeout(function(){r()(Number(e))?a():a(new Error("请输入正确格式"))},1e3)},trigger:"blur"}],mallId:[{required:!0,message:"请选择所属广场",trigger:"change"}]}}},created:function(){this.getMallList(),this.uploadHeader={Authorization:this.$cookie.get("atoken")}},methods:{dialogInit:function(t){this.isShow=!0,this.loading=!1,this.employeeId=t.id,this.staffProfile=t.photo;for(var e in this.editForm)this.editForm[e]=t[e]},editSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;var a=null;if(a=new FormData,"FormData"===e.toRawType(e.profileFormData)){var i=!0,s=!1,l=void 0;try{for(var r,c=o()(e.profileFormData.keys());!(i=(r=c.next()).done);i=!0){var d=r.value,m=e.profileFormData.get(d);a.append(d,m)}}catch(t){s=!0,l=t}finally{try{!i&&c.return&&c.return()}finally{if(s)throw l}}n()(e.editForm).forEach(function(t){void 0!==e.editForm[t]&&e.editForm[t]&&a.append(t,e.editForm[t])})}else n()(e.editForm).forEach(function(t){a.append(t,e.editForm[t])});e.axios.post("/staffs/"+e.employeeId,a,{headers:{"Content-type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(t){var a=t.data;200==a.code?(e.$refs.profileupload.clearFiles(),e.staffProfile="",e.isShow=!1,e.$parent.getTableData()):e.$message({showClose:!0,type:"error",message:e.$t("message.editClerkFailed")+a.msg})}).catch(function(t){e.$message({showClose:!0,type:"error",message:e.$t("message.editClerkFailed")+t.message})})})},getMallList:function(){var t=this;this.mallList=[],this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data.data;a.length>0&&(t.mallList=a)}).catch(function(t){})},profileFormatter:function(t){if(t){if(-1!=t.indexOf("blob:"))return t;return window.apiUrl+"/staffs/img/"+t}return m.a},beforeAvatarUpload:function(t){var e=this.maxSize;return-1!==t.type.indexOf("image")&&(!(t.size/1024/1024>e)||(this.$message.error(this.$t("message.imgLimSize")+" 2MB!"),!1))},handleChange:function(t,e){this.$refs.cropRef.cropDialogInit(e[e.length-1].raw)},getPath:function(t,e){this.profileFormData=t,this.staffProfile=e},closeDialog:function(){this.profileFormData={},this.$refs.profileupload.clearFiles(),this.staffProfile="",this.$refs.editForm.resetFields(),this.isShow=!1}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"loading",rawName:"v-loading.body",value:t.loading,expression:"loading",modifiers:{body:!0}}],staticClass:"manage-dialog",attrs:{title:t.$t("dialog.editClerk"),visible:t.isShow,"before-close":t.closeDialog},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"editForm",attrs:{model:t.editForm,rules:t.rules}},[a("el-form-item",{attrs:{label:t.$t("table.name"),prop:"name"}},[a("el-input",{model:{value:t.editForm.name,callback:function(e){t.$set(t.editForm,"name",e)},expression:"editForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.gender"),prop:"gender"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:t.$t("pholder.select"),"no-data-text":t.$t("pholder.nodata")},model:{value:t.editForm.gender,callback:function(e){t.$set(t.editForm,"gender",e)},expression:"editForm.gender"}},[a("el-option",{attrs:{label:t.$t("head.man"),value:1}}),t._v(" "),a("el-option",{attrs:{label:t.$t("head.woman"),value:0}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("dialog.age"),prop:"age"}},[a("el-input",{model:{value:t.editForm.age,callback:function(e){t.$set(t.editForm,"age",e)},expression:"editForm.age"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.position"),prop:"position"}},[a("el-input",{model:{value:t.editForm.position,callback:function(e){t.$set(t.editForm,"position",e)},expression:"editForm.position"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.square"),prop:"mallId"}},[a("el-select",{staticClass:"manage-sel",attrs:{filterable:"",placeholder:t.$t("pholder.select"),"no-data-text":t.$t("pholder.nodata")},model:{value:t.editForm.mallId,callback:function(e){t.$set(t.editForm,"mallId",e)},expression:"editForm.mallId"}},t._l(t.mallList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("dialog.profilePic"),prop:"photo"}},[a("el-upload",{ref:"profileupload",staticClass:"avatar-uploader",attrs:{"show-file-list":!1,"auto-upload":!1,action:t.uploadAction,headers:t.uploadHeaders,"on-change":t.handleChange,"before-upload":t.beforeAvatarUpload}},[t.staffProfile?a("img",{staticClass:"avatar",attrs:{src:t.profileFormatter(t.staffProfile)}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(e){t.isShow=!1}}},[t._v(t._s(t.$t("dialog.cancel")))]),t._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(e){t.editSubmit("editForm")}}},[t._v(t._s(t.$t("dialog.confirm")))])],1)],1),t._v(" "),a("crop-dialog",{ref:"cropRef",on:{profilePath:t.getPath}})],1)},staticRenderFns:[]},u=a("VU/8")(h,g,!1,null,null,null);e.a=u.exports},"0HEy":function(t,e,a){"use strict";var i=a("3MSA"),o=a.n(i),s={data:function(){return{isShow:!1,loading:!0,mallVal:"",mallOpt:[],monitoryVal:"",monitoryOpt:[],cameraVal:"",cameraOpt:[],timeVal:[],pickerOptions1:{disabledDate:function(t){return t.getTime()>Date.now()}},total:0,pageSize:50,currentPage:1,imgList:[],defaultImg:o.a,staffId:"",personeunid:"",checkedNum:0,hasAddImg:[],noImgText:"",curMallId:null}},created:function(){},mounted:function(){},methods:{dialogInit:function(t,e,a){this.curMallId=a,this.mallVal=a,this.staffId=t,this.personeunid=e,this.timeVal=[dateUnit.dateFormat(new Date,"yyyy-MM-dd")+" 00:00:00",dateUnit.dateFormat(new Date,"yyyy-MM-dd")+" 23:59:59"],this.noImgText="图片加载中...",this.total=0,this.pageSize=50,this.currentPage=1,this.imgList=[],this.getMallList(!0),this.isShow=!0},getHadImg:function(t){var e=this;this.hasAddImg=[],this.axios.get("/staffFaces",{params:{staffId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){t.data.data.forEach(function(t){e.hasAddImg.push(t.recognitionId)}),e.getData()})},getData:function(){var t=this;this.imgList=[],this.checkedNum=0,this.noImgText="图片加载中...",this.axios.get("/faceRecognitions",{params:{mallId:this.mallVal,gateId:this.monitoryVal?this.monitoryVal:null,channelId:this.cameraVal?this.cameraVal:null,counttime_gte:this.timeVal[0],counttime_lte:this.timeVal[1],personType:0,direction:1,facePic_null:!1,age_gt:0,sortName:"counttime",sortOrder:"DESC",page:this.currentPage,pageSize:this.pageSize,_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.list.forEach(function(t){t.isChecked=!1;var e=t.counttime.split(" ")[0],a=e.split("-")[0]+e.split("-")[1]+e.split("-")[2];t.paramFacePic=a+"/"+t.channelSerialnum+"/"+t.facePic,t.facePic=t.channelSerialnum+"|"+(t.facePic?t.facePic:"0")}),t.hasAddImg.forEach(function(t){a.data.list.forEach(function(e){e.id==t&&(e.isChecked=!0)})}),t.checkedNum=t.hasAddImg.length,t.imgList=a.data.list,0==t.imgList.length&&(t.noImgText=t.$t("echartsTitle.noData")),t.total=a.data.total,setTimeout(function(){t.loading=!1},1e3)}).catch(function(t){})},searchFun:function(){this.getData()},sizeChange:function(t){this.pageSize=t,this.getData()},currentChange:function(t){this.currentPage!=t&&(this.currentPage=t,this.getData())},getMallList:function(t){var e=this;this.mallOpt=[],this.mallVal="",this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(a){var i=a.data;i.data.forEach(function(t){t.id==e.curMallId&&(e.mallVal=t.id)}),i.data.length>0&&(e.mallOpt=i.data,e.curMallId||(e.mallVal=i.data[0].id),e.getGates(e.mallVal)),t&&e.getHadImg(e.staffId)}).catch(function(t){})},chooseMall:function(t){this.getGates(t)},getGates:function(t){var e=this;this.monitoryOpt=[],this.monitoryVal="",this.axios.get("/gates",{params:{mallId:t,isHasFace:1,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data.data;a.length?(a.unshift({id:"",name:"全部监控点"}),e.monitoryOpt=a,e.monitoryVal=a[0].id,e.getChannels(e.monitoryVal)):(e.cameraOpt=[],e.cameraVal="")}).catch(function(t){})},chooseMonitory:function(){this.getChannels(this.monitoryVal)},getChannels:function(t){var e=this;t&&(this.cameraOpt=[],this.cameraVal="",this.axios.get("/channels",{params:{gateId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data.data;a.unshift({id:"",name:"全部通道"}),e.cameraOpt=a,e.cameraOpt.length>0&&(e.cameraVal=e.cameraOpt[0].id)}).catch(function(t){}))},dealImg:function(t){var e=t.facePic.split("|")[0],a=t.facePic.split("|")[1],i=t.counttime.split(" ")[0],o=i.split("-")[0]+i.split("-")[1]+i.split("-")[2];return"0"===a?this.defaultImg:window.picUrl+"/face/"+o+"/"+e+"/"+a},dealErrImg:function(t){(t||window.event).target.src=this.defaultImg},checkedImgs:function(t){var e=this;if(this.hasAddImg.some(function(a){return a==e.imgList[t].id}))this.$message({showClose:!0,type:"warning",message:this.$t("message.clerkHasAdded")});else if(this.imgList[t].isChecked)this.imgList[t].isChecked=!1,this.checkedNum-=1;else{if(this.checkedNum+=1,this.checkedNum>10)return void this.$message({showClose:!0,type:"warning",message:this.$t("message.addLimit")});this.imgList[t].isChecked=!0}},submitImg:function(){var t=this,e=[],a=[];this.imgList.forEach(function(a){a.isChecked&&e.push({staffId:t.staffId,recognitionId:a.id,facePic:a.paramFacePic,originalPersonUuid:a.personUnid,faceFeature:a.facePath&&a.faceFeature?a.facePath+a.faceFeature:null,staff:{personUnid:t.personeunid}})}),a=e.filter(function(e){return-1===t.hasAddImg.indexOf(e.recognitionId)}),this.axios.post("/staffFaces/addList",a).then(function(e){200==e.data.code&&(t.isShow=!1,t.$parent.getTableData())})},closeDialog:function(){this.total=0,this.pageSize=50,this.currentPage=1,this.imgList=[],this.isShow=!1}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"loading",rawName:"v-loading.body",value:t.loading,expression:"loading",modifiers:{body:!0}}],staticClass:"manage-dialog clerk-image-dialog",attrs:{title:t.$t("dialog.addClerk"),visible:t.isShow,"close-on-click-modal":!1,"before-close":t.closeDialog},on:{"update:visible":function(e){t.isShow=e}}},[a("el-row",{staticClass:"img-dialog-header"},[a("el-col",{attrs:{span:11}},[a("div",{staticClass:"manage-select-box"},[a("el-select",{staticClass:"mall-opt",attrs:{filterable:"",placeholder:t.$t("pholder.shopSelect")},on:{change:function(e){t.chooseMall(t.mallVal)}},model:{value:t.mallVal,callback:function(e){t.mallVal=e},expression:"mallVal"}},t._l(t.mallOpt,function(t,e){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("div",{staticClass:"manage-select-box"},[a("el-select",{staticClass:"monitory-opt",attrs:{filterable:"",placeholder:t.$t("pholder.site")},on:{change:t.chooseMonitory},model:{value:t.monitoryVal,callback:function(e){t.monitoryVal=e},expression:"monitoryVal"}},t._l(t.monitoryOpt,function(t,e){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),""!==t.monitoryVal?a("div",{staticClass:"manage-select-box"},[a("el-select",{staticClass:"camera-opt",attrs:{filterable:"",placeholder:"请选择通道"},model:{value:t.cameraVal,callback:function(e){t.cameraVal=e},expression:"cameraVal"}},t._l(t.cameraOpt,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1):t._e()]),t._v(" "),a("el-col",{attrs:{span:10,offset:1}},[a("div",{staticClass:"manage-input-box time-input-box"},[a("el-date-picker",{staticClass:"time-opt",attrs:{type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":t.pickerOptions1,"range-separator":"至","start-placeholder":t.$t("table.startTime"),"end-placeholder":t.$t("table.endTime")},on:{change:t.searchFun},model:{value:t.timeVal,callback:function(e){t.timeVal=e},expression:"timeVal"}})],1)]),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"search-btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.searchFun}},[t._v(t._s(t.$t("button.search")))])],1)],1),t._v(" "),a("el-scrollbar",{staticClass:"img-list-scrollbar",staticStyle:{height:"450px","max-height":"450px"},attrs:{"wrap-class":"list-scrollbar",native:!1}},[t.imgList.length>0?a("ul",{staticClass:"img-row"},t._l(t.imgList,function(e,i){return a("li",{key:e.id,staticClass:"img-col"},[a("p",[t._v(t._s(e.counttime))]),t._v(" "),a("div",{staticClass:"clerk-img-box",on:{click:function(e){t.checkedImgs(i)}}},[a("img",{staticClass:"clerk-img",attrs:{src:t.dealImg(e),alt:t.dealImg(e)},on:{error:t.dealErrImg}})]),t._v(" "),a("span",{class:e.isChecked?"custom-checkbox__input checked":"custom-checkbox__input",on:{click:function(e){t.checkedImgs(i)}}},[a("span",{staticClass:"custom-checkbox__inner"})])])})):a("div",{staticStyle:{"text-align":"center","padding-top":"20px"}},[t._v(t._s(t.noImgText))])]),t._v(" "),a("div",{staticClass:"page-wrapper"},[a("el-pagination",{staticClass:"manage-pagination-box",attrs:{background:"","current-page":t.currentPage,"page-sizes":[50,100],"page-size":t.pageSize,layout:"sizes, prev, pager, next, slot",total:t.total},on:{"size-change":t.sizeChange,"current-change":t.currentChange}},[a("span",{staticClass:"slot-pagination-ele slot-ele-total"},[t._v(t._s(t.$t("table.pageHead"))+" "+t._s(t.total)+" "+t._s(t.$t("table.pageTail")))])])],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:t.submitImg}},[t._v(t._s(t.$t("dialog.confirm")))])],1)],1)],1)},staticRenderFns:[]},l=a("VU/8")(s,n,!1,function(t){a("Pjad")},"data-v-63b9bc16",null);e.a=l.exports},"5mwZ":function(t,e){},BO1k:function(t,e,a){t.exports={default:a("fxRn"),__esModule:!0}},Pjad:function(t,e){},RO6q:function(t,e,a){t.exports=a.p+"static/img/002.00d79c7.svg"},RZfC:function(t,e,a){"use strict";var i={jpg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",psd:"image/photoshop"},o={props:{profiles:{default:null},field:{type:String,default:"avatar"},value:{default:!0},width:{type:Number,default:240},height:{type:Number,default:240},noRotate:{type:Boolean,default:!0},imgFormat:{type:String,default:"png"},imgBgc:{type:String,default:"#fff"}},data:function(){var t=this.imgFormat,e=(this.langType,this.width),a=this.height,o=!0,s=-1===["jpg","png"].indexOf(t)?"jpg":t,n=i[s];return this.imgFormat=s,"function"!=typeof FormData&&(o=!1),{isLimW:!1,mime:n,isSupported:o,isSupportTouch:document.hasOwnProperty("ontouchstart"),ratio:e/a,originImg:"",originProps:{width:0,height:0},sourceImg:null,sourceImgUrl:"",createImgUrl:"",sourceImgMouseDown:{on:!1,mX:0,mY:0,x:0,y:0},previewContainer:{width:100,height:100},sourceImgContainer:{width:288,height:244},scale:{zoomAddOn:!1,zoomSubOn:!1,range:1,x:0,y:0,width:0,height:0,maxWidth:0,maxHeight:0,minWidth:0,minHeight:0,naturalWidth:0,naturalHeight:0},newScale:0}},computed:{progressStyle:function(){return{width:this.progress+"%"}},sourceImgStyle:function(){var t=this.scale,e=this.sourceImgMasking,a=this.width,i=(this.height,t.y+e.y+"px"),o=t.x+e.x+"px";return this.isLimW=!1,(t.naturalWidth<=a||t.naturalWidth-a<=4)&&(this.isLimW=!0),{top:i,left:o,width:t.width+"px",height:t.height+"px"}},sourceImgMasking:function(){var t=this.width,e=this.height,a=this.ratio,i=this.sourceImgContainer,o=i.width/i.height,s=0,n=0,l=i.width,r=i.height,c=1;return a<o&&(c=i.height/e,l=i.height*a,s=(i.width-l)/2),a>o&&(c=i.width/t,r=i.width/a,n=(i.height-r)/2),{scale:c,x:s,y:n,width:l,height:r}},sourceImgShadeStyle:function(){var t=this.sourceImgMasking,e=this.sourceImgContainer,a=t;return{width:(a.width==e.width?a.width:(e.width-a.width)/2)+"px",height:(a.height==e.height?a.height:(e.height-a.height)/2)+"px"}},previewStyle:function(){this.width,this.height;var t=this.ratio,e=this.previewContainer,a=e.width,i=e.height,o=a/i;return t<o&&(a=e.height*t),t>o&&(i=e.width/t),{width:a+"px",height:i+"px"}}},watch:{profiles:{handler:"setSourceImg",immediate:!0}},created:function(){},mounted:function(){},methods:{preventDefault:function(t){return t.preventDefault(),!1},limTip:function(){},setSourceImg:function(t){var e=this;if(e.$emit("cropedImg",e.isSupported),e.isSupported)if(e.sourceImgUrl="","string"==typeof t){var a=new Image;a.crossOrigin="Anonymous",a.src=t,a.onload=function(){var t=e.converBase64(a);e.$emit("src-file-set",t.name,t.type,t.size);var i=new FileReader;i.onload=function(t){e.sourceImgUrl=i.result,e.startCrop()},i.readAsDataURL(t)}}else{e.$emit("src-file-set",t.name,t.type,t.size);var i=new FileReader;i.onload=function(t){e.sourceImgUrl=i.result,e.startCrop()},i.readAsDataURL(t)}},convertBase64UrlToBlob:function(t,e){for(var a=t.split(","),i=a[0].match(/:(.*?);/)[1],o=atob(a[1]),s=o.length,n=new Uint8Array(s);s--;)n[s]=o.charCodeAt(s);return new File([n],e,{type:i})},converBase64:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;e.getContext("2d").drawImage(t,0,0,t.width,t.height);var a=t.src.substring(t.src.lastIndexOf(".")+1).toLowerCase(),i=t.src.substring(t.src.lastIndexOf("/")+1,t.src.length),o=e.toDataURL("image/"+a);return this.convertBase64UrlToBlob(o,i)},startCrop:function(){var t=this,e=t.width,a=t.height,i=t.ratio,o=t.scale,s=t.sourceImgUrl,n=t.originProps,l=t.sourceImgMasking,r=new Image,c=!1;r.src=s,r.onload=function(){var s=r.naturalWidth,d=r.naturalHeight,m=s/d,h=l.width,g=l.height,u=0,f=0;(s<e||d<a)&&(t.$message.info(t.$t("message.dpiNotNormal")+e+"*"+a),c=!0),c||(i>m&&(g=h/m,f=(l.height-g)/2),i<m&&(h=g*m,u=(l.width-h)/2),n.width=r.width,n.height=r.height,o.range=0,o.x=u,o.y=f,o.width=h,o.height=g,o.minWidth=h,o.minHeight=g,o.maxWidth=s*l.scale,o.maxHeight=d*l.scale,o.naturalWidth=s,o.naturalHeight=d,t.sourceImg=r,t.originImg=r,t.createImg())},r.onerror=function(){t.$message.info(t.$t("message.imgloaderror"))}},imgStartMove:function(t){if(t.preventDefault(),this.isSupportTouch&&!t.targetTouches)return!1;var e=t.targetTouches?t.targetTouches[0]:t,a=this.sourceImgMouseDown,i=this.scale,o=a;o.mX=e.screenX,o.mY=e.screenY,o.x=i.x,o.y=i.y,o.on=!0},imgMove:function(t){if(t.preventDefault(),this.isSupportTouch&&!t.targetTouches)return!1;var e=t.targetTouches?t.targetTouches[0]:t,a=this.sourceImgMouseDown,i=a.on,o=a.mX,s=a.mY,n=a.x,l=a.y,r=this.scale,c=this.sourceImgMasking,d=n+(e.screenX-o),m=l+(e.screenY-s);i&&(d>0&&(d=0),m>0&&(m=0),d<c.width-r.width&&(d=c.width-r.width),m<c.height-r.height&&(m=c.height-r.height),r.x=d,r.y=m)},rotateImg:function(t){var e=this.sourceImg,a=this.scale,o=a.naturalWidth,s=a.naturalHeight,n=s,l=o,r=this.$refs.canvas,c=r.getContext("2d");r.width=n,r.height=l,c.clearRect(0,0,n,l),c.fillStyle="rgba(0,0,0,0)",c.fillRect(0,0,n,l),c.translate(n,0),c.rotate(90*Math.PI/180),c.drawImage(e,0,0,o,s);var d=r.toDataURL(i.png);this.sourceImgUrl=d,this.startCrop()},startZoomAdd:function(t){function e(){if(i.zoomAddOn){var t=i.range>=100?100:++i.range;a.zoomImg(t),setTimeout(function(){e()},60)}}if(!this.isLimW){var a=this,i=a.scale;i.zoomAddOn=!0,e()}},endZoomAdd:function(t){this.scale.zoomAddOn=!1},startZoomSub:function(t){function e(){if(i.zoomSubOn){var t=i.range<=0?0:--i.range;a.zoomImg(t),setTimeout(function(){e()},60)}}if(!this.isLimW){var a=this,i=a.scale;i.zoomSubOn=!0,e()}},endZoomSub:function(t){this.scale.zoomSubOn=!1},zoomChange:function(t){this.zoomImg(t.target.value)},scaleImg:function(t){this.isLimW||(t.wheelDelta?(t.wheelDelta>0&&(this.scale.range+=1,this.startZoomAdd(),this.endZoomAdd()),t.wheelDelta<0&&(this.scale.range-=1,this.startZoomSub(),this.endZoomSub())):t.detail&&(t.detail>0&&(this.scale.range+=1,this.startZoomAdd(),this.endZoomAdd()),t.detail<0&&(this.scale.range-=1,this.startZoomSub(),this.endZoomSub())))},zoomImg:function(t){var e=this,a=this.sourceImgMasking,i=(this.sourceImgMouseDown,this.scale),o=i.maxWidth,s=i.maxHeight,n=i.minWidth,l=i.minHeight,r=i.width,c=i.height,d=i.x,m=i.y,h=(i.range,a),g=h.width,u=h.height,f=n+(o-n)*t/100,p=l+(s-l)*t/100,v=g/2-f/r*(g/2-d),b=u/2-p/c*(u/2-m);v>0&&(v=0),b>0&&(b=0),v<g-f&&(v=g-f),b<u-p&&(b=u-p),i.x=v,i.y=b,i.width=f,i.height=p,i.range=t,e.newScale=f/e.originProps.width,setTimeout(function(){i.range==t&&e.createImg()},300)},createImg:function(t){var e=this.isSupported,a=this.imgFormat,i=this.imgBgc,o=this.mime,s=this.originImg,n=(this.originProps,this.newScale),l=(this.sourceImg,this.scale),r=l.x,c=l.y,d=(l.width,l.height,this.sourceImgMasking.scale,this.$refs.canvas),m=d.getContext("2d");t&&(this.sourceImgMouseDown.on=!1),d.width=240/n,d.height=240/n,m.clearRect(0,0,240/n,240/n),m.fillStyle="png"==a?"rgba(0,0,0,0)":i,m.fillRect(0,0,240/n,240/n);var h="number"==typeof n&&n>0?Math.abs(r/n):0,g="number"==typeof n&&n>0?Math.abs(c/n):0;m.drawImage(s,h,g,240/n,240/n,0,0,240/n,240/n),this.createImgUrl=d.toDataURL(o);var u="",f=new FormData;u=function(t,e){t=t.split(",")[1],t=window.atob(t);for(var a=new Uint8Array(t.length),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Blob([a],{type:e})}(this.createImgUrl,o),f.append(this.field,u,this.field+"."+a),this.$emit("cropedImg",e,f,URL.createObjectURL(u))}}},s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"crop-wrapper"},[e("div",{staticClass:"crop-img-container"},[e("img",{ref:"img",staticClass:"crop-img",style:this.sourceImgStyle,attrs:{src:this.sourceImgUrl,alt:"",draggable:"false"},on:{mousewheel:this.scaleImg,drag:this.preventDefault,dragstart:this.preventDefault,dragend:this.preventDefault,dragleave:this.preventDefault,dragover:this.preventDefault,dragenter:this.preventDefault,drop:this.preventDefault,mousedown:this.imgStartMove,mousemove:this.imgMove,mouseup:this.createImg,mouseout:this.createImg,touchstart:this.imgStartMove,touchmove:this.imgMove,touchend:this.createImg,touchcancel:this.createImg}}),this._v(" "),e("div",{staticClass:"crop-img-shade crop-img-shade-1",style:this.sourceImgShadeStyle}),this._v(" "),e("div",{staticClass:"crop-img-shade crop-img-shade-2",style:this.sourceImgShadeStyle})]),this._v(" "),e("div",{staticClass:"crop-range"},[e("input",{attrs:{type:"range",step:"1",min:"0",max:"100",disabled:this.isLimW},domProps:{value:this.scale.range},on:{mousemove:this.zoomChange}}),this._v(" "),e("i",{staticClass:"crop-icon crop-icon-minus",on:{mousedown:this.startZoomSub,mouseout:this.endZoomSub,mouseup:this.endZoomSub}}),this._v(" "),e("i",{staticClass:"crop-icon crop-icon-plus",on:{mousedown:this.startZoomAdd,mouseout:this.endZoomAdd,mouseup:this.endZoomAdd}})]),this._v(" "),e("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"canvas",attrs:{width:this.width,height:this.height}})])},staticRenderFns:[]},n={components:{"profile-component":a("VU/8")(o,s,!1,function(t){a("+Gr5")},"data-v-4b096016",null).exports},props:{},data:function(){return{isShow:!1,profiles:{},employeeId:null,profileFormData:null,blobProfile:""}},computed:{},created:function(){},mounted:function(){},methods:{cropDialogInit:function(t,e){this.profiles=t,this.employeeId=e||null,this.isShow=!0},getCropedPic:function(t,e,a){var i=this;t?(this.profileFormData=e,this.blobProfile=a):this.$alert("浏览器不支持裁剪功能,请使用IE10以上或其他主流浏览器","提示",{confirmButtonText:"确定",callback:function(t){console.log("action: "+t),i.isShow=!1}})},cropSubmit:function(){this.$emit("profilePath",this.profileFormData,this.blobProfile),this.isShow=!1},closeDialog:function(){this.blobProfile="",this.profileFormData=this.employeeId=null}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"manage-dialog",attrs:{title:"证件照编辑",visible:t.isShow,"close-on-click-modal":!1},on:{"update:visible":function(e){t.isShow=e},close:t.closeDialog}},[a("profile-component",{attrs:{field:"file",profiles:t.profiles},on:{cropedImg:t.getCropedPic}}),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:function(e){t.isShow=!1}}},[t._v(t._s(t.$t("dialog.cancel")))]),t._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:t.cropSubmit}},[t._v(t._s(t.$t("dialog.confirm")))])],1)],1)},staticRenderFns:[]},r=a("VU/8")(n,l,!1,function(t){a("5mwZ")},"data-v-51af40c2",null);e.a=r.exports},"f+TB":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("xyEl"),o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"manage-container clerk-wrapper"},[a("el-row",{staticClass:"manage-head-wrapper"},[a("el-col",{attrs:{span:22}},[a("div",{staticClass:"manage-select-box"},[a("el-select",{staticClass:"mall-opt",attrs:{filterable:"",placeholder:t.$t("pholder.shopSelect")},on:{change:function(e){t.chooseMall(t.mallVal)}},model:{value:t.mallVal,callback:function(e){t.mallVal=e},expression:"mallVal"}},t._l(t.mallOpt,function(t,e){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("div",{staticClass:"manage-select-box"},[a("el-input",{staticClass:"search-inp",attrs:{placeholder:t.$t("pholder.clerkName"),clearable:""},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.searchFun(e)}},model:{value:t.clerkName,callback:function(e){t.clerkName=e},expression:"clerkName"}})],1),t._v(" "),a("el-button",{staticClass:"search-btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.searchFun}},[t._v(t._s(t.$t("button.search")))])],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"btn-box"},[a("el-button",{staticClass:"manage-add-btn fl-btn",attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.addClerk}},[t._v(t._s(t.$t("dialog.addClerk")))])],1)])],1),t._v(" "),a("el-row",{staticClass:"manage-content"},[a("el-col",{attrs:{span:24}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"row_table",staticClass:"clerk-manage-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"max-height":t.tableHeight,"header-row-class-name":"manage-tab-head"},on:{"expand-change":t.expandHandle}},[a("el-table-column",{attrs:{type:"expand",prop:"children"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.children.length>0?a("ul",{staticClass:"img-column"},t._l(e.row.children,function(i,o){return a("li",{key:i.id,staticClass:"img-column-item"},[a("div",{staticClass:"img-box"},[a("el-popover",{attrs:{placement:"left",title:"",trigger:"hover"}},[a("img",{staticClass:"face-img",attrs:{slot:"reference",src:t.dealImg(e.row.children,o),width:"50",height:"50",alt:""},on:{error:t.dealErrImg},slot:"reference"}),t._v(" "),a("img",{staticClass:"zoomout-img",attrs:{src:t.dealImg(e.row.children,o),alt:t.dealImg(e.row.children,o),width:"200",height:"200"},on:{error:t.dealErrImg}})]),t._v(" "),a("i",{staticClass:"el-icon-circle-close delimg-icon",attrs:{title:i.id},on:{click:function(a){t.delMarkImg(e.row,e.$index,o)}}})],1)])})):a("div",{staticClass:"empty-text"},[t._v(t._s(t.noDataText))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.order"),align:"center",prop:"seriesNum",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.name"),align:"center",prop:"name"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.gender"),align:"center",prop:"gender",formatter:t.genderFormatter}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.age"),align:"center",prop:"age"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.position"),align:"center",prop:"position"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.square"),align:"center",prop:"mall.name"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.idPhoto"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"left",trigger:"hover"}},[a("div",{staticClass:"face-img-box",attrs:{slot:"reference"},slot:"reference"},[a("img",{staticClass:"face-img",attrs:{src:t.dealCardImg(e.row),width:"50",height:"50",alt:""}})]),t._v(" "),a("img",{staticClass:"zoomout-img",attrs:{src:t.dealCardImg(e.row),alt:t.dealCardImg(e.row),width:"200",height:"200"}})])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.featurePhoto"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.addImgHandle(e.row)}}},[t._v(t._s(t.$t("button.addPhoto")))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("table.operate"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.editHandle(e.row)}}},[t._v(t._s(t.$t("button.edit")))]),t._v(" "),a("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(a){t.delHandle(e.row)}}},[t._v(t._s(t.$t("button.delete")))])]}}])})],1),t._v(" "),a("el-pagination",{staticClass:"manage-pagination-box",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,50,100],"page-size":t.pageSize,layout:"sizes, prev, pager, next, slot",total:t.total},on:{"size-change":t.sizeChange,"current-change":t.cerrentChange}},[a("span",{staticClass:"slot-pagination-ele slot-ele-total"},[t._v(t._s(t.$t("table.pageHead"))+" "+t._s(t.total)+" "+t._s(t.$t("table.pageTail")))])])],1)],1),t._v(" "),a("add-dialog",{ref:"addModel"}),t._v(" "),a("edit-dialog",{ref:"editModel"}),t._v(" "),a("add-image",{ref:"imageModel"})],1)},staticRenderFns:[]},s=function(t){a("zYkY")},n=a("VU/8")(i.a,o,!1,s,"data-v-85d5ccfe",null);e.default=n.exports},fxRn:function(t,e,a){a("+tPU"),a("zQR9"),t.exports=a("g8Ux")},g2gL:function(t,e,a){"use strict";var i=a("fZjL"),o=a.n(i),s=a("RRo+"),n=a.n(s),l={components:{"crop-dialog":a("RZfC").a},data:function(){return{isShow:!1,addForm:{name:"",mallId:null,gender:null,age:null,position:""},mallList:[],uploadAction:"/staffs/uploadImg/",uploadHeaders:{},profileFormData:{},imageUrl:"",maxSize:2,rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],age:[{validator:function(t,e,a){if(!e)return a(new Error("年龄不能为空"));setTimeout(function(){n()(Number(e))?a():a(new Error("请输入正确格式"))},1e3)},trigger:"blur"}],mallId:[{required:!0,message:"请选择所属广场",trigger:"change"}]},curMallId:null}},created:function(){this.uploadHeaders={Authorization:this.$cookie.get("atoken")}},methods:{dialogInit:function(t){this.curMallId=t,this.getMallList(),this.isShow=!0},getMallList:function(){var t=this;this.mallList=[],this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data;a.data.forEach(function(e){e.id==t.curMallId&&(t.addForm.mallId=e.id)}),a.data.length>0&&(t.curMallId||(t.addForm.mallId=a.data[0].id),t.mallList=a.data)}).catch(function(t){})},beforeAvatarUpload:function(t){var e=this.maxSize;return-1!==t.type.indexOf("image")&&(!(t.size/1024/1024>e)||(this.$message.error(this.$t("message.imgLimSize")+" 2MB!"),!1))},handleChange:function(t,e){this.$refs.cropRef.cropDialogInit(e[e.length-1].raw)},getPath:function(t,e){this.profileFormData=t,this.imageUrl=e},addSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;if(e.addForm.accountId=e.$cookie.get("accountId"),"FormData"===e.toRawType(e.profileFormData))o()(e.addForm).forEach(function(t){void 0!==e.addForm[t]&&e.addForm[t]&&e.profileFormData.append(t,e.addForm[t])});else{var a=new FormData;o()(e.addForm).forEach(function(t){a.append(t,e.addForm[t])}),e.profileFormData=a}e.axios.post("/staffs",e.profileFormData,{headers:{"Content-type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(t){var a=t.data;200==a.code?(e.$refs.addForm.resetFields(),e.$refs.profileupload.clearFiles(),e.imageUrl="",e.isShow=!1,e.$parent.getTableData()):e.$message({showClose:!0,type:"error",message:e.$t("message.addClerkFailed")+a.msg})}).catch(function(t){e.$message({showClose:!0,type:"error",message:e.$t("message.editClerkFailed")+t.message})})})},closeDialog:function(){this.profileFormData=null,this.$refs.profileupload.clearFiles(),this.imageUrl="",this.$refs.addForm.resetFields(),this.isShow=!1}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{staticClass:"manage-dialog",attrs:{title:t.$t("dialog.addClerk"),visible:t.isShow,"before-close":t.closeDialog},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"addForm",attrs:{model:t.addForm,"status-icon":"",rules:t.rules}},[a("el-form-item",{attrs:{label:t.$t("table.name"),prop:"name"}},[a("el-input",{model:{value:t.addForm.name,callback:function(e){t.$set(t.addForm,"name",e)},expression:"addForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.gender"),prop:"gender"}},[a("el-select",{staticClass:"manage-sel",attrs:{placeholder:t.$t("pholder.select"),"no-data-text":t.$t("pholder.nodata")},model:{value:t.addForm.gender,callback:function(e){t.$set(t.addForm,"gender",e)},expression:"addForm.gender"}},[a("el-option",{attrs:{label:t.$t("head.man"),value:1}}),t._v(" "),a("el-option",{attrs:{label:t.$t("head.woman"),value:0}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.age"),prop:"age"}},[a("el-input",{model:{value:t.addForm.age,callback:function(e){t.$set(t.addForm,"age",e)},expression:"addForm.age"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.position"),prop:"position"}},[a("el-input",{model:{value:t.addForm.position,callback:function(e){t.$set(t.addForm,"position",e)},expression:"addForm.position"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("table.square"),prop:"mallId"}},[a("el-select",{staticClass:"manage-sel",attrs:{filterable:"",placeholder:t.$t("pholder.select"),"no-data-text":t.$t("pholder.nodata")},model:{value:t.addForm.mallId,callback:function(e){t.$set(t.addForm,"mallId",e)},expression:"addForm.mallId"}},t._l(t.mallList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("dialog.profilePic"),prop:"photo"}},[a("el-upload",{ref:"profileupload",staticClass:"avatar-uploader",attrs:{multiple:!1,"show-file-list":!1,"auto-upload":!1,action:t.uploadAction,headers:t.uploadHeaders,"on-change":t.handleChange,"before-upload":t.beforeAvatarUpload}},[t.imageUrl?a("img",{staticClass:"avatar",attrs:{src:t.imageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"dialog-btn",on:{click:t.closeDialog}},[t._v(t._s(t.$t("dialog.cancel")))]),t._v(" "),a("el-button",{staticClass:"dialog-btn dialog-confirm-btn",attrs:{type:"primary"},on:{click:function(e){t.addSubmit("addForm")}}},[t._v(t._s(t.$t("dialog.confirm")))])],1)],1),t._v(" "),a("crop-dialog",{ref:"cropRef",on:{profilePath:t.getPath}})],1)},staticRenderFns:[]},c=a("VU/8")(l,r,!1,null,null,null);e.a=c.exports},g8Ux:function(t,e,a){var i=a("77Pl"),o=a("3fs2");t.exports=a("FeBl").getIterator=function(t){var e=o(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},xyEl:function(t,e,a){"use strict";(function(t){var i=a("3MSA"),o=a.n(i),s=a("QCPg"),n=a.n(s),l=a("bchz"),r=a.n(l),c=a("g2gL"),d=a("0CEu"),m=a("0HEy");e.a={data:function(){return{pickerOptions1:{},clerkName:"",mallName:"",mallVal:"",mallOpt:[],monitoryVal:"",monitoryName:"",monitoryOpt:[],cameraVal:"",cameraOpt:[],typeVal:"",picApiUrl:window.profileOssUrl+"/faceRecognitions/face/",defaultImg:o.a,tableData:[],total:0,pageSize:10,currentPage:1,pagesizeArr:[10,20,50,100],tableHeight:0,loading:!0,isEffect:!0,addDialogVisible:!1,noDataText:""}},components:{"add-dialog":c.a,"edit-dialog":d.a,"add-image":m.a},created:function(){var e=t(window).height();this.tableHeight=e-.24*e,this.getMallList()},mounted:function(){var t=this;setTimeout(function(){t.getTableData()},500)},methods:{getTableData:function(){var t=this;this.loading=!0,this.tableData=[];var e={accountId:this.$cookie.get("accountId"),mallId:this.mallVal,name_like:"%"+this.clerkName+"%",page:this.currentPage,pageSize:this.pageSize,_t:Date.parse(new Date)/1e3};this.axios.get("/staffs",{params:e}).then(function(e){var a=e.data;a.data.list.forEach(function(e,a){e.children=[],e.seriesNum=(t.currentPage-1)*t.pageSize+1+a}),t.tableData=a.data.list,t.total=a.data.total,setTimeout(function(){t.loading=!1},1e3)}).catch(function(t){})},expandHandle:function(t,e){var a=this;this.$refs.row_table.store.states.expandRows=e.length?[t]:[];var i=!1;this.$refs.row_table.store.states.expandRows.length>0&&(this.$refs.row_table.store.states.expandRows[0].id=t.id,i=!0),this.noDataText="load",t.children=[],i&&this.axios.get("/staffFaces",{params:{staffId:t.id,_t:Date.parse(new Date)/1e3}}).then(function(e){var i=e.data;0==i.data.length&&(a.noDataText=a.$t("echartsTitle.noData")),i.data.forEach(function(t){t.facePic=t.facePic?t.facePic:"0"}),t.children=i.data}).catch(function(t){})},genderFormatter:function(t,e,a){var i=this.getLocalDic("gender",a);return i||"--"},sizeChange:function(t){this.pageSize=t,this.getTableData()},cerrentChange:function(t){this.currentPage!=t&&(this.currentPage=t,this.getTableData())},typeFormat:function(t,e,a){return a||0==a?this.getLocalDic("personType",a):"顾客"},getLocalDic:function(t,e){var a=window.sessionStorage.getItem(t+"-"+e);return a?this.$t("dictionary."+a):e},getMallList:function(){var t=this;this.mallOpt=[],this.mallVal="",this.mallName="",this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(e){var a=e.data.data;a.length>0&&(t.mallOpt=a,t.getSessionLocal("manageMallId")?(t.mallVal=Number(t.getSessionLocal("manageMallId")),a.forEach(function(e){e==t.mallVal&&(t.mallName=e.name)})):(t.mallVal=a[0].id,t.setSessionLocal("manageMallId",t.mallVal),t.mallName=a[0].name))}).catch(function(t){})},chooseMall:function(t){var e=this;this.setSessionLocal("manageMallId",t),this.monitoryOpt.forEach(function(a){a.id==t&&(e.mallName=a.name)})},getGates:function(t){var e=this;this.axios.get("/gates",{params:{mallId:t,type:1,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data.data;e.monitoryOpt=[],a.length&&(a.unshift({id:"",name:"全部监控点"}),e.monitoryOpt=a,e.monitoryVal=a[0].id,e.monitoryName=a[0].name,e.getChannels(e.monitoryVal))}).catch(function(t){})},chooseMonitory:function(){var t=this;this.monitoryOpt.forEach(function(e){e.id==t.monitoryVal&&(t.monitoryName=e.name)}),this.getChannels(this.monitoryVal)},getChannels:function(t){var e=this;this.axios.get("/channels",{params:{gateId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){e.cameraOpt=[];var a=t.data.data;a.unshift({id:"",name:"全部通道"}),e.cameraOpt=a,e.cameraOpt.length>0?e.cameraVal=e.cameraOpt[0].id:e.cameraVal=""}).catch(function(t){})},delMarkImg:function(t,e,a){var i=this,o="";o=this.tableData[e].children[a].id,this.$confirm(this.$t("message.confirDelete"),this.$t("message.prompt"),{confirmButtonText:this.$t("message.confirm"),cancelButtonText:this.$t("message.cancel"),type:"warning"}).then(function(){i.axios.delete("/staffFaces/deleteStaff/"+o).then(function(t){var o=t.data;200==o.code?(i.$message({showClose:!0,type:"success",message:i.$t("message.deleteSuccess")}),i.tableData[e].children.splice(a,1),0==i.tableData[e].children.length&&(i.noDataText=i.$t("echartsTitle.noData"))):i.$message({showClose:!0,type:"error",message:i.$t("message.deleteFailed")+o.msg})})})},delHandle:function(t){var e=this;this.$confirm(this.$t("message.confirDelete"),this.$t("message.prompt"),{confirmButtonText:this.$t("message.confirm"),cancelButtonText:this.$t("message.cancel"),type:"warning"}).then(function(){e.axios.get("/staffFaces",{params:{staffId:t.id,_t:Date.parse(new Date)/1e3}}).then(function(a){0==a.data.data.length?e.axios.delete("/staffs/"+t.id).then(function(t){var a=t.data;200==a.code?e.getTableData():e.$message({showClose:!0,type:"error",message:e.$t("message.deleteFailed")+a.msg})}):e.$message({showClose:!0,type:"warning",message:e.$t("message.deleteFeature")})})})},dealImg:function(t,e){var a=t[e];return"0"===a.facePic?this.defaultImg:window.picUrl+"/face/"+a.facePic},dealErrImg:function(t){(t||window.event).target.src=o.a},dealCardImg:function(t){return"store"==this.$Project&&10==this.$cookie.get("accountId")?"1"==t.gender?r.a:"0"==t.gender?n.a:o.a:t.photo?window.apiUrl+"/staffs/img/"+t.photo:o.a},dealPersontype:function(t,e){this.tableData.forEach(function(a){a.personUnid==t&&(a.personType=e)})},markHandle:function(t){0==t.personType?this.markClerk(t):this.cancelMark(t)},markClerk:function(t){var e=this;this.axios.get("/faceRecognitions/markStaff/"+t.id,{params:{type:1,_t:Date.parse(new Date)/1e3}}).then(function(a){200==a.data.code?(e.dealPersontype(t.personUnid,1),e.$message({showClose:!0,type:"success",message:a.data.msg})):e.$message({showClose:!0,type:"error",message:a.data.msg})})},cancelMark:function(t){var e=this;this.axios.get("/faceRecognitions/markStaff/"+t.id,{params:{type:0,_t:Date.parse(new Date)/1e3}}).then(function(a){200==a.data.code?(e.dealPersontype(t.personUnid,0),e.$message({showClose:!0,type:"success",message:a.data.msg})):e.$message({showClose:!0,type:"error",message:a.data.msg})})},addClerk:function(){this.$refs.addModel.dialogInit(this.mallVal)},addImgHandle:function(t){this.$refs.imageModel.dialogInit(t.id,t.personUnid,this.mallVal)},editHandle:function(t){this.$refs.editModel.dialogInit(t)},searchFun:function(){this.currentPage=1,this.getTableData()}}}}).call(e,a("7t+N"))},zYkY:function(t,e){}});