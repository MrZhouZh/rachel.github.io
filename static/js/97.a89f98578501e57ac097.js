webpackJsonp([97],{"5dEX":function(t,a,e){"use strict";(function(t){var i=e("HuO/"),s=e("3MSA"),l=e.n(s),n=e("TuZh"),o=e("dqHo");a.a={data:function(){return{moreOptVisible:!1,mallData:[],asisName:"",asisLevel:"",propParams:{},tableData:[],tableHeight:"",loading:!0,currentPage:1,pageArr:[10,50,100],pageSize:10,totalPage:0}},components:{"track-option":i.a,"track-dialog":n.a,"showall-dialog":o.a},created:function(){this.tableHeight=this.moreOptVisible?t(window).height()-300:t(window).height()-200},mounted:function(){this.getMallOpt(),this.showCollapse()},methods:{dealErrImg:function(t){(t||window.event).target.src=l.a},showCollapse:function(){var a=this,e="",i="",s="",l="";e=this.getStyleFn(".el-header","height"),i=this.getStyleFn(".analysis-wrapper .el-header","height"),this.moreOptVisible?(this.moreOptVisible=!1,l=e+i+8+"px",t(".track-main").animate({marginTop:l})):(this.moreOptVisible=!0,setTimeout(function(){s=a.getStyleFn(".analysis-option-wrapper","height"),l=e+i+s+8+"px",t(".track-main").animate({marginTop:l})},100))},getMallOpt:function(){var t=this;this.axios.get("/malls",{params:{accountId:this.$cookie.get("accountId"),_t:Date.parse(new Date)/1e3}}).then(function(a){var e="",i=null;if(a.data.data.length>=1){var s=window.sessionStorage.getItem("mallId");s&&Number(s),a.data.data.forEach(function(a,i){t.mallData.push(a),s&&a.id==s&&(e=a.name)}),t.asisName=e||a.data.data[0].name,i=s?Number(s):a.data.data[0].id,t.$refs.init.initAsis(i)}})},getTableData:function(){var t=this;this.tableData=[];var a={mallId:this.propParams.asis_org,personType:this.propParams.asis_type,countdate_lte:this.propParams.asis_time,countdate_gte:this.propParams.asis_time,page:this.currentPage,pageSize:this.pageSize,direction:1,age_gte:0,sortName:"counttime",filterSize:this.propParams.asis_filter,sortOrder:"DESC",_t:Date.parse(new Date)/1e3};this.axios.get("/faceRecognitions/unique",{params:a}).then(function(a){var e=a.data;200==e.code?(t.totalPage=e.data.total,e.data.list.forEach(function(a,e){a.pic=a.channelSerialnum+"|"+(a.facePic?a.facePic:"0"),a.seriesNum=(t.currentPage-1)*t.pageSize+e+1,a.age="null"!==a.age&&a.age>=0?a.age:"未知",a.gender="null"!==a.gender&&t.getLocalDic("gender",a.gender)?t.getLocalDic("gender",a.gender):"--",a.mood="null"!==a.mood?t.getLocalDic("mood",a.mood)?t.getLocalDic("mood",a.mood):t.$t("dictionary.unknow"):"--",a.personType="null"!==a.personType?t.getLocalDic("personType",a.personType)?t.getLocalDic("personType",a.personType):t.$t("dictionary.unknow"):"--",a.counttime="null"!==a.counttime?a.counttime:"--"}),t.tableData=e.data.list,setTimeout(function(){t.loading=!1},1e3)):t.$message({showClose:!0,type:"error",message:"获取顾客轨迹失败!"+e.msg})}).catch(function(t){})},sizeChange:function(t){this.pageSize=t,this.loading=!0,this.getTableData()},handleCurrentChange:function(t){this.currentPage,this.currentPage=t,this.loading=!0,this.getTableData()},initTab:function(t){this.loading=!0,this.asisName=t.asis_tit,this.propParams=t,this.currentPage=1,this.setStaffDic(t.mallId)},reportHandler:function(t){this.loading=!0,this.asisName=t.asis_tit,this.propParams=t,this.currentPage=1,this.setStaffDic(t.mallId)},setStaffDic:function(t){var a=this;this.axios.get("/staffs",{params:{mallId:t,_t:Date.parse(new Date)/1e3}}).then(function(t){t.data.data.forEach(function(t){a.setSessionLocal("staff-"+t.personUnid,t.name)}),a.getTableData()})},getLocalDic:function(t,a){return window.sessionStorage.getItem(t+"-"+a)?this.$t("dictionary."+window.sessionStorage.getItem(t+"-"+a)):a},dealImg:function(t){var a=t.pic.split("|")[0],e=t.pic.split("|")[1],i=t.counttime.split(" ")[0],s=i.split("-")[0]+i.split("-")[1]+i.split("-")[2];return"0"===e?l.a:window.picUrl+"/face/"+s+"/"+a+"/"+e},showAll:function(t){this.$refs.showAllImg.dialogInit(t.personUnid,this.propParams)},showTrack:function(t){this.$refs.showTrack.dialogInit(t.personUnid,this.propParams)}}}}).call(a,e("7t+N"))},"7leH":function(t,a){},DqNV:function(t,a){},"HuO/":function(t,a,e){"use strict";var i=e("wkuu"),s=e.n(i),l={props:{mallData:Array},data:function(){return{pickerOptions1:{disabledDate:function(t){return t.getTime()>Date.now()}},weekPickerOpt:{firstDayOfWeek:1},tabItem:[],panelObj:{mallPanel:!1},dayTime:"",mallVal:"",paramId:"",typeVal:"",filterVal:0,floorImg:""}},created:function(){this.tabItem=[],this.$Project,this.tabItem.push({label:"mall",value:"mall",className:"analysis-item"})},methods:{i18nFormatter:function(t){var a="asisTab."+t;return this.$t(a)},initAsis:function(t){this.paramId=t,this.mallVal=t,this.tabClickHandle(0),this.getFloorImg(t,!0)},emitInitData:function(){var t={asis_time:this.dayTime,asis_bg:s.a,asis_org:this.paramId,asis_type:this.typeVal,asis_filter:this.filterVal,asis_tit:this.getItemName(this.mallData,this.mallVal)};t.asis_bg=this.floorImg||s.a,this.$emit("initData",t)},mallChange:function(t){this.getFloorImg(t)},getFloorImg:function(t,a){var e=this;this.floorImg="",this.axios.get("/floors",{params:{mallId:t,status:1,_t:Date.parse(new Date)/1e3}}).then(function(t){var i=t.data;if(i.data.length>0){var s=window.apiUrl+"/floors/img/"+i.data[0].floorPlan;e.floorImg=s}a&&e.emitInitData()})},tabClickHandle:function(t){if("analysis-item"===this.tabItem[t].className){this.tabItem.forEach(function(t){t.className="analysis-item"}),this.tabItem[t].className="analysis-item tabs-active";for(var a in this.panelObj)this.panelObj[a]=!1;switch(this.asisLevel="",this.tabItem[t].value){case"mall":this.panelObj.mallPanel=!0,this.asisLevel="mall"}}},confirmCondition:function(){var t={asis_level:"",asis_bg:"",asis_time:"",asis_org:"",asis_type:"",asis_filter:""};this.mallVal&&(t.asis_type=this.typeVal,t.asis_time=this.dayTime,t.asis_bg=this.floorImg,t.asis_org=this.mallVal,t.asis_filter=this.filterVal,t.asis_tit=this.getItemName(this.mallData,this.mallVal),this.$emit("reportTime",t))},getItemName:function(t,a){var e="",i=a.toString().split(",")[0];return t.forEach(function(t){t.id==i&&(e=t.name)}),e},resetRefresh:function(){this.tabClickHandle(0),this.mallVal=this.mallData[0].id,this.dayTime=dateUnit.dateFormat(new Date,"yyyy-MM-dd")}},mounted:function(){this.dayTime=dateUnit.dateFormat(new Date,"yyyy-MM-dd")}},n={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"analysis-option-wrapper"},[e("div",{staticClass:"analysis-level-wrapper"},[e("div",{staticClass:"analysis-level-left"},[e("i",{staticClass:"el-icon-search"}),t._v(" "),e("span",{staticClass:"analysis-level-text"},[t._v(t._s(t.$t("asisTab.level")))])]),t._v(" "),e("div",{staticClass:"analysis-level-right"},[e("ul",{staticClass:"analysis-type-box"},t._l(t.tabItem,function(a,i){return e("li",{key:a.value,class:a.className,on:{click:function(a){t.tabClickHandle(i)}}},[e("span",{staticClass:"analysis-item-title"},[t._v(t._s(t.i18nFormatter(a.label)))])])}))])]),t._v(" "),e("div",{staticClass:"panels-content"},[e("div",{staticClass:"panels-main-top"},[t.panelObj.mallPanel?e("ul",{staticClass:"condition-box"},[e("li",{staticClass:"condition-item"},[e("span",{staticClass:"condition-item-text"},[t._v(t._s(t.$t("asisTab.mallT")))]),t._v(" "),e("div",{staticClass:"condition-item-option"},[e("el-select",{staticClass:"mall-sel-box",attrs:{filterable:"",placeholder:"请选择广场"},on:{change:t.mallChange},model:{value:t.mallVal,callback:function(a){t.mallVal=a},expression:"mallVal"}},t._l(t.mallData,function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1)]),t._v(" "),e("li",{staticClass:"condition-item"},[e("span",{staticClass:"condition-item-text"},[t._v(t._s(t.$t("asisTab.manType")))]),t._v(" "),e("div",{staticClass:"condition-item-option"},[e("el-select",{staticClass:"mall-sel-box",attrs:{placeholder:t.$t("pholder.enterPersonType")},model:{value:t.typeVal,callback:function(a){t.typeVal=a},expression:"typeVal"}},[e("el-option",{attrs:{label:t.$t("asisTab.all"),value:""}}),t._v(" "),e("el-option",{attrs:{label:"店员",value:1}}),t._v(" "),e("el-option",{attrs:{label:"顾客",value:0}})],1)],1)]),t._v(" "),e("li",{staticClass:"condition-item"},[e("span",{staticClass:"condition-item-text"},[t._v(t._s(t.$t("asisTab.filterRule")))]),t._v(" "),e("div",{staticClass:"condition-item-option"},[e("el-select",{staticClass:"mall-sel-box",attrs:{placeholder:"选择过滤规则"},model:{value:t.filterVal,callback:function(a){t.filterVal=a},expression:"filterVal"}},[e("el-option",{attrs:{label:t.$t("asisTab.unlimited"),value:0}}),t._v(" "),e("el-option",{attrs:{label:t.$t("asisTab.loose"),value:1}}),t._v(" "),e("el-option",{attrs:{label:t.$t("asisTab.standard"),value:2}}),t._v(" "),e("el-option",{attrs:{label:t.$t("asisTab.strict"),value:3}})],1)],1)])]):t._e()]),t._v(" "),e("div",{staticClass:"panels-main-bottom"},[e("ul",{staticClass:"condition-box"},[e("li",{staticClass:"condition-item"},[e("span",{staticClass:"condition-item-text"},[t._v(t._s(t.$t("asisTab.date")))]),t._v(" "),e("div",{staticClass:"condition-item-option"},[e("el-date-picker",{staticClass:"date-input analysis-date-input",attrs:{"value-format":"yyyy-MM-dd",align:"right",type:"date",size:"mini",placeholder:t.$t("pholder.date"),"picker-options":t.pickerOptions1},model:{value:t.dayTime,callback:function(a){t.dayTime=a},expression:"dayTime"}})],1)]),t._v(" "),e("li",{staticClass:"condition-item"},[e("el-button",{staticClass:"primary-btn analysis-collapse-btn",attrs:{type:"primary",size:"samll"},on:{click:t.confirmCondition}},[t._v(t._s(t.$t("button.confirm")))]),t._v(" "),e("el-button",{staticClass:"reset-btn analysis-collapse-btn",attrs:{size:"samll"},on:{click:t.resetRefresh}},[t._v(t._s(t.$t("button.reset")))])],1)])])])])},staticRenderFns:[]},o=e("VU/8")(l,n,!1,function(t){e("KuBf")},"data-v-0b52e373",null);a.a=o.exports},KuBf:function(t,a){},O6HD:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("5dEX"),s={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"base-analysis"},[e("el-header",{attrs:{height:"70px"}},[e("span",{staticClass:"asis-title"},[t._v(t._s(t.asisName)+" "+t._s(t.$t("Behavior.CustomTrack")))]),t._v(" "),e("span",{staticClass:"more-option-wrapper",on:{click:t.showCollapse}},[e("span",{staticClass:"more-option-text"},[t._v(t._s(t.$t("asis.moreOp")))]),t._v(" "),e("i",{class:t.moreOptVisible?"el-icon-arrow-down more-option-arrow":"el-icon-arrow-down more-option-arrow more-option-up"})])]),t._v(" "),e("track-option",{directives:[{name:"show",rawName:"v-show",value:t.moreOptVisible,expression:"moreOptVisible"}],ref:"init",attrs:{mallData:t.mallData},on:{reportTime:t.reportHandler,initData:t.initTab}}),t._v(" "),e("div",{staticClass:"element-main track-main"},[e("div",{staticClass:"track-list"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"track-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"max-height":t.tableHeight,"header-row-class-name":"behavior-thead"}},[e("el-table-column",{attrs:{label:t.$t("table.order"),align:"center",prop:"seriesNum",width:"100"}}),t._v(" "),e("el-table-column",{attrs:{label:t.$t("table.age"),align:"center",prop:"age"}}),t._v(" "),e("el-table-column",{attrs:{label:t.$t("table.gender"),align:"center",prop:"gender"}}),t._v(" "),e("el-table-column",{attrs:{label:t.$t("table.expression"),align:"center",prop:"mood"}}),t._v(" "),e("el-table-column",{attrs:{label:t.$t("table.type"),align:"center",prop:"personType"}}),t._v(" "),e("el-table-column",{attrs:{label:t.$t("table.time"),align:"center",prop:"counttime"}}),t._v(" "),e("el-table-column",{attrs:{label:t.$t("table.faceMap"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"left",title:"",trigger:"hover"}},[e("div",{staticClass:"face-img-box",attrs:{slot:"reference"},slot:"reference"},[e("img",{staticClass:"face-img",attrs:{src:t.dealImg(a.row),width:"50",height:"50",alt:""},on:{error:function(a){t.dealErrImg(a)}}})]),t._v(" "),e("img",{attrs:{src:t.dealImg(a.row),width:"200",height:"200",alt:t.dealImg(a.row)},on:{error:function(a){t.dealErrImg(a)}}})])]}}])}),t._v(" "),e("el-table-column",{attrs:{label:t.$t("table.operate"),align:"center",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(e){t.showAll(a.row)}}},[t._v("所有抓拍")]),t._v(" "),e("el-button",{staticClass:"tab-btn",attrs:{type:"text",size:"small"},on:{click:function(e){t.showTrack(a.row)}}},[t._v(t._s(t.$t("button.showTrack")))])]}}])})],1),t._v(" "),e("div",{staticClass:"page-wrapper"},[e("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":t.pageArr,"page-size":t.pageSize,layout:"sizes, prev, pager, next, slot",total:t.totalPage},on:{"size-change":t.sizeChange,"current-change":t.handleCurrentChange}},[e("span",{staticClass:"slot-pagination-ele slot-ele-total"},[t._v(t._s(t.$t("table.pageHead"))+" "+t._s(t.totalPage)+" "+t._s(t.$t("table.pageTail")))])])],1)],1)]),t._v(" "),e("track-dialog",{ref:"showTrack"}),t._v(" "),e("showall-dialog",{ref:"showAllImg"})],1)},staticRenderFns:[]},l=function(t){e("DqNV")},n=e("VU/8")(i.a,s,!1,l,"data-v-6cb7fc6c",null);a.default=n.exports},TuZh:function(t,a,e){"use strict";var i=e("vYZX"),s={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("el-dialog",{staticClass:"manage-dialog xy-dialog track-dialog",attrs:{visible:t.isShow,"close-on-click-modal":!1,"before-close":t.closeDialog},on:{"update:visible":function(a){t.isShow=a}}},[e("div",{attrs:{slot:"title"},slot:"title"},[e("span",{staticClass:"dialog-title"},[t._v(t._s(t.$t("button.showTrack")))]),t._v(" "),e("div",{staticClass:"replay",on:{click:t.rePlay}},[e("i",{staticClass:"icon font_family icon-reload",attrs:{title:"重新播放"}})])]),t._v(" "),e("div",{staticClass:"track-box"},[e("div",{staticClass:"graph-container"},[e("img",{staticClass:"background-img",attrs:{src:t.floorSrc,alt:""}}),t._v(" "),e("div",{staticClass:"graph-chart-container"},[e("div",{staticClass:"graph-box",attrs:{id:"graphChart"}})])]),t._v(" "),e("div",{staticClass:"track-list-right"},[e("el-scrollbar",{staticClass:"track-list-scrollbar",attrs:{"wrap-class":"list-scrollbar",native:!1}},[e("ul",{staticClass:"catch-pic-list"},t._l(t.picList,function(a,i){return e("li",{key:i,staticClass:"catch-pic-item"},[e("el-popover",{attrs:{placement:"right",title:"",trigger:"hover"}},[e("img",{staticClass:"catch-pic",attrs:{slot:"reference",src:a},on:{error:function(a){t.dealErrImg(a)}},slot:"reference"}),t._v(" "),e("img",{staticClass:"zoomin-catch-pic",attrs:{src:a},on:{error:function(a){t.dealErrImg(a)}}})])],1)}))])],1)])])},staticRenderFns:[]},l=function(t){e("7leH")},n=e("VU/8")(i.a,s,!1,l,"data-v-97775888",null);a.a=n.exports},dqHo:function(t,a,e){"use strict";var i={data:function(){return{isShow:!1,imgList:[],noData:""}},methods:{dialogInit:function(t,a){var e=this;this.isShow=!0,this.noData="loading...",this.imgList=[],this.axios.get("/faceRecognitions",{params:{mallId:a.asis_org,personUnid:t,startDate:a.asis_time,endDate:a.asis_time,_t:Date.parse(new Date)/1e3}}).then(function(t){t.data.data.forEach(function(t){var a=t.countdate.split(" ")[0],i=a.split("-")[0]+a.split("-")[1]+a.split("-")[2];e.imgList.unshift({catchtime:t.counttime,catchpic:window.picUrl+"/face/"+i+"/"+t.channelSerialnum+"/"+t.facePic})}),e.noData=0===e.imgList.length?"未抓拍到图片":""})},closeDialog:function(){this.isShow=!1,this.imgList=[]}}},s={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("el-dialog",{staticClass:"manage-dialog xy-dialog track-dialog",attrs:{visible:t.isShow,"close-on-click-modal":!1,title:t.$t("dialog.showAllPic"),"before-close":t.closeDialog},on:{"update:visible":function(a){t.isShow=a}}},[e("div",[e("el-scrollbar",{staticClass:"track-list-scrollbar",staticStyle:{height:"600px","max-height":"600px"},attrs:{"wrap-class":"list-scrollbar",native:!1}},[e("ul",{staticClass:"img-container"},[t._l(t.imgList,function(a,i){return e("li",{key:i,staticClass:"catch-item"},[e("img",{staticClass:"catch-img",attrs:{src:a.catchpic}}),t._v(" "),e("p",[t._v(t._s(a.catchtime))])])}),t._v(" "),0==t.imgList.length?e("li",{staticClass:"nodata-item"},[t._v(t._s(t.noData))]):t._e()],2)])],1)])},staticRenderFns:[]},l=e("VU/8")(i,s,!1,function(t){e("o+lx")},"data-v-9556bb68",null);a.a=l.exports},"o+lx":function(t,a){},vYZX:function(t,a,e){"use strict";(function(t){var i=e("3MSA"),s=e.n(i),l=e("ctpb"),n=(e.n(l),e("SVvQ"));e.n(n);a.a={data:function(){return{isShow:!1,floorSrc:"",firstFlag:!0,naturalWidth:"",naturalHeight:"",nodeDic:{},graphData:[],linkData:[],myEchart:{},picList:[],parentParam:{},person_unid:"",dataLen:null,drawDataTimer:null,timerObj:{},trafficData:[],durationData:[],idArr:[],nodeInstance:{},timeInstance:{},totalKL:null,totalZL:null,zoneNum:null}},methods:{dialogInit:function(a,e){this.floorSrc=e.asis_bg,this.parentParam=e,this.person_unid=a,this.isShow=!0;var i=new Image;i.src=this.floorSrc;var s=this;i.onload=function(){s.naturalWidth=s.normalWidth,s.naturalHeight=s.normalHeight,t("#graphChart").height(document.getElementsByClassName("background-img")[0].height),s.getLinkData(a,e)}},rePlay:function(){for(var t=0;t<this.dataLen;t++)clearTimeout(this.timerObj[t]);this.myEchart.clear(),this.graphData=[],this.linkData=[],this.picList=[],this.trafficData=[],this.durationData=[],this.idArr=[],this.getLinkData(this.person_unid,this.parentParam)},dealErrImg:function(t){(t||window.event).target.src=s.a},getLinkData:function(t,a){var e=this,i=document.getElementsByClassName("background-img")[0].width,s=document.getElementsByClassName("background-img")[0].height;this.totalKL=null,this.totalZL=null,this.nodeInstance={},this.timeInstance={},this.zoneNum=null;var l=new Image;l.src=this.floorSrc,l.width=i,l.height=s,this.axios.get("/report/movingLine/customerLine/"+t,{params:{orgIds:a.asis_org,orgType:"mall",startDate:a.asis_time,endDate:a.asis_time,_t:Date.parse(new Date)/1e3}}).then(function(t){var a=t.data,l=[];l=a.data,e.graphData.push({id:-1,name:"startPoint",value:-1,x:"0",y:"0",symbolSize:0,label:{show:!1}},{id:-2,name:"endPoint",value:-1,x:i,y:s,symbolSize:0,label:{show:!1}}),l.forEach(function(t){t.sourceX=t.sourceX?String((t.sourceX/e.naturalWidth*i).toFixed(2)):"0",t.sourceY=t.sourceY?String((t.sourceY/e.naturalHeight*s).toFixed(2)):"0",t.source=String(t.source),t.target=t.target?String(t.target):null,e.nodeDic[t.source]||(e.nodeDic[t.source]={id:t.source,name:t.sourceName,x:t.sourceX,y:t.sourceY}),void 0===e.nodeInstance[t.source]?e.nodeInstance[t.source]=1:e.nodeInstance[t.source]+=1,void 0===e.timeInstance[t.source]?e.timeInstance[t.source]=t.sourceTrackTime:e.timeInstance[t.source]+=t.sourceTrackTime});for(var n in e.nodeInstance)e.zoneNum++,e.totalKL+=e.nodeInstance[n];for(var o in e.timeInstance)e.totalZL+=e.timeInstance[o];var r=document.getElementById("graphChart");r.style.width=i+"px",e.$echarts.getInstanceByDom(r)?(e.$echarts.init(r).dispose(),e.myEchart=e.$echarts.init(r)):e.myEchart=e.$echarts.init(r);e.firstFlag||e.myEchart.clear(),e.firstFlag=!1,e.myEchart.clear(),e.myEchart.setOption({tooltip:{},color:"#4054af",series:[{top:0,left:0,right:0,bottom:1,edgeSymbol:["none","arrow"],categories:[],type:"graph",layout:"none",data:[],links:[],z:3,label:{normal:{show:!0,position:"right",formatter:"{b}"}},lineStyle:{normal:{color:"source",curveness:.3}}}]}),e.dataLen=l.length;for(var c=e,h=function(t){!function(a){c.timerObj[a]=setTimeout(function(){c.drawGraph(l[t])},1e3*a)}(t)},d=0;d<l.length;d++)h(d)})},drawGraph:function(t){var a=this,e=[t.sourceX,t.sourceY];if(this.graphData.length>0){if(t.source){if(this.graphData.some(function(a){return a.id===t.source})){this.graphData.forEach(function(a){a.id===t.source&&(a.value+=1,a.symbolSize=5)});var i=t.sourceCountdate.split(" ")[0],s=i.split("-")[0]+i.split("-")[1]+i.split("-")[2];this.picList.unshift(window.picUrl+"/face/"+s+"/"+t.sourceChannelSeries+"/"+t.sourcePic)}else{this.graphData.push({id:t.source,name:t.sourceName,x:t.sourceX,y:t.sourceY,value:1,symbolSize:5});var l=t.sourceCountdate.split(" ")[0],n=l.split("-")[0]+l.split("-")[1]+l.split("-")[2];this.picList.unshift(window.picUrl+"/face/"+n+"/"+t.sourceChannelSeries+"/"+t.sourcePic)}}}else this.graphData.push({id:t.source,name:t.sourceName,x:t.sourceX,y:t.sourceY,value:1,symbolSize:5});this.trafficData=[],this.durationData=[];for(var o in this.nodeInstance)this.trafficData.push({name:this.nodeDic[o].name,value:this.nodeInstance[o]});for(var r in this.timeInstance)this.durationData.push({name:this.nodeDic[r].name,value:this.timeInstance[r]});var c=this;this.trafficData.forEach(function(a,e){a.name===t.sourceName&&(a.tooltip={show:!0,backgroundColor:"rgba(0, 0, 0, .5)",formatter:function(t){var a="",e="";return a+='<div style="font-size:14px;height:31px;color:#fff;border-radius:4px;line-height:31px;padding-left:15px;padding-right:15px; text-align: left;"> 遊逛次数: '+t.data.value+"</div><div>",e=(t.data.value/c.totalKL*100).toFixed(2)+"%",a+='<p style="font-size:13px; padding:4px 15px; color:#fff; text-align: left;">占比: '+e+"</p>",a+="</div>"}},a.itemStyle={normal:{color:"#5FC5F5"},emphasis:{color:"#5FC5F5"}})}),this.durationData.forEach(function(a,e){a.name===t.sourceName&&(a.tooltip={show:!0,backgroundColor:"rgba(0, 0, 0, .5)",formatter:function(t){var a="",e="";return a+='<div style="font-size:14px;height:31px;color:#fff;border-radius:4px;line-height:31px;padding-left:15px;padding-right:15px; text-align: left;"> 滞留时间: '+t.data.value+"</div><div>",e=(t.data.value/c.totalZL*100).toFixed(2)+"%",a+='<p style="font-size:13px; padding:4px 15px; color:#fff; text-align: left;">占比: '+e+"</p>",a+="</div>"}},a.itemStyle={normal:{color:"#8F99F0"},emphasis:{color:"#8F99F0"}})});var h=this.myEchart.getOption();h.series[0].data=this.graphData,-1!=this.idArr.indexOf(t.source)?h.series.forEach(function(e){"kl"+e.id=="kl"+t.source?e.data=a.trafficData:"zl"+e.id=="zl"+t.source&&(e.data=a.durationData)}):(h.series.push({type:"pie",id:"kl"+t.source,radius:[20,0],center:e,hoverAnimation:!1,label:{show:!1},labelLine:{show:!1},tooltip:{show:!1},itemStyle:{normal:{color:"#e0f5ff",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"#e0f5ff",label:{show:!1},labelLine:{show:!1}}},data:this.trafficData},{type:"pie",id:"zl"+t.source,radius:[30,24],center:e,hoverAnimation:!1,label:{show:!1},labelLine:{show:!1},tooltip:{show:!1},itemStyle:{normal:{color:"#dbdffd",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"#dbdffd",label:{show:!1},labelLine:{show:!1}}},data:this.durationData}),this.idArr.push(t.source)),this.myEchart.setOption(h),setTimeout(function(){if(a.linkData.length>0){if(t.target){a.linkData.some(function(a){return a.source===t.source&&a.target===t.target})?a.linkData.forEach(function(a){a.source===t.source&&a.target===t.target&&(a.value+=1,a.lineStyle={normal:{width:a.value}})}):a.linkData.push({source:t.source,target:t.target,value:1})}}else a.linkData.push({source:t.source,target:t.target,value:1});h.series[0].links=a.linkData,a.myEchart.setOption(h)},1e3)},closeDialog:function(){this.isShow=!1;for(var t=0;t<this.dataLen;t++)clearTimeout(this.timerObj[t]);this.graphData=[],this.linkData=[],this.picList=[],this.idArr=[],this.trafficData=[],this.durationData=[],this.myEchart.clear()}}}}).call(a,e("7t+N"))}});